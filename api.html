<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Privacy-Preserving Attribution: Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version b25686b9f, updated Fri Mar 14 14:15:20 2025 -0700" name="generator">
  <link href="https://www.w3.org/TR/privacy-preserving-attribution" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="8eafbc7273eda82f44ed16511857d75bdb3e3aae" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
/* dark mode haxx for diagrams - unnested version */

svg.diagram [stroke="black"], svg.diagram [stroke^="#000"] {
	 stroke: var(--text);
}
svg.diagram [stroke="white"], svg.diagram [stroke^="#fff"] {
	 stroke: var(--bg);
}

 svg.diagram [fill="black"], svg.diagram [fill^="#000"], svg.diagram :not([fill]) {
	 fill: var(--text);
}

 svg.diagram [fill="white"], svg.diagram [fill^="#fff"] {
	 fill: var(--bg);
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Privacy-Preserving Attribution: Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="2025-05-23">23 May 2025</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/ppa">https://w3c.github.io/ppa</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/privacy-preserving-attribution">https://www.w3.org/TR/privacy-preserving-attribution</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/ppa/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="131329"><a class="p-name fn u-email email" href="mailto:apaseltiner@chromium.org">Andrew Paseltiner</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="147715"><a class="p-name fn u-email email" href="mailto:aleiserson@mozilla.com">Andy Leiserson</a> (<a class="p-org org" href="https://mozilla.org/">Mozilla</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="114877"><a class="p-name fn u-email email" href="mailto:btsavage@meta.com">Benjamin Savage</a> (<a class="p-org org" href="https://www.meta.com/">Meta</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="110615"><a class="p-name fn u-email email" href="mailto:csharrison@chromium.org">Charlie Harrison</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="68503"><a class="p-name fn u-email email" href="mailto:mt@mozilla.com">Martin Thomson</a> (<a class="p-org org" href="https://mozilla.org/">Mozilla</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specifies a browser API for the measurement of advertising performance.  The goal is to produce aggregate statistics about how advertising leads to conversions, without creating a risk to the privacy of individual web users.  This API collates information about people from multiple web origins, which could be a significant risk to their privacy.  To manage this risk, the information that is gathered is aggregated using an aggregation service that is trusted by the user-agent to perform aggregation within strict limits.  Noise is added to the aggregates produced by this service to provide differential privacy. Websites may select an aggregation service from the list of approved aggregation services provided by the user-agent.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#s-attribution"><span class="secno">1.1</span> <span class="content">Attribution</span></a>
      <li><a href="#background"><span class="secno">1.2</span> <span class="content">Background</span></a>
      <li><a href="#goals"><span class="secno">1.3</span> <span class="content">Goals</span></a>
      <li><a href="#user-benefit"><span class="secno">1.4</span> <span class="content">End-User Benefit</span></a>
      <li><a href="#collective"><span class="secno">1.5</span> <span class="content">Collective Privacy Effect</span></a>
      <li><a href="#histograms"><span class="secno">1.6</span> <span class="content">Attribution Using Histograms</span></a>
     </ol>
    <li><a href="#overview"><span class="secno">2</span> <span class="content">Overview of Operation</span></a>
    <li>
     <a href="#api"><span class="secno">3</span> <span class="content">API Usage</span></a>
     <ol class="toc">
      <li><a href="#sites"><span class="secno">3.1</span> <span class="content">Site Identities</span></a>
      <li><a href="#navigator-interface"><span class="secno">3.2</span> <span class="content">Navigator Interface</span></a>
      <li><a href="#find-aggregation-service"><span class="secno">3.3</span> <span class="content">Finding a Supported Aggregation Service</span></a>
      <li><a href="#save-impression-api"><span class="secno">3.4</span> <span class="content">Saving Impressions</span></a>
      <li><a href="#measure-conversion-api"><span class="secno">3.5</span> <span class="content">Requesting Attribution for a Conversion</span></a>
      <li><a href="#permission-policy"><span class="secno">3.6</span> <span class="content">Permissions Policy Integration</span></a>
     </ol>
    <li>
     <a href="#api-internals"><span class="secno">4</span> <span class="content">API Internals</span></a>
     <ol class="toc">
      <li>
       <a href="#s-impression-store"><span class="secno">4.1</span> <span class="content">Impression Store</span></a>
       <ol class="toc">
        <li><a href="#impression-store-contents"><span class="secno">4.1.1</span> <span class="content">Contents</span></a>
        <li><a href="#impression-store-maintenance"><span class="secno">4.1.2</span> <span class="content">Maintenance</span></a>
        <li><a href="#impression-store-clear"><span class="secno">4.1.3</span> <span class="content"><code>Clear-Site-Data</code> Integration</span></a>
        <li><a href="#site-name-algorithm"><span class="secno">4.1.4</span> <span class="content">Site Names</span></a>
       </ol>
      <li>
       <a href="#privacy-state"><span class="secno">4.2</span> <span class="content">State For Privacy Budget Management</span></a>
       <ol class="toc">
        <li><a href="#s-privacy-budget-store"><span class="secno">4.2.1</span> <span class="content">Privacy Budget Store</span></a>
        <li><a href="#s-epoch-start"><span class="secno">4.2.2</span> <span class="content">Epoch Start Store</span></a>
        <li><a href="#last-clear"><span class="secno">4.2.3</span> <span class="content">Last Browsing History Clear Time</span></a>
       </ol>
      <li><a href="#save-impression-api-operation"><span class="secno">4.3</span> <span class="content">Save Impression Algorithm</span></a>
      <li>
       <a href="#measure-conversion-api-operation"><span class="secno">4.4</span> <span class="content">Measure Conversion Algorithm</span></a>
       <ol class="toc">
        <li><a href="#s-logic"><span class="secno">4.4.1</span> <span class="content">Attribution Logic</span></a>
        <li>
         <a href="#logic-matching"><span class="secno">4.4.2</span> <span class="content">Common Impression Matching Logic</span></a>
         <ol class="toc">
          <li><a href="#last-touch-attribution"><span class="secno">4.4.2.1</span> <span class="content">Last-Touch Attribution</span></a>
         </ol>
       </ol>
      <li>
       <a href="#user-control"><span class="secno">4.5</span> <span class="content">User Control and Visibility</span></a>
       <ol class="toc">
        <li><a href="#opt-out"><span class="secno">4.5.1</span> <span class="content">Optional Participation</span></a>
        <li><a href="#visibility"><span class="secno">4.5.2</span> <span class="content">Visibility</span></a>
       </ol>
     </ol>
    <li><a href="#http-api"><span class="secno">5</span> <span class="content">HTTP API</span></a>
    <li><a href="#implementation-considerations"><span class="secno">6</span> <span class="content">Implementation Considerations</span></a>
    <li>
     <a href="#aggregation"><span class="secno">7</span> <span class="content">Aggregation</span></a>
     <ol class="toc">
      <li>
       <a href="#s-mpc"><span class="secno">7.1</span> <span class="content">Multi-Party Computation Aggregation</span></a>
       <ol class="toc">
        <li><a href="#prio"><span class="secno">7.1.1</span> <span class="content">Prio and DAP</span></a>
        <li><a href="#dap-extensions"><span class="secno">7.1.2</span> <span class="content">DAP Extensions</span></a>
       </ol>
      <li><a href="#s-tee"><span class="secno">7.2</span> <span class="content">Trusted Execution Environments</span></a>
      <li><a href="#anti-replay"><span class="secno">7.3</span> <span class="content">Anti-Replay Requirements</span></a>
     </ol>
    <li>
     <a href="#dp"><span class="secno">8</span> <span class="content">Differential Privacy</span></a>
     <ol class="toc">
      <li>
       <a href="#dp-unit"><span class="secno">8.1</span> <span class="content">Privacy Unit</span></a>
       <ol class="toc">
        <li><a href="#dp-instance"><span class="secno">8.1.1</span> <span class="content">Browser Instances</span></a>
        <li><a href="#dp-site"><span class="secno">8.1.2</span> <span class="content">Per-Site Limits</span></a>
        <li><a href="#dp-refresh"><span class="secno">8.1.3</span> <span class="content">Privacy Budget Epochs</span></a>
       </ol>
      <li>
       <a href="#dp-budget"><span class="secno">8.2</span> <span class="content">Privacy Budgets</span></a>
       <ol class="toc">
        <li><a href="#dp-deduction"><span class="secno">8.2.1</span> <span class="content">Privacy Budget Deduction</span></a>
        <li><a href="#dp-safety"><span class="secno">8.2.2</span> <span class="content">Safety Limits</span></a>
       </ol>
      <li><a href="#dp-mechanism"><span class="secno">8.3</span> <span class="content">Differential Privacy Mechanisms</span></a>
     </ol>
    <li>
     <a href="#security"><span class="secno">9</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#security-impression-store"><span class="secno">9.1</span> <span class="content">Impression Store</span></a>
      <li><a href="#security-api-implementation"><span class="secno">9.2</span> <span class="content">API Implementation</span></a>
      <li><a href="#security-aggregation-services"><span class="secno">9.3</span> <span class="content">Aggregation Services</span></a>
      <li><a href="#security-multiple-sites"><span class="secno">9.4</span> <span class="content">Combining Reports from Multiple Sites</span></a>
      <li><a href="#security-ad-fraud"><span class="secno">9.5</span> <span class="content">Ad Fraud</span></a>
     </ol>
    <li>
     <a href="#privacy"><span class="secno">10</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#privacy-exposure"><span class="secno">10.1</span> <span class="content">Information Exposed by the Private Attribution API</span></a>
      <li><a href="#privacy-opt-out"><span class="secno">10.2</span> <span class="content">Disabling the Private Attribution API</span></a>
      <li><a href="#unconfigured"><span class="secno">10.3</span> <span class="content">Unconfigured Browsers</span></a>
      <li><a href="#privacy-impression-store"><span class="secno">10.4</span> <span class="content">Including Identifying Information with Saved Impressions</span></a>
      <li><a href="#privacy-third-party-contexts"><span class="secno">10.5</span> <span class="content">Use in Third-party Contexts</span></a>
      <li>
       <a href="#clear-budget-store"><span class="secno">10.6</span> <span class="content">Clearing API State</span></a>
       <ol class="toc">
        <li><a href="#clear-site-data"><span class="secno">10.6.1</span> <span class="content">Clearing Site Data</span></a>
        <li><a href="#clear-browsing-history"><span class="secno">10.6.2</span> <span class="content">Clearing Browsing History</span></a>
        <li><a href="#removing-impressions"><span class="secno">10.6.3</span> <span class="content">Clearing Impressions</span></a>
       </ol>
      <li><a href="#why-wall-clock"><span class="secno">10.7</span> <span class="content">Choice of Clock</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">11</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>This document defines a simple API for browsers
that enables the collection of aggregated, differentially-private metrics.</p>
   <p>The primary goal of this API is to enable attribution for advertising.</p>
   <h3 class="heading settled" data-level="1.1" id="s-attribution"><span class="secno">1.1. </span><span class="content">Attribution</span><a class="self-link" href="#s-attribution"></a></h3>
   <p>In advertising, <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="attribution|attributed" data-noexport id="attribution">attribution</dfn> is the process of identifying <a data-link-type="dfn" href="#actions" id="ref-for-actions">actions</a> that precede an <a data-link-type="dfn" href="#outcomes" id="ref-for-outcomes">outcome</a> of interest,
and allocating value to those <a data-link-type="dfn" href="#actions" id="ref-for-actions①">actions</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="actions" data-noexport id="actions">Actions</dfn> that are of interest to advertisers
are primarily the showing of advertisements
(also referred to as <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="impression" data-noexport id="impression">impressions</dfn>).
Other actions include ad clicks (or other interactions)
and opportunities to show ads that were not taken.</p>
   <p>Desired <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="outcomes">outcomes</dfn> for advertising are more diverse,
as they include any result that an advertiser seeks to improve
through the showing of ads.
A desirable outcome might also be referred to as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conversion">conversion</dfn>,
which refers to "converting" a potential customer
into a customer.
What counts as a conversion could include
sales, subscriptions, page visits, and enquiries.</p>
   <p>For this API, <a data-link-type="dfn" href="#actions" id="ref-for-actions②">actions</a> and <a data-link-type="dfn" href="#outcomes" id="ref-for-outcomes①">outcomes</a> are both
events: things that happen once.
What is unique about attribution for advertising
is that these events might not occur on the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site">site</a>.
Advertisements are most often shown on sites
other than the advertiser’s site.</p>
   <p>The primary challenge with attribution is in maintaining privacy.
Attribution involves connecting activity on different sites.
The goal of attribution is to find an impression
that was shown to the same person before the conversion occurred.</p>
   <p>If attribution information were directly revealed,
it would enable unwanted <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#cross-context-recognition" id="ref-for-cross-context-recognition">cross-context recognition</a>,
thereby enabling <a data-link-type="biblio" href="#biblio-unsanctioned-tracking" title="Unsanctioned Web Tracking">tracking</a>.</p>
   <p>This document avoids cross-context recognition by ensuring that
attribution information is aggregated using an <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service">aggregation service</a>.
The aggregation service is trusted to compute an aggregate
without revealing the values that each person contributes to that aggregate.</p>
   <p>Strict limits are placed on the amount of information that each browser instance
contributes to the aggregates for a given site.
Differential privacy is used to provide additional privacy protection for each contribution.</p>
   <p>Details of aggregation service operation is included in <a href="#aggregation">§ 7 Aggregation</a>.
The differential privacy design used is outlined in <a href="#dp">§ 8 Differential Privacy</a>.</p>
   <h3 class="heading settled" data-level="1.2" id="background"><span class="secno">1.2. </span><span class="content">Background</span><a class="self-link" href="#background"></a></h3>
   <p>From the early days of the Web,
advertising has been widely used to financially support the creation of sites.</p>
   <p>One characteristic that distinguished the Web from other venues for advertising
was the ability to obtain information about the effectiveness of advertising campaigns.</p>
   <p>Web advertisers were able to measure key metrics like reach (how many people saw an ad),
frequency (how often each person saw an ad),
and <a data-link-type="dfn" href="#conversion" id="ref-for-conversion">conversions</a> (how many people who saw the ad then later took the action that the ad was supposed to motivate).
In comparison, these measurements were far more timely and accurate than for any other medium.</p>
   <p>The cost of measurement performance was privacy.
In order to produce accurate and comprehensive information,
advertising businesses performed extensive tracking of the activity of all Web users.
Each browser was given a tracking identifier,
often using cookies that were logged by cross-site content.
Every action of interest was logged against this identifier,
forming a comprehensive record of a person’s online activities.</p>
   <p>Having a detailed record of a person’s actions allowed advertisers to infer characteristics about people.
Those characteristics made it easier to choose the right audience for advertising,
greatly improving its effectiveness.
This created a strong incentive to gather more information.</p>
   <p>Online advertising is intensely competitive.
Sites that show advertising seek to obtain the most money for each ad placement.
Advertisers seek to place advertising where it will have the most effect relative to its cost.
Any competitive edge gained by these entities—​and the intermediaries that operate on their behalf—​depends on having more comprehensive information about a potential audience.</p>
   <p>Over time, actions of interest expanded to include nearly every aspect of online activity.
Methods were devised to correlate that information with activity outside of the Web.
An energetic trade has formed,
with multiple purveyors of personal information that is traded for various purposes.</p>
   <h3 class="heading settled" data-level="1.3" id="goals"><span class="secno">1.3. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
   <p>The goal of this document is to define a means of performing <a data-link-type="dfn" href="#attribution" id="ref-for-attribution">attribution</a> for advertising
that does not enable tracking.</p>
   <h3 class="heading settled" data-level="1.4" id="user-benefit"><span class="secno">1.4. </span><span class="content">End-User Benefit</span><a class="self-link" href="#user-benefit"></a></h3>
   <p>The measurement of advertising performance creates new cross-site flows of information.
That information flow creates a privacy risk or cost—​of [cross-context recognition=]—​that needs to be justified in terms of benefits to end users.</p>
   <p>Any benefits realized by end users through the use of <a data-link-type="dfn" href="#attribution" id="ref-for-attribution①">attribution</a> are indirect.</p>
   <p>End users that visit a website
pay for "free" content or services
primarily through their attention
to any advertisements the site shows them.
This "value" accrues to the advertiser,
who in turn pays the site.
The site is expected to use this money to
support the provision of their content or services.</p>
   <figure>
    <svg class="diagram" font-family="monospace" font-size="13px" height="272" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 432 272" width="432" xmlns="http://www.w3.org/2000/svg">
     <text class="ascii" display="none"> +-------------+            +------------+
|             |            |            |
|    User     +----------->| Advertiser |
|             | Attention  |            |
+-------------+            +-----+------+
      ^                          |
      | Content and              | Money
      | Services                 |
      |                          v
 .----+------.             +------------+
|  Content    |            |            |
| Production  | Investment |            |   Profit,
|     /       |&lt;-----------+  Website   +------->
|  Service    |            |            |   Expenses,
| Improvement |            |            |   etc...
 '-----------'             +------------+ </text>
     <path d="M 8,16 L 8,80" fill="none" stroke="black"></path>
     <path d="M 8,176 L 8,240" fill="none" stroke="black"></path>
     <path d="M 56,88 L 56,160" fill="none" stroke="black"></path>
     <path d="M 120,16 L 120,80" fill="none" stroke="black"></path>
     <path d="M 120,176 L 120,240" fill="none" stroke="black"></path>
     <path d="M 224,16 L 224,80" fill="none" stroke="black"></path>
     <path d="M 224,160 L 224,256" fill="none" stroke="black"></path>
     <path d="M 272,80 L 272,152" fill="none" stroke="black"></path>
     <path d="M 328,16 L 328,80" fill="none" stroke="black"></path>
     <path d="M 328,160 L 328,256" fill="none" stroke="black"></path>
     <path d="M 8,16 L 120,16" fill="none" stroke="black"></path>
     <path d="M 224,16 L 328,16" fill="none" stroke="black"></path>
     <path d="M 120,48 L 216,48" fill="none" stroke="black"></path>
     <path d="M 8,80 L 120,80" fill="none" stroke="black"></path>
     <path d="M 224,80 L 328,80" fill="none" stroke="black"></path>
     <path d="M 24,160 L 104,160" fill="none" stroke="black"></path>
     <path d="M 224,160 L 328,160" fill="none" stroke="black"></path>
     <path d="M 128,208 L 224,208" fill="none" stroke="black"></path>
     <path d="M 328,208 L 392,208" fill="none" stroke="black"></path>
     <path d="M 24,256 L 104,256" fill="none" stroke="black"></path>
     <path d="M 224,256 L 328,256" fill="none" stroke="black"></path>
     <path d="M 24,160 C 15.16936,160 8,167.16936 8,176" fill="none" stroke="black"></path>
     <path d="M 104,160 C 112.83064,160 120,167.16936 120,176" fill="none" stroke="black"></path>
     <path d="M 24,256 C 15.16936,256 8,248.83064 8,240" fill="none" stroke="black"></path>
     <path d="M 104,256 C 112.83064,256 120,248.83064 120,240" fill="none" stroke="black"></path>
     <polygon class="arrowhead" fill="black" points="400,208 388,202.4 388,213.6" transform="rotate(0,392,208)"></polygon>
     <polygon class="arrowhead" fill="black" points="280,152 268,146.4 268,157.6" transform="rotate(90,272,152)"></polygon>
     <polygon class="arrowhead" fill="black" points="224,48 212,42.4 212,53.6" transform="rotate(0,216,48)"></polygon>
     <polygon class="arrowhead" fill="black" points="136,208 124,202.4 124,213.6" transform="rotate(180,128,208)"></polygon>
     <polygon class="arrowhead" fill="black" points="64,88 52,82.4 52,93.6" transform="rotate(270,56,88)"></polygon>
     <g class="text">
      <text x="60" y="52">User</text>
      <text x="276" y="52">Advertiser</text>
      <text x="168" y="68">Attention</text>
      <text x="112" y="116">Content and</text>
      <text x="304" y="116">Money</text>
      <text x="100" y="132">Services</text>
      <text x="56" y="180">Content</text>
      <text x="60" y="196">Production</text>
      <text x="172" y="196">Investment</text>
      <text x="384" y="196">Profit,</text>
      <text x="56" y="212">/</text>
      <text x="272" y="212">Website</text>
      <text x="56" y="228">Service</text>
      <text x="392" y="228">Expenses,</text>
      <text x="64" y="244">Improvement</text>
      <text x="380" y="244">etc...</text>
     </g>
    </svg>
    <figcaption>Value exchange for advertising-supported content and services</figcaption>
   </figure>
   <p>Participation in an <a data-link-type="dfn" href="#attribution" id="ref-for-attribution②">attribution</a> measurement system
would comprise a secondary cost to Web users.</p>
   <p>Support for attribution enables more effective advertising,
largely by informing advertisers about what ads perform best,
and in what circumstances.
Those circumstances might include
the time and place that the ad is shown,
the person to whom the ad is presented, and
the details of the ad itself.</p>
   <p>Connecting that information to outcomes
allows an advertiser to learn what circumstances most often lead
to the outcomes they most value.
That allows advertisers to spend more on effective advertising
and less on ineffective advertising.
This lowers the overall cost of advertising
relative to the value obtained. <a data-link-type="biblio" href="#biblio-online-advertising" title="Online Advertising">[ONLINE-ADVERTISING]</a></p>
   <p>Sites that provide advertising inventory,
such as content publishers and service providers,
indirectly benefit from more efficient advertising.
Venues for advertising that are better able to
show ads that result in
the outcomes that advertisers seek
can charge more for ad placements.</p>
   <p>Sites that obtain support through the placement of advertisements
are better able to provide quality content or services.
Importantly, that support is derived unevenly from their audience.
This can be more equitable than other forms of financial support.
Those with a lower tendency or ability to spend on advertised goods
obtain the same ad-supported content and services
as those who can afford to pay. <a data-link-type="biblio" href="#biblio-eu-ad" title="Online advertising: the impact of targeted advertising on advertisers, market access and consumer choice">[EU-AD]</a><a data-link-type="biblio" href="#biblio-coppacalypse" title="COPPAcalypse? The Youtube Settlement&apos;s Impact on Kids Content">[COPPACALYPSE]</a></p>
   <p>The ability to supply "free" services
supported by advertising
has measurable economic benefit
that derives from the value of those services. <a data-link-type="biblio" href="#biblio-free-gdp" title="Measuring the &quot;Free&quot; Digital Economy within the GDP and Productivity Accounts">[FREE-GDP]</a></p>
   <h3 class="heading settled" data-level="1.5" id="collective"><span class="secno">1.5. </span><span class="content">Collective Privacy Effect</span><a class="self-link" href="#collective"></a></h3>
   <p>The use of aggregation—​if properly implemented—​ensures that information provided to sites is about groups and not individuals.</p>
   <p>The introduction of this mechanism therefore represents collective decision-making,
in line with the idea of <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#collective-privacy" id="ref-for-collective-privacy">collective privacy</a>.</p>
   <p>Participation in attribution measurement carries a lower privacy cost
when the group that participates is larger.
This is due to the effect of aggregation on
the ability of sites to
extract information about individuals from aggregates.
This is especially true for central <a href="#dp">differential privacy</a>,
which is the mathematical basis for the privacy design used
in this specification.</p>
   <p>Larger cohorts of participants also produce more representative—​and therefore more useful—​statistics about the advertising that is being measured.</p>
   <p>If attribution is justified,
both these factors motivate the enablement of attribution for all users.</p>
   <p>Acting to enable attribution measurement by user agents
will not be positively received by some people.
Different people perceive the costs and benefits
that come from engaging with advertising differently.
The proposed design allows people the option of appearing to participate in attribution
without revealing that choice to sites; see <a href="#opt-out">§ 4.5.1 Optional Participation</a>.</p>
   <h3 class="heading settled" data-level="1.6" id="histograms"><span class="secno">1.6. </span><span class="content">Attribution Using Histograms</span><a class="self-link" href="#histograms"></a></h3>
   <p><a data-link-type="dfn" href="#attribution" id="ref-for-attribution③">Attribution</a> attempts to measure correlation
between one or more ad placements (<a data-link-type="dfn" href="#impression" id="ref-for-impression">impressions</a>)
and the <a data-link-type="dfn" href="#outcomes" id="ref-for-outcomes②">outcomes</a> that an advertiser desires.</p>
   <p>When considered in the aggregate,
information about individuals is not useful.
Actions and outcomes need to be grouped.</p>
   <p>The simplest form of attribution splits impressions into a number of groupings
according to the attributes of the advertisement
and counts the number of conversions.
Groupings might be formed from attributes such as
where the ad is shown,
what was shown (the "creative"),
when the ad was shown,
or to whom.</p>
   <p>These groupings
and the tallies of conversions attributed to each
form a histogram.
Each bucket of the histogram counts the conversions
for a group of ads.</p>
   <figure>
    <svg class="diagram" font-family="monospace" font-size="13px" height="192" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 264 192" width="264" xmlns="http://www.w3.org/2000/svg">
     <text class="ascii" display="none"> |
+------+
|      | example.com
+------+----------+
|                 | news.example
+---------+-------+
|         | classified.example
+-+-------+
| | search.example
+-+
| </text>
     <path d="M 8,16 L 8,176" fill="none" stroke="black"></path>
     <path d="M 24,128 L 24,160" fill="none" stroke="black"></path>
     <path d="M 64,32 L 64,64" fill="none" stroke="black"></path>
     <path d="M 88,96 L 88,128" fill="none" stroke="black"></path>
     <path d="M 152,64 L 152,96" fill="none" stroke="black"></path>
     <path d="M 8,32 L 64,32" fill="none" stroke="black"></path>
     <path d="M 8,64 L 152,64" fill="none" stroke="black"></path>
     <path d="M 8,96 L 152,96" fill="none" stroke="black"></path>
     <path d="M 8,128 L 88,128" fill="none" stroke="black"></path>
     <path d="M 8,160 L 24,160" fill="none" stroke="black"></path>
     <g class="text">
      <text x="120" y="52">example.com</text>
      <text x="212" y="84">news.example</text>
      <text x="172" y="116">classified.example</text>
      <text x="92" y="148">search.example</text>
     </g>
    </svg>
    <figcaption>Sample histogram for conversion counts,
  grouped by the site where the impressions were shown</figcaption>
   </figure>
   <p>Different groupings might be used for different purposes.
For instance, grouping by creative (the content of an ad)
might be used to learn which creative works best.</p>
   <p>Adding a value greater than one at each conversion
enables more than simple counts.
Histograms can also aggregate values,
which might be used to differentiate between different outcomes.
The value that is allocated to impressions
is called a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conversion-value">conversion value</dfn>.
A higher conversion value might be used for larger purchases
or any outcome that is more highly valued.
A conversion value might also be split between multiple impressions
to split credit,
though this capability is not presently supported in the API.</p>
   <h2 class="heading settled" data-level="2" id="overview"><span class="secno">2. </span><span class="content">Overview of Operation</span><a class="self-link" href="#overview"></a></h2>
   <p>The Private Attribution API provides aggregate information about the
association between two classes of events: <a data-link-type="dfn" href="#impression" id="ref-for-impression①">impressions</a> and <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①">conversions</a>.</p>
   <p>An <a data-link-type="dfn" href="#impression" id="ref-for-impression②">impression</a> is any action that an advertiser takes on any website.
The API does not constrain what can be recorded as an impression.
Typical actions that an advertiser might seek to measure include:</p>
   <ul>
    <li data-md>
     <p>Displaying an advertisement.</p>
    <li data-md>
     <p>Having a user interact with an advertisement in some way.</p>
    <li data-md>
     <p>Not displaying an advertisement (especially for controlled experiments that seek to confirm whether an advertising campaign is effective).</p>
   </ul>
   <p>For the API, a <a data-link-type="dfn" href="#conversion" id="ref-for-conversion②">conversion</a> is an <a data-link-type="dfn" href="#outcomes" id="ref-for-outcomes③">outcome</a> that is being measured.
The API does not constrain what might be considered to be an outcome.
Typical outcomes that advertisers might seek to measure include:</p>
   <ul>
    <li data-md>
     <p>Making a purchase.</p>
    <li data-md>
     <p>Signing up for an account.</p>
    <li data-md>
     <p>Visiting a webpage.</p>
   </ul>
   <p>The remainder of this section describes
how the Private Attribution API operates
in conjunction with an <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①">aggregation service</a> to produce an aggregate attribution measurement.
That operation is illustrated in the following figure.</p>
   <figure>
    <svg class="diagram" font-family="monospace" font-size="13px" height="592" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 616 592" width="616" xmlns="http://www.w3.org/2000/svg">
     <text class="ascii" display="none"> Conversion
                                 +--------------+ Reports    +-------------+
                                 |              +===========>|             |
                                 |  Advertiser  |            | Aggregation |
                                 |  Server      |            | Service     |
                                 |              |&lt;-----------+             |
                                 +--------------+ Histogram  +-------------+
                                           ^ ^ ^
                                Conversion | | |
                                   Reports | |  '-----------.
                                           |  '-----------.  |
                                           |               | |
        +-------------+-+-+      +---------+----+          | |
        |             | | |      |              |          Other Users
        |  Publisher  | | |      |  Advertiser  |
        |  Site(s)    | | |      |  Site        |
        |             | | |      |              |
        +------+------+-+-+      +-----+--------+
               |                       |   ^
saveImpression |     measureConversion |   | Conversion
               |                       |   | Report
               v                       v   |
     +-------------------------------------+---------+
     |                                               |
     |           Private Attribution APIs            |
     |                                               |
     +-----------------------------------------------+
                             ^
                             |
                             v
                       .-----------.
                      |             |
                      |  Impression |
                      |    Store    |
                      |             |
                       '-----------' </text>
     <path d="M 48,368 L 48,432" fill="none" stroke="black"></path>
     <path d="M 72,208 L 72,288" fill="none" stroke="black"></path>
     <path d="M 128,288 L 128,360" fill="none" stroke="black"></path>
     <path d="M 184,208 L 184,288" fill="none" stroke="black"></path>
     <path d="M 184,512 L 184,560" fill="none" stroke="black"></path>
     <path d="M 200,208 L 200,288" fill="none" stroke="black"></path>
     <path d="M 216,208 L 216,288" fill="none" stroke="black"></path>
     <path d="M 240,440 L 240,488" fill="none" stroke="black"></path>
     <path d="M 272,32 L 272,112" fill="none" stroke="black"></path>
     <path d="M 272,208 L 272,288" fill="none" stroke="black"></path>
     <path d="M 296,512 L 296,560" fill="none" stroke="black"></path>
     <path d="M 320,288 L 320,360" fill="none" stroke="black"></path>
     <path d="M 352,120 L 352,208" fill="none" stroke="black"></path>
     <path d="M 352,296 L 352,368" fill="none" stroke="black"></path>
     <path d="M 368,120 L 368,160" fill="none" stroke="black"></path>
     <path d="M 384,120 L 384,144" fill="none" stroke="black"></path>
     <path d="M 392,32 L 392,112" fill="none" stroke="black"></path>
     <path d="M 392,208 L 392,288" fill="none" stroke="black"></path>
     <path d="M 432,368 L 432,432" fill="none" stroke="black"></path>
     <path d="M 480,192 L 480,208" fill="none" stroke="black"></path>
     <path d="M 496,32 L 496,112" fill="none" stroke="black"></path>
     <path d="M 496,176 L 496,208" fill="none" stroke="black"></path>
     <path d="M 608,32 L 608,112" fill="none" stroke="black"></path>
     <path d="M 272,32 L 392,32" fill="none" stroke="black"></path>
     <path d="M 496,32 L 608,32" fill="none" stroke="black"></path>
     <path d="M 392,46 L 488,46" fill="none" stroke="black"></path>
     <path d="M 392,50 L 488,50" fill="none" stroke="black"></path>
     <path d="M 400,96 L 496,96" fill="none" stroke="black"></path>
     <path d="M 272,112 L 392,112" fill="none" stroke="black"></path>
     <path d="M 496,112 L 608,112" fill="none" stroke="black"></path>
     <path d="M 400,160 L 480,160" fill="none" stroke="black"></path>
     <path d="M 384,176 L 464,176" fill="none" stroke="black"></path>
     <path d="M 72,208 L 216,208" fill="none" stroke="black"></path>
     <path d="M 272,208 L 392,208" fill="none" stroke="black"></path>
     <path d="M 72,288 L 216,288" fill="none" stroke="black"></path>
     <path d="M 272,288 L 392,288" fill="none" stroke="black"></path>
     <path d="M 48,368 L 432,368" fill="none" stroke="black"></path>
     <path d="M 48,432 L 432,432" fill="none" stroke="black"></path>
     <path d="M 200,496 L 280,496" fill="none" stroke="black"></path>
     <path d="M 200,576 L 280,576" fill="none" stroke="black"></path>
     <path d="M 400,160 C 391.16936,160 384,152.83064 384,144" fill="none" stroke="black"></path>
     <path d="M 480,160 C 488.83064,160 496,167.16936 496,176" fill="none" stroke="black"></path>
     <path d="M 384,176 C 375.16936,176 368,168.83064 368,160" fill="none" stroke="black"></path>
     <path d="M 464,176 C 472.83064,176 480,183.16936 480,192" fill="none" stroke="black"></path>
     <path d="M 200,496 C 191.16936,496 184,503.16936 184,512" fill="none" stroke="black"></path>
     <path d="M 280,496 C 288.83064,496 296,503.16936 296,512" fill="none" stroke="black"></path>
     <path d="M 200,576 C 191.16936,576 184,568.83064 184,560" fill="none" stroke="black"></path>
     <path d="M 280,576 C 288.83064,576 296,568.83064 296,560" fill="none" stroke="black"></path>
     <polygon class="arrowhead" fill="black" points="496,48 484,42.4 484,53.6" transform="rotate(0,488,48)"></polygon>
     <polygon class="arrowhead" fill="black" points="408,96 396,90.4 396,101.6" transform="rotate(180,400,96)"></polygon>
     <polygon class="arrowhead" fill="black" points="392,120 380,114.4 380,125.6" transform="rotate(270,384,120)"></polygon>
     <polygon class="arrowhead" fill="black" points="376,120 364,114.4 364,125.6" transform="rotate(270,368,120)"></polygon>
     <polygon class="arrowhead" fill="black" points="360,296 348,290.4 348,301.6" transform="rotate(270,352,296)"></polygon>
     <polygon class="arrowhead" fill="black" points="360,120 348,114.4 348,125.6" transform="rotate(270,352,120)"></polygon>
     <polygon class="arrowhead" fill="black" points="328,360 316,354.4 316,365.6" transform="rotate(90,320,360)"></polygon>
     <polygon class="arrowhead" fill="black" points="248,488 236,482.4 236,493.6" transform="rotate(90,240,488)"></polygon>
     <polygon class="arrowhead" fill="black" points="248,440 236,434.4 236,445.6" transform="rotate(270,240,440)"></polygon>
     <polygon class="arrowhead" fill="black" points="136,360 124,354.4 124,365.6" transform="rotate(90,128,360)"></polygon>
     <g class="text">
      <text x="444" y="20">Conversion</text>
      <text x="432" y="36">Reports</text>
      <text x="332" y="68">Advertiser</text>
      <text x="552" y="68">Aggregation</text>
      <text x="316" y="84">Server</text>
      <text x="536" y="84">Service</text>
      <text x="440" y="116">Histogram</text>
      <text x="300" y="148">Conversion</text>
      <text x="312" y="164">Reports</text>
      <text x="520" y="228">Other Users</text>
      <text x="128" y="244">Publisher</text>
      <text x="332" y="244">Advertiser</text>
      <text x="120" y="260">Site(s)</text>
      <text x="308" y="260">Site</text>
      <text x="60" y="324">saveImpression</text>
      <text x="240" y="324">measureConversion</text>
      <text x="404" y="324">Conversion</text>
      <text x="388" y="340">Report</text>
      <text x="236" y="404">Private Attribution APIs</text>
      <text x="244" y="532">Impression</text>
      <text x="240" y="548">Store</text>
     </g>
    </svg>
    <figcaption>Overview of Private Attribution Operation</figcaption>
   </figure>
   <p>When an <a data-link-type="dfn" href="#impression" id="ref-for-impression③">impression</a> occurs,
the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression">saveImpression()</a> method can be used
to request that the browser save information.
This includes an identifier for the impression
and some additional information about the impression.
For instance, advertisers might use additional information
to record whether the impression was an ad view or an ad click.</p>
   <p>At <a data-link-type="dfn" href="#conversion" id="ref-for-conversion③">conversion</a> time, a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report">conversion report</a> is created.
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conversion-report">conversion report</dfn> is an encrypted histogram contribution
that includes information from any <a data-link-type="dfn" href="#impression" id="ref-for-impression④">impressions</a> that the browser previously stored.</p>
   <p>The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion">measureConversion()</a> method accepts a simple query that is used
to tell the browser how to construct a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①">conversion report</a>.
That includes a simple query that selects from the <a data-link-type="dfn" href="#impression" id="ref-for-impression⑤">impressions</a> that the browser has stored,
a <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value">conversion value</a> that is allocated to the selected impression(s),
and other information needed to construct the <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②">conversion report</a>.</p>
   <p>The histogram created by the <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report③">conversion report</a> is constructed as follows:</p>
   <ul>
    <li data-md>
     <p>If the query found no impressions,
or the <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets">privacy budget</a> for the site is exhausted,
a histogram consisting entirely of zeros (0) is constructed.</p>
    <li data-md>
     <p>If one or more matching impressions is found, the browser runs the attribution
logic (default last-touch) to select the most recent impression. The provided conversion
value is added to a histogram at the bucket that was specified at the time of the
attributed impression. All other buckets are set to zero.</p>
   </ul>
   <p>The browser updates the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store">privacy budget store</a> to reflect the reported conversion.</p>
   <p>The resulting histogram is prepared for aggregation according to the requirements
of the chosen <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service②">aggregation service</a> and returned to the site.
This minimally involves encryption of the histogram.</p>
   <p class="note" role="note">A site that invokes this API will always receive a valid conversion report.
As a result, sites learn nothing about what happened on other sites from this interaction. </p>
   <p>The site can collect the encrypted histograms it receives from calls to this API
and submit them to the aggregation service.</p>
   <p>Upon receiving a set of encrypted histograms from a site, the aggregation service:</p>
   <ol>
    <li data-md>
     <p>confirms that it has not
previously computed an aggregate
from the provided inputs
and that there are enough conversion reports,</p>
    <li data-md>
     <p>adds the histograms, including sufficient <a href="#dp">noise</a>,
to produce a differentially-private aggregate histogram, and</p>
    <li data-md>
     <p>returns the aggregate to the site.</p>
   </ol>
   <h2 class="heading settled" data-level="3" id="api"><span class="secno">3. </span><span class="content">API Usage</span><a class="self-link" href="#api"></a></h2>
   <p>A site using the Private Attribution API will typically register either <a data-link-type="dfn" href="#impression" id="ref-for-impression⑥">impressions</a> or <a data-link-type="dfn" href="#conversion" id="ref-for-conversion④">conversions</a>, but in some cases the same site may
do both.</p>
   <p>To register an impression, a site calls <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①">saveImpression()</a>. No preparation is
required to use this API beyond collecting parameter values, although
it may be useful to examine the supported <a class="idl-code" data-link-type="attribute" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices">aggregationServices</a> in deciding
whether to use the Private Attribution API.</p>
   <p>It is also possible to register an impression by including the
`<code><a data-link-type="http-header" href="#http-headerdef-save-impression" id="ref-for-http-headerdef-save-impression">Save-Impression</a></code>`
header in the HTTP response when serving a resource to the user agent.</p>
   <p>To request a conversion report, a site calls <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①">measureConversion()</a>.
Before calling this API, a site must
select a supported <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service③">aggregation service</a>.
The page may select any of the supported services found in <a class="idl-code" data-link-type="attribute" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices①">aggregationServices</a>.
The name of the selected service must be supplied as
the <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-aggregationservice" id="ref-for-dom-privateattributionconversionoptions-aggregationservice">aggregationService</a></code> member of the <code class="idl"><a data-link-type="idl" href="#dictdef-privateattributionconversionoptions" id="ref-for-dictdef-privateattributionconversionoptions">PrivateAttributionConversionOptions</a></code> dictionary when calling the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②">measureConversion()</a> method.</p>
   <h3 class="heading settled" data-level="3.1" id="sites"><span class="secno">3.1. </span><span class="content">Site Identities</span><a class="self-link" href="#sites"></a></h3>
   <p>This API relies on the HTML definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①">site</a> as the primary scope over which it operates.
Three types of sites are recognized:</p>
   <ul>
    <li data-md>
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="impression-site">impression site</dfn> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②">site</a> that registers an impression.
This <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site">impression site</a> is derived from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a> at the time that <code class="idl"><a data-link-type="idl" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression②">saveImpression()</a></code> is invoked to store an <a data-link-type="dfn" href="#impression" id="ref-for-impression⑦">impression</a>.</p>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="conversion-site">conversion site</dfn> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③">site</a> where a conversion occurs.
The <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site">conversion site</a> is derived from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin①">top-level origin</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a> at the time that <code class="idl"><a data-link-type="idl" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion③">measureConversion()</a></code> is invoked.</p>
    <li data-md>
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="intermediary-site">intermediary site</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site④">site</a> that calls the API from any cross-site frame, such an <a data-link-type="dfn" href="https://html.spec.whatwg.org/#child-navigable" id="ref-for-child-navigable">iframe</a>.
The <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site">intermediary site</a> is derived from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin">origin</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a> at the time that either <code class="idl"><a data-link-type="idl" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression③">saveImpression()</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion④">measureConversion()</a></code> is invoked,
unless this origin is <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site">same site</a> with the <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site①">impression site</a> or <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site①">conversion site</a>, respectively.</p>
   </ul>
   <p>This API uses <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site⑤">site</a> rather than <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin①">origin</a> because it depends on associating all activity
that might have privacy consequences with a single entity.
Features like cookies allow privacy-relevant information
to be exchanged freely by <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site①">same site</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin②">origins</a>,
which could otherwise be used to exceed <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①">privacy budgets</a>.</p>
   <h3 class="heading settled" data-level="3.2" id="navigator-interface"><span class="secno">3.2. </span><span class="content">Navigator Interface</span><a class="self-link" href="#navigator-interface"></a></h3>
   <p>All functionality for this API is attached
to the <code><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator">navigator</a></code>.<code class="idl"><a data-link-type="idl" href="#dom-navigator-privateattribution" id="ref-for-dom-navigator-privateattribution">privateAttribution</a></code></code> attribute.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator①"><c- g>Navigator</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateattribution" id="ref-for-privateattribution"><c- n>PrivateAttribution</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Navigator" data-dfn-type="attribute" data-export data-readonly data-type="PrivateAttribution" id="dom-navigator-privateattribution"><code><c- g>privateAttribution</c-></code></dfn>;
};
</pre>
   <p>This provides three key functions:</p>
   <ul>
    <li data-md>
     <p>A list of browser-supported aggregation functions (<a href="#find-aggregation-service">§ 3.3 Finding a Supported Aggregation Service</a>)</p>
    <li data-md>
     <p>A means of asking the browser to save impressions (<a href="#save-impression-api">§ 3.4 Saving Impressions</a>)</p>
    <li data-md>
     <p>A method to request conversion measurement (<a href="#measure-conversion-api">§ 3.5 Requesting Attribution for a Conversion</a>)</p>
   </ul>
   <h3 class="heading settled" data-level="3.3" id="find-aggregation-service"><span class="secno">3.3. </span><span class="content">Finding a Supported Aggregation Service</span><a class="self-link" href="#find-aggregation-service"></a></h3>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttribution" data-dfn-type="attribute" data-export id="dom-privateattribution-aggregationservices"><code>aggregationServices</code></dfn> attribute
contains a set of aggregation services supported by the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a>. The page
must select and specify one of these services when calling the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion⑤">measureConversion()</a> method.
It may also be useful to query the supported services
before registering an impression,
but that is not required,
and impressions are not scoped to a single aggregation service.</p>
   <div class="example" id="ex-find-service">
    <a class="self-link" href="#ex-find-service"></a> 
    <p>A site might have a preference order
  for the aggregation services that it uses.
  The following code iterates over a preference list
  and finds one that the user agent supports.</p>
<pre class="highlight"><c- a>const</c-> preferredServices <c- o>=</c-> <c- p>[</c->
  <c- u>"https://aggregator.example/tee"</c-><c- p>,</c->
  <c- u>"https://aggregator.example/dap"</c-><c- p>,</c->
  <c- u>"https://example.com/aggregator"</c-><c- p>,</c->
<c- p>];</c->
<c- a>const</c-> supportedServices <c- o>=</c-> navigator<c- p>.</c->privateAttribution<c- o>?</c-><c- p>.</c->aggregationServices<c- p>;</c->
<c- a>const</c-> serviceUrl <c- o>=</c-> preferredServices<c- p>.</c->find<c- p>(</c->url <c- p>=></c-> supportedServices<c- o>?</c-><c- p>.</c->has<c- p>(</c->url<c- p>));</c->
</pre>
    <p>If the user agent supports the URL
  and if it includes one of the preferred services,
  the first preferred service is saved
  in a variable named <code>serviceUrl</code>.
  Otherwise, <code>serviceUrl</code> will remain <code>undefined</code>.</p>
   </div>
<pre class="idl highlight def"><c- b>enum</c-> <a class="idl-code" data-link-type="enum" href="#enumdef-privateattributionprotocol" id="ref-for-enumdef-privateattributionprotocol"><c- g>PrivateAttributionProtocol</c-></a> { <a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionprotocol-dap-12-histogram" id="ref-for-dom-privateattributionprotocol-dap-12-histogram"><c- s>"dap-12-histogram"</c-></a>, <a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionprotocol-tee-00" id="ref-for-dom-privateattributionprotocol-tee-00"><c- s>"tee-00"</c-></a> };

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-privateattributionaggregationservice"><code><c- g>PrivateAttributionAggregationService</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="DOMString" href="#dom-privateattributionaggregationservice-protocol" id="ref-for-dom-privateattributionaggregationservice-protocol"><c- g>protocol</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="privateattributionaggregationservices"><code><c- g>PrivateAttributionAggregationServices</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a>, <a data-link-type="idl-name" href="#dictdef-privateattributionaggregationservice" id="ref-for-dictdef-privateattributionaggregationservice"><c- n>PrivateAttributionAggregationService</c-></a>>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="privateattribution"><code><c- g>PrivateAttribution</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateattributionaggregationservices" id="ref-for-privateattributionaggregationservices"><c- n>PrivateAttributionAggregationServices</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="PrivateAttributionAggregationServices" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices②"><c- g>aggregationServices</c-></a>;
};
</pre>
   <p>The <a class="idl-code" data-link-type="attribute" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices③">aggregationServices</a> attribute is
a mapping from URLs that identify an <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service④">aggregation service</a> to metadata about
that service:</p>
   <dl>
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionAggregationService" data-dfn-type="dict-member" data-export id="dom-privateattributionaggregationservice-protocol"><code>protocol</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①">DOMString</a></span>
    <dd> The <code class="idl"><a data-link-type="idl" href="#enumdef-privateattributionprotocol" id="ref-for-enumdef-privateattributionprotocol①">protocol</a></code> that the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service⑤">aggregation service</a> uses.
    Different versions of the same protocol use different values.
    Even if a single service provider supports multiple protocols,
    each needs to use a different URL.
    This ensures that each can be uniquely identified by URL
    without also specifying the choice of protocol. 
   </dl>
   <p>The URL is passed as the <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-aggregationservice" id="ref-for-dom-privateattributionconversionoptions-aggregationservice①">aggregationService</a></code> parameter
to <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion⑥">measureConversion()</a> to select the identified aggregation service.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-privateattributionprotocol"><code>PrivateAttributionProtocol</code></dfn> describes the submission protocol
used by different <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service⑥">aggregation services</a>. This document defines two protocols:</p>
   <dl>
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionProtocol" data-dfn-type="enum-value" data-export data-lt="&quot;dap-12-histogram&quot;|dap-12-histogram" id="dom-privateattributionprotocol-dap-12-histogram"><code>dap-12-histogram</code></dfn>
    <dd>A DAP-based protocol <a data-link-type="biblio" href="#biblio-dap" title="Distributed Aggregation Protocol for Privacy Preserving Measurement">[DAP]</a> that uses <a data-link-type="dfn" href="#mpc" id="ref-for-mpc">MPC</a>; see <a href="#s-mpc">§ 7.1 Multi-Party Computation Aggregation</a>.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionProtocol" data-dfn-type="enum-value" data-export data-lt="&quot;tee-00&quot;|tee-00" id="dom-privateattributionprotocol-tee-00"><code>tee-00</code></dfn>
    <dd>A protocol for submission to a <a data-link-type="dfn" href="#tee" id="ref-for-tee">TEE</a>; see <a href="#s-tee">§ 7.2 Trusted Execution Environments</a>.
   </dl>
   <h3 class="heading settled" data-level="3.4" id="save-impression-api"><span class="secno">3.4. </span><span class="content">Saving Impressions</span><a class="self-link" href="#save-impression-api"></a></h3>
   <p>The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression④">saveImpression()</a> method requests
that the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> record an <a data-link-type="dfn" href="#impression" id="ref-for-impression⑧">impression</a> in the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store">impression store</a>.</p>
   <div class="example" id="ex-save-impression">
    <a class="self-link" href="#ex-save-impression"></a> A site that shows an advertisement for an advertiser
  can save an impression. 
    <p>In this case, the site saves the impression directly,
  identifying the advertiser (<code>advertiser.example</code>)
  and including information that is negotiated by the advertiser.
  In the following example,
  this includes the <code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue">matchValue</a></code> value (2)
  that the advertiser might later use to select this advertisement,
  the index of the histogram (<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-histogramindex" id="ref-for-dom-privateattributionimpressionoptions-histogramindex">histogramIndex</a></code> = 3)
  into which to include any attributed value,
  and a retention period (<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays">lifetimeDays</a></code> = 7)
  that is at least as long as the advertiser requires.</p>
<pre class="highlight">navigator<c- p>.</c->privateAttribution<c- p>.</c->saveImpression<c- p>({</c->
  histogramIndex<c- o>:</c-> <c- mf>3</c-><c- p>,</c->
  matchValue<c- o>:</c-> <c- mf>2</c-><c- p>,</c->
  conversionSites<c- o>:</c-> <c- p>[</c-><c- u>"advertiser.example"</c-><c- p>],</c->
  lifetimeDays<c- o>:</c-> <c- mf>7</c-><c- p>,</c->
<c- p>});</c->
</pre>
    <p>Alternatively, an intermediary,
  such as a Supply-Side Platform (SSP) or Demand-Side Platform (DSP),
  might call the same API from an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable" id="ref-for-child-navigable①">iframe</a>.
  Making the same API call from a frame
  results in saving the <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site①">intermediary site</a> identity with the impression.</p>
   </div>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-privateattributionimpressionoptions"><code><c- g>PrivateAttributionImpressionOptions</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-histogramindex" id="ref-for-dom-privateattributionimpressionoptions-histogramindex①"><c- g>histogramIndex</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="0" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue①"><c- g>matchValue</c-></a> = 0;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionimpressionoptions-conversionsites" id="ref-for-dom-privateattributionimpressionoptions-conversionsites"><c- g>conversionSites</c-></a> = [];
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long②"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="30" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays①"><c- g>lifetimeDays</c-></a> = 30;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext③"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateattribution" id="ref-for-privateattribution①"><c- g>PrivateAttribution</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression⑤"><c- g>saveImpression</c-></a>(<a data-link-type="idl-name" href="#dictdef-privateattributionimpressionoptions" id="ref-for-dictdef-privateattributionimpressionoptions"><c- n>PrivateAttributionImpressionOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttribution/saveImpression(options)" data-dfn-type="argument" data-export id="dom-privateattribution-saveimpression-options-options"><code><c- g>options</c-></code></dfn>);
};
</pre>
   <p>The arguments to <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression⑥">saveImpression()</a> are as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionImpressionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionimpressionoptions-histogramindex"><code>histogramIndex</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long③">unsigned long</a></span>
    <dd> If <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion⑦">measureConversion()</a> matches this <a data-link-type="dfn" href="#impression" id="ref-for-impression⑨">impression</a> with a subsequent <a data-link-type="dfn" href="#conversion" id="ref-for-conversion⑤">conversion</a>, the <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value①">conversion value</a> will be added to the histogram bucket identified by this index. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionImpressionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionimpressionoptions-matchvalue"><code>matchValue</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long④">unsigned long</a>, defaulting to <code>0</code></span>
    <dd> An optional piece of metadata associated with the impression. The value
    can be used to identify which impressions may receive attribution
    from a <a data-link-type="dfn" href="#conversion" id="ref-for-conversion⑥">conversion</a>. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionImpressionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionimpressionoptions-conversionsites"><code>conversionSites</code></dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②">USVString</a>>, defaulting to <code>[]</code></span>
    <dd> The sites where <a data-link-type="dfn" href="#conversion" id="ref-for-conversion⑦">conversions</a> for this impression may occur, identified by
    their domain names. The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion⑧">measureConversion()</a> method will only attribute to this impression when called by one of the indicated
    sites. If empty, any site will match. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionImpressionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionimpressionoptions-lifetimedays"><code>lifetimeDays</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long⑤">unsigned long</a>, defaulting to <code>30</code></span>
    <dd> A positive "time to live" (in days) after which the <a data-link-type="dfn" href="#impression" id="ref-for-impression①⓪">impression</a> can no
    longer receive attribution.
    If not specified, the default is 30 days.
    The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②">user agent</a> should impose an upper limit on the lifetime,
    and silently reduce the value specified here if it exceeds that limit. 
   </dl>
   <h3 class="heading settled" data-level="3.5" id="measure-conversion-api"><span class="secno">3.5. </span><span class="content">Requesting Attribution for a Conversion</span><a class="self-link" href="#measure-conversion-api"></a></h3>
   <p>The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion⑨">measureConversion()</a> method
requests that the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③">user agent</a> perform <a data-link-type="dfn" href="#attribution" id="ref-for-attribution④">attribution</a> for a <a data-link-type="dfn" href="#conversion" id="ref-for-conversion⑧">conversion</a>,
and return a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report④">conversion report</a>.</p>
   <p>The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⓪">measureConversion()</a> method
always returns a conversion report,
regardless of whether matching <a data-link-type="dfn" href="#impression" id="ref-for-impression①①">impression(s)</a> are found.
If there is no match, or if <a href="#dp">differential privacy</a> disallows
reporting the attribution, the returned conversion report will not
contribute to the histogram, i.e., will be uniformly zero.</p>
   <div class="example" id="ex-measure-conversion">
    <a class="self-link" href="#ex-measure-conversion"></a> A site that observes a <a data-link-type="dfn" href="#conversion" id="ref-for-conversion⑨">conversion</a> might choose to request the measurement
  of the effect of different <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①">stored</a> <a data-link-type="dfn" href="#impression" id="ref-for-impression①②">impressions</a>. 
    <p>To request the creation of an encrypted measurement,
  the site invokes the <code class="idl"><a data-link-type="idl" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①①">measureConversion()</a></code> method.</p>
    <p>This function takes four different types of input:</p>
    <ol>
     <li data-md>
      <p>The selected aggregation service,
  which is identified using a URL.
  The <a href="#ex-find-service">example process for selecting an aggregation service</a> shows how to select a service that the browser supports.</p>
<pre class="highlight"><c- a>const</c-> serviceDetails <c- o>=</c-> <c- p>{</c->
  aggregationService<c- o>:</c-> serviceUrl<c- p>,</c->
<c- p>};</c->
</pre>
     <li data-md>
      <p>Details of the aggregated measurement.
  These values will be consistent for all invocations of the API
  across multiple browsers.
  This includes the size of the histogram
  and the amount of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②">privacy budget</a> that might have been expended.</p>
<pre class="highlight"><c- a>const</c-> aggregatedMeasurementDetails <c- o>=</c-> <c- p>{</c->
  histogramSize<c- o>:</c-> <c- mf>20</c-><c- p>,</c->
  epsilon<c- o>:</c-> <c- mf>1</c-><c- p>,</c->
<c- p>};</c->
</pre>
     <li data-md>
      <p>A set of attributes,
  all <span class="allow-2119">optional</span>,
  that select the <a data-link-type="dfn" href="#impression" id="ref-for-impression①③">impressions</a> to consider.
  This includes how old impressions can be
  (<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-lookbackdays" id="ref-for-dom-privateattributionconversionoptions-lookbackdays">lookbackDays</a></code>),
  the <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site②">impression sites</a> that might have saved impressions
  (<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-impressionsites" id="ref-for-dom-privateattributionconversionoptions-impressionsites">impressionSites</a></code>),
  the <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site②">intermediary sites</a> that might have saved impressions
  (<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-intermediarysites" id="ref-for-dom-privateattributionconversionoptions-intermediarysites">intermediarySites</a></code>),
  and the choice of <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-matchvalue" id="ref-for-dom-privateattributionconversionoptions-matchvalue">matchValue</a></code>.</p>
<pre class="highlight"><c- a>const</c-> selectionDetails <c- o>=</c-> <c- p>{</c->
  lookbackDays<c- o>:</c-> <c- mf>14</c-><c- p>,</c->
  impressionSites<c- o>:</c-> <c- p>[</c-><c- u>"publisher.example"</c-><c- p>,</c-> <c- u>"other.example"</c-><c- p>],</c->
  intermediarySites<c- o>:</c-> <c- p>[</c-><c- u>"ad-tech.example"</c-><c- p>],</c->
  matchValue<c- o>:</c-> <c- p>[</c-><c- mf>2</c-><c- p>],</c->
<c- p>};</c->
</pre>
     <li data-md>
      <p>The choice of <a data-link-type="dfn" href="#attribution-logic" id="ref-for-attribution-logic">attribution logic</a> that the browser will apply,
  plus any parameters that the logic needs.</p>
<pre class="highlight"><c- a>const</c-> attributionDetails <c- o>=</c-> <c- p>{</c->
  logic<c- o>:</c-> <c- u>"last-touch"</c-><c- p>,</c->
  value<c- o>:</c-> <c- mf>3</c-><c- p>,</c->
  maxValue<c- o>:</c-> <c- mf>7</c-><c- p>,</c->
<c- p>};</c->
</pre>
    </ol>
    <p>Once these values are decided,
  the site invokes the API to obtain an encrypted <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report⑤">conversion report</a>.</p>
<pre class="highlight"><c- a>const</c-> measurement <c- o>=</c-> <c- k>await</c-> navigator<c- p>.</c->privateAttribution<c- p>.</c->measureConversion<c- p>({</c->
  <c- p>...</c->serviceDetails<c- p>,</c->
  <c- p>...</c->aggregatedMeasurementDetails<c- p>,</c->
  <c- p>...</c->selectionDetails<c- p>,</c->
  <c- p>...</c->attributionDetails<c- p>,</c->
<c- p>});</c->
sendReportToServer<c- p>(</c->measurement<c- p>.</c->report<c- p>);</c->
</pre>
    <p>This <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report⑥">report</a> can be collected,
  along with other reports from this browser and other browsers.
  Collected reports can then all be submitted to an <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service⑦">aggregation service</a> to obtain an <a href="#histograms">aggregate histogram</a>.</p>
   </div>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-privateattributionconversionoptions"><code><c- g>PrivateAttributionConversionOptions</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString" href="#dom-privateattributionconversionoptions-aggregationservice" id="ref-for-dom-privateattributionconversionoptions-aggregationservice②"><c- g>aggregationService</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <a class="idl-code" data-default="1.0" data-link-type="dict-member" data-type="double" href="#dom-privateattributionconversionoptions-epsilon" id="ref-for-dom-privateattributionconversionoptions-epsilon"><c- g>epsilon</c-></a> = 1.0;

  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long⑥"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-histogramsize" id="ref-for-dom-privateattributionconversionoptions-histogramsize"><c- g>histogramSize</c-></a>;

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long⑦"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-lookbackdays" id="ref-for-dom-privateattributionconversionoptions-lookbackdays①"><c- g>lookbackDays</c-></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long⑧"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<unsigned long>" href="#dom-privateattributionconversionoptions-matchvalue" id="ref-for-dom-privateattributionconversionoptions-matchvalue①"><c- g>matchValue</c-></a> = [];
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence②"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString④"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionconversionoptions-impressionsites" id="ref-for-dom-privateattributionconversionoptions-impressionsites①"><c- g>impressionSites</c-></a> = [];
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence③"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑤"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionconversionoptions-intermediarysites" id="ref-for-dom-privateattributionconversionoptions-intermediarysites①"><c- g>intermediarySites</c-></a> = [];

  <a data-link-type="idl-name" href="#enumdef-privateattributionlogic" id="ref-for-enumdef-privateattributionlogic"><c- n>PrivateAttributionLogic</c-></a> <a class="idl-code" data-default="&quot;last-touch&quot;" data-link-type="dict-member" data-type="PrivateAttributionLogic" href="#dom-privateattributionconversionoptions-logic" id="ref-for-dom-privateattributionconversionoptions-logic"><c- g>logic</c-></a> = "last-touch";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long⑨"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="1" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-value" id="ref-for-dom-privateattributionconversionoptions-value"><c- g>value</c-></a> = 1;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①⓪"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="1" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue"><c- g>maxValue</c-></a> = 1;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-privateattributionlogic"><code><c- g>PrivateAttributionLogic</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionLogic" data-dfn-type="enum-value" data-export id="dom-privateattributionlogic-last-touch"><code><c- s>"last-touch"</c-></code></dfn>,
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-privateattributionconversionresult"><code><c- g>PrivateAttributionConversionResult</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-Uint8Array" id="ref-for-idl-Uint8Array"><c- b>Uint8Array</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionResult" data-dfn-type="dict-member" data-export data-type="Uint8Array" id="dom-privateattributionconversionresult-report"><code><c- g>report</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext④"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateattribution" id="ref-for-privateattribution②"><c- g>PrivateAttribution</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-privateattributionconversionresult" id="ref-for-dictdef-privateattributionconversionresult"><c- n>PrivateAttributionConversionResult</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①②"><c- g>measureConversion</c-></a>(<a data-link-type="idl-name" href="#dictdef-privateattributionconversionoptions" id="ref-for-dictdef-privateattributionconversionoptions①"><c- n>PrivateAttributionConversionOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttribution/measureConversion(options)" data-dfn-type="argument" data-export id="dom-privateattribution-measureconversion-options-options"><code><c- g>options</c-></code></dfn>);
};
</pre>
   <p>The arguments to <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①③">measureConversion()</a> are as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-aggregationservice"><code>aggregationService</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑥">USVString</a></span>
    <dd> A selection from the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service⑧">aggregation services</a> that can be found in <a class="idl-code" data-link-type="attribute" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices④">aggregationServices</a>. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-epsilon"><code>epsilon</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①">double</a>, defaulting to <code>1.0</code></span>
    <dd>The amount of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets③">privacy budget</a> to expend on this <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report⑦">conversion report</a>.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-histogramsize"><code>histogramSize</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①①">unsigned long</a></span>
    <dd>The number of histogram buckets to use in the <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report⑧">conversion report</a>.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-lookbackdays"><code>lookbackDays</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①②">unsigned long</a></span>
    <dd>A positive integer number of days. Only impressions occurring within the past <code>lookbackDays</code> may match this <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①⓪">conversion</a>. If omitted, it is equivalent to an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> maximum.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-matchvalue"><code>matchValue</code></dfn>, <span> of type <code class="idl-code">sequence&lt;unsigned long></code>, defaulting to <code>[]</code></span>
    <dd>A match value that can be used to select this <a data-link-type="dfn" href="#impression" id="ref-for-impression①④">impression</a>.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-impressionsites"><code>impressionSites</code></dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑦">USVString</a>>, defaulting to <code>[]</code></span>
    <dd>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets">set</a> of impression sites. Only <a data-link-type="dfn" href="#impression" id="ref-for-impression①⑤">impressions</a> recorded where the <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site③">impression site</a> is in this set are eligible to match this <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①①">conversion</a>. If empty, any site will match.
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-intermediarysites"><code>intermediarySites</code></dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑧">USVString</a>>, defaulting to <code>[]</code></span>
    <dd> A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets①">set</a> of sites which called the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression⑦">saveImpression()</a> API.
    Only <a data-link-type="dfn" href="#impression" id="ref-for-impression①⑥">impressions</a> recorded by scripts originating from one of the <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site③">intermediary sites</a> are eligible to match this <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①②">conversion</a>. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-logic"><code>logic</code></dfn>, <span> of type <a data-link-type="idl-name" href="#enumdef-privateattributionlogic" id="ref-for-enumdef-privateattributionlogic①">PrivateAttributionLogic</a>, defaulting to <code>"last-touch"</code></span>
    <dd> A selection from <a class="idl-code" data-link-type="enum" href="#enumdef-privateattributionlogic" id="ref-for-enumdef-privateattributionlogic②">PrivateAttributionLogic</a> indicating the <a data-link-type="dfn" href="#attribution-logic" id="ref-for-attribution-logic①">attribution logic</a> to use. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-value"><code>value</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①③">unsigned long</a>, defaulting to <code>1</code></span>
    <dd> The <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value②">conversion value</a>. If an attribution is made and <a href="#dp">privacy</a> restrictions are satisfied, this value will be encoded into the <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report⑨">conversion report</a>. 
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttributionConversionOptions" data-dfn-type="dict-member" data-export id="dom-privateattributionconversionoptions-maxvalue"><code>maxValue</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①④">unsigned long</a>, defaulting to <code>1</code></span>
    <dd> The maximum <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value③">conversion value</a> across all contributions included in the aggregation.
    Together with epsilon, this is used to calibrate the distribution of random noise that
    will be added to the outcome. It is also used to determine the amount of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets④">privacy budget</a> to expend on this <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⓪">conversion report</a>. 
   </dl>
   <h3 class="heading settled" data-level="3.6" id="permission-policy"><span class="secno">3.6. </span><span class="content">Permissions Policy Integration</span><a class="self-link" href="#permission-policy"></a></h3>
   <p>This specification defines two <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled features</a>:</p>
   <ul>
    <li data-md>
     <p>Invocation of the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression⑧">saveImpression()</a> API,
identified by the string "<code><dfn class="dfn-paneled idl-code" data-dfn-for="PermissionPolicy" data-dfn-type="enum-value" data-export id="dom-permissionpolicy-save-impression"><code>save-impression</code></dfn></code>".</p>
    <li data-md>
     <p>Invocation of the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①④">measureConversion()</a> API,
identified by the string "<code><dfn class="dfn-paneled idl-code" data-dfn-for="PermissionPolicy" data-dfn-type="enum-value" data-export id="dom-permissionpolicy-measure-conversion"><code>measure-conversion</code></dfn></code>".</p>
   </ul>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist">default allowlist</a> for both of these features is <code><a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#default-allowlist" id="ref-for-default-allowlist">*</a></code>.</p>
   <p class="note" role="note">Having separate permissions for <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression⑨">saveImpression()</a> and <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⑤">measureConversion()</a> allows pages that do both to limit subresources
to the expected kind of activity. </p>
   <p class="note" role="note">Enabling permissions by default
simplifies the task of integrating external services. </p>
   <p class="note" role="note">Permissions policy provides only all-or-nothing control;
it does not enable delegation of a portion of privacy budget. </p>
   <h2 class="heading settled" data-level="4" id="api-internals"><span class="secno">4. </span><span class="content">API Internals</span><a class="self-link" href="#api-internals"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="s-impression-store"><span class="secno">4.1. </span><span class="content">Impression Store</span><a class="self-link" href="#s-impression-store"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="impression-store">impression store</dfn> is used by the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⑥">measureConversion()</a> method to find matching <a data-link-type="dfn" href="#impression" id="ref-for-impression①⑦">impressions</a>.</p>
   <p class="note" role="note"> Though this API enables the storage of data by sites,
the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store②">impression store</a> does not use a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key" id="ref-for-storage-key">storage key</a>. </p>
   <h4 class="heading settled" data-level="4.1.1" id="impression-store-contents"><span class="secno">4.1.1. </span><span class="content">Contents</span><a class="self-link" href="#impression-store-contents"></a></h4>
   <p>The <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store③">impression store</a> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets②">set</a> of <a data-link-type="dfn" href="#impression" id="ref-for-impression①⑧">impressions</a>:</p>
   <div data-link-for-hint="PrivateAttribution">
    <table class="def">
     <tbody>
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-match-value">Match Value</dfn>
       <td>The <code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue②">matchValue</a></code> passed to <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⓪">saveImpression()</a>.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-impression-site">Impression Site</dfn>
       <td>The <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site④">impression site</a> where <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①①">saveImpression()</a> was called.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-intermediary-site">Intermediary Site</dfn>
       <td>The <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site④">intermediary site</a> that called <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①②">saveImpression()</a>,
or <code>undefined</code> if the API was invoked by the <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site⑤">impression site</a>.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-conversion-sites">Conversion Sites</dfn>
       <td>The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets③">set</a> of <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site②">conversion sites</a> that were passed to <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①③">saveImpression()</a>.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-timestamp">Timestamp</dfn>
       <td>The time at which <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①④">saveImpression()</a> was called.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-lifetime">Lifetime</dfn>
       <td>The number of days an <a data-link-type="dfn" href="#impression" id="ref-for-impression①⑨">impression</a> remains eligible for attribution, either from the call to <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⑤">saveImpression()</a>, or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④">user agent</a>-defined limit.
      <tr>
       <th><dfn class="dfn-paneled" data-dfn-for="impression" data-dfn-type="dfn" data-noexport id="impression-histogram-index">Histogram Index</dfn>
       <td>The histogram index passed to <a data-link-type="functionish" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⑥">saveImpression()</a>.
    </table>
   </div>
   <h4 class="heading settled" data-level="4.1.2" id="impression-store-maintenance"><span class="secno">4.1.2. </span><span class="content">Maintenance</span><a class="self-link" href="#impression-store-maintenance"></a></h4>
   <p>The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑤">user agent</a> should periodically use
the <a data-link-type="dfn" href="#impression-timestamp" id="ref-for-impression-timestamp">timestamp</a> and <a data-link-type="dfn" href="#impression-lifetime" id="ref-for-impression-lifetime">lifetime</a> values
to identify and delete any <a data-link-type="dfn" href="#impression" id="ref-for-impression②⓪">impressions</a> in the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store④">impression store</a> that have expired.</p>
   <p>It is not necessary to remove <a data-link-type="dfn" href="#impression" id="ref-for-impression②①">impressions</a> immediately upon expiry,
as long as <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⑦">measureConversion()</a> excludes expired <a data-link-type="dfn" href="#impression" id="ref-for-impression②②">impressions</a> from <a data-link-type="dfn" href="#attribution" id="ref-for-attribution⑤">attribution</a>. However, the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑥">user agent</a> should not retain expired <a data-link-type="dfn" href="#impression" id="ref-for-impression②③">impressions</a> indefinitely.</p>
   <h4 class="heading settled" data-level="4.1.3" id="impression-store-clear"><span class="secno">4.1.3. </span><span class="content"><code>Clear-Site-Data</code> Integration</span><a class="self-link" href="#impression-store-clear"></a></h4>
   <p>The `<code><a data-link-type="http-header" href="https://w3c.github.io/webappsec-clear-site-data/#http-headerdef-clear-site-data" id="ref-for-http-headerdef-clear-site-data">Clear-Site-Data</a></code>` field <a data-link-type="biblio" href="#biblio-clear-site-data" title="Clear Site Data">[CLEAR-SITE-DATA]</a> gives sites the ability to remove state maintained by a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑦">user agent</a>.
The `<code>"impressions"</code>` type is added to the list of recognized types,
defined in <a href="https://w3c.github.io/webappsec-clear-site-data/#header"><cite>Clear Site Data</cite> § 3.1 The Clear-Site-Data HTTP Response Header Field</a>.</p>
   <p>When the <a href="https://w3c.github.io/webappsec-clear-site-data/#clear-response">clear site data for response</a> algorithm is invoked,
if the list of types <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contains</a> `<code>"impressions"</code>`,
the <a data-link-type="dfn" href="#clear-impressions-for-a-conversion-site" id="ref-for-clear-impressions-for-a-conversion-site">clear impressions for a conversion site</a> is invoked,
passing the <var>origin</var>.</p>
   <div class="algorithm" data-algorithm="clear impressions for a conversion site">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="clear-impressions-for-a-conversion-site">clear impressions for a conversion site</dfn>,
given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin③">origin</a> <var>origin</var>,
run these steps: 
    <ol>
     <li data-md>
      <p>If <var>origin</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple">tuple origin</a> with a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin-scheme" id="ref-for-concept-origin-scheme">scheme</a> of <code>https</code>,
return.</p>
     <li data-md>
      <p>Let <var>site</var> be the value returned
by invoking <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">obtain a registrable domain</a>,
passing the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin-host" id="ref-for-concept-origin-host">host</a> part of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple①">origin tuple</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <a data-link-type="dfn" href="#impression" id="ref-for-impression②④">impression</a> <var>impression</var> of
the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store⑤">impression store</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>impression</var> has an <a data-link-type="dfn" href="#impression-intermediary-site" id="ref-for-impression-intermediary-site">Intermediary Site</a> equal to <var>site</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">remove</a> <var>impression</var> from the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store⑥">impression store</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If <var>impression</var> has a <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites">Conversion Sites</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets④">set</a> that does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contain</a> the value <var>site</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> of <var>impression</var>’s <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites①">Conversion Sites</a> is greater than one, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">remove</a> <var>site</var> from <var>impression</var>’s <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites②">Conversion Sites</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove②">remove</a> <var>impression</var> from the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store⑦">impression store</a>.</p>
      </ol>
    </ol>
    <p class="note" role="note">This process does not remove impressions
that are saved with an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets⑤">set</a> of <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites③">Conversion Sites</a>. </p>
   </div>
   <h4 class="heading settled" data-level="4.1.4" id="site-name-algorithm"><span class="secno">4.1.4. </span><span class="content">Site Names</span><a class="self-link" href="#site-name-algorithm"></a></h4>
   <p>The <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store⑧">impression store</a> saves information
about three types of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site⑥">site</a>:
the <a data-link-type="dfn" href="#impression-impression-site" id="ref-for-impression-impression-site">impression site</a>,
an optional <a data-link-type="dfn" href="#impression-intermediary-site" id="ref-for-impression-intermediary-site①">intermediary site</a>,
and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets⑥">set</a> of <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites④">conversion sites</a>.</p>
   <p>These <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site⑦">sites</a> MUST all be in <a data-link-type="dfn" href="https://html.spec.whatwg.org/#scheme-and-host" id="ref-for-scheme-and-host">scheme-and-host</a> form,
with a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin-scheme" id="ref-for-concept-origin-scheme①">scheme</a> of "<code>https</code>".
This means that a simple string serialization of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin-host" id="ref-for-concept-origin-host①">host</a> is sufficient to identify the site.
The API is therefore able to use a simple <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> to represent <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site⑧">sites</a>.</p>
   <p class="note" role="note"> It is also possible for an implementation to internally represent sites
using just the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin-host" id="ref-for-concept-origin-host②">host</a> part of the tuple. </p>
   <div class="algorithm" data-algorithm="parse a site">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-a-site">parse a site</dfn>,
returning either <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site⑨">site</a> or failure,
given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> <var>input</var>,
run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>host</var> be the value returned by invoking <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-host-parser" id="ref-for-concept-host-parser">host parser</a>,
passing <var>input</var>.</p>
     <li data-md>
      <p>If <var>host</var> is failure, return failure.</p>
     <li data-md>
      <p>Let <var>site</var> be the value returned by <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①">obtain a registrable domain</a>,
passing <var>host</var>.</p>
     <li data-md>
      <p>If <var>site</var> is null, return failure.</p>
     <li data-md>
      <p>Return a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#scheme-and-host" id="ref-for-scheme-and-host①">scheme-and-host</a> tuple of ("<code>https</code>", <var>site</var>).</p>
    </ol>
    <p class="note" role="note"> This algorithm successfully produces a site from strings
that contain more <a data-link-type="dfn" href="https://url.spec.whatwg.org/#domain-label" id="ref-for-domain-label">domain labels</a> than the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain②">registrable domain</a>.
For example, "<code>extra.example.com</code>" is parsed as "<code>example.com</code>". </p>
   </div>
   <h3 class="heading settled" data-level="4.2" id="privacy-state"><span class="secno">4.2. </span><span class="content">State For Privacy Budget Management</span><a class="self-link" href="#privacy-state"></a></h3>
   <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑧">User agents</a> maintain three pieces of state
that are used to manage the expenditure of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets⑤">privacy budgets</a>:</p>
   <ul>
    <li data-md>
     <p>The <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①">privacy budget store</a> records the state
of the per-<a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⓪">site</a> and per-<a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch">epoch</a> <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets⑥">privacy budgets</a>.
It is updated by <a data-link-type="dfn" href="#deduct-privacy-budget" id="ref-for-deduct-privacy-budget">deduct privacy budget</a>.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store">epoch start store</a> records when each <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①">epoch</a> starts
for <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site③">conversion sites</a>.
This store is initialized as a side effect
of invoking <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⑧">measureConversion()</a>.</p>
    <li data-md>
     <p>A singleton <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear">last browsing history clear</a> value
that tracks when the browsing activity for a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①①">site</a> was last cleared.</p>
   </ul>
   <p class="note" role="note"> Like the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store⑨">impression store</a>,
the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store②">privacy budget store</a> does not use a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key" id="ref-for-storage-key①">storage key</a>.
These stores have some additional constraints
on how information is cleared;
see <a href="#clear-budget-store">§ 10.6 Clearing API State</a> for details. </p>
   <p class="issue" id="issue-03c18889"><a class="self-link" href="#issue-03c18889"></a> The <a data-link-type="dfn" href="#safety-limits" id="ref-for-safety-limits">safety limits</a> need to be described in more detail.
Some references to clearing
the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⓪">impression store</a> may need to be
updated to refer to the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store③">privacy budget store</a> as well. </p>
   <h4 class="heading settled" data-level="4.2.1" id="s-privacy-budget-store"><span class="secno">4.2.1. </span><span class="content">Privacy Budget Store</span><a class="self-link" href="#s-privacy-budget-store"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="privacy-budget-store">privacy budget store</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> whose keys are <a data-link-type="dfn" href="#privacy-budget-key" id="ref-for-privacy-budget-key">privacy budget keys</a> and whose values are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#32-bit-unsigned-integer" id="ref-for-32-bit-unsigned-integer">32-bit unsigned integers</a>.
These <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#32-bit-unsigned-integer" id="ref-for-32-bit-unsigned-integer①">integers</a> store a value
in units <a data-link-type="dfn" href="#microepsilon" id="ref-for-microepsilon">microepsilons</a>.
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="microepsilon">microepsilon</dfn> is one-millionth of the unitary epsilon value
used in differential privacy <a data-link-type="biblio" href="#biblio-dp" title="The Algorithmic Foundations of Differential Privacy">[DP]</a>.</p>
   <p class="note" role="note">The choice of a 32-bit integer restricts the setting of epsilon to be less than 4295.
This <span class="allow-2119">should</span> be more than sufficient for implementations. </p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="privacy-budget-key">privacy budget key</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> consisting of the following items:</p>
   <dl>
    <dt data-md><dfn data-var-ignore>epoch index</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index">epoch index</a></p>
    <dt data-md><dfn data-var-ignore>site</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①②">site</a></p>
   </dl>
   <div class="algorithm" data-algorithm="deduct privacy budget">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="deduct-privacy-budget">deduct privacy budget</dfn> given a <a data-link-type="dfn" href="#privacy-budget-key" id="ref-for-privacy-budget-key①">privacy budget key</a> <var>key</var>, <a href="https://webidl.spec.whatwg.org/#idl-double" id="a38011ce0">double</a> <var>epsilon</var>,
integer <var>sensitivity</var>,
and integer <var>globalSensitivity</var>: 
    <ol>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store④">privacy budget store</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contain</a> <var>key</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">set</a> its value of <var>key</var> to be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑨">user agent</a>-defined value,
plus 1000.</p>
      <p class="note" role="note">The addition of 1000 to this value
ensures that the rounding errors added by this algorithm do not cause
the budget to be exceeded unnecessarily after multiple invocations.
The privacy loss from the additional one-thousandth of an epsilon is trivial. </p>
     <li data-md>
      <p>Let <var>currentValue</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get">getting the value</a> of <var>key</var> in the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store⑤">privacy budget store</a>.</p>
     <li data-md>
      <p>Let <var>deductionFp</var> be <var>epsilon</var> * <var>sensitivity</var> / <var>globalSensitivity</var>.</p>
     <li data-md>
      <p>If <var>deductionFp</var> is negative or greater than 4294, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">set</a> the value of <var>key</var> in the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store⑥">privacy budget store</a> to 0
and return false.</p>
     <li data-md>
      <p>Let <var>deduction</var> be <var>deductionFp</var> * 1000000, rounded towards positive Infinity.</p>
     <li data-md>
      <p>If <var>deduction</var> is greater than <var>currentValue</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> the value of <var>key</var> in the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store⑦">privacy budget store</a> to 0
and return false.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> the value of <var>key</var> in the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store⑧">privacy budget store</a> to <var>currentValue</var> − <var>deduction</var> and return true.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.2.2" id="s-epoch-start"><span class="secno">4.2.2. </span><span class="content">Epoch Start Store</span><a class="self-link" href="#s-epoch-start"></a></h4>
   <p>An <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②">epoch</a> starts at a randomly-selected time
for each <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site④">conversion site</a>.
This ensures that any bias in aggregates
that arises from a <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets⑦">privacy budget</a> reaching zero
is averaged across all the contributions from all <a data-link-type="dfn" href="https://drafts.csswg.org/css-2024/#user" id="ref-for-user">users</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="epoch-start-store">epoch start store</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> keyed by <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①③">site</a> and contains values that are <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moments</a> from the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock">wall clock</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="epoch" data-noexport id="privacy-budget-epoch">privacy budget epoch</dfn> (or <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③">epoch</a>)
identifies a period of time.
The length of an <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④">epoch</a> is fixed at one week or 7 <a data-link-type="dfn" href="#day" id="ref-for-day">days</a>,
where a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="day">day</dfn> is defined as 86400 seconds.</p>
   <p>The exact time span for an <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch⑤">epoch</a> is different
for each combination of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⓪">user agent</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①④">site</a>.
The start time for a given pair of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①①">user agent</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⑤">site</a> is chosen randomly by the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①②">user agent</a> when an epoch is first needed—​as a side effect of invoking the <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch">get the current epoch</a> algorithm.
The <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch⑥">epochs</a> for a given <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⑥">site</a> will change
if the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①③">user agent</a> clears browsing history;
see <a href="#clear-browsing-history">§ 10.6.2 Clearing Browsing History</a>.</p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="epoch indices" data-noexport id="epoch-index">epoch index</dfn> is an integer
that refers to a given <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch⑦">epoch</a>.
An <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index①">epoch index</a> is used to access
the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①①">impression</a> and <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store①">epoch start</a> stores.</p>
   <div class="note" role="note">
     In the same way that a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment①">moment</a> is an abstract concept
that can only be expressed as a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration">duration</a> relative to another <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment②">moment</a>, <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch⑧">epochs</a> are abstract. 
    <p><a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index②">Epoch indices</a> are stored as integers
relative to a set reference point.
The <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index③">epoch indices</a> in this specification
use the values from the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store②">epoch start store</a> as a reference point.
A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①④">user agent</a> could choose to use a different <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment③">moment</a> to indicate a "zero" or reference <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch⑨">epoch</a>.</p>
   </div>
   <p>The algorithms in this specification all use concrete <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index④">epoch indices</a>,
rather than the more abstract <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⓪">epoch</a>. <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment④">Points in time</a> are translalated to an <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index⑤">epoch index</a> for the corresponding <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①①">epoch</a> using the <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch①">get the current epoch</a> algoritm.</p>
   <div class="algorithm" data-algorithm="get the current epoch">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-current-epoch">get the current epoch</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⑦">site</a> <var>site</var>,
and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑤">moment</a> <var>t</var>,
returning an <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index⑥">epoch index</a>: 
    <ol>
     <li data-md>
      <p>Let <var>period</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①">duration</a> of one <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①②">epoch</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store③">epoch start store</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">contain</a> <var>site</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set④">set</a> its value to <var>t</var>, minus a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration②">duration</a> that is randomly selected
from between 0 (inclusive) and <var>period</var> (exclusive).</p>
     <li data-md>
      <p>Let <var>start</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-get" id="ref-for-map-get①">getting the value</a> of <var>site</var> from the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store④">epoch start store</a>.</p>
     <li data-md>
      <p>Let <var>elapsed</var> be (<var>t</var> - <var>start</var>) / <var>period</var>.</p>
     <li data-md>
      <p>Return <var>elapsed</var> as an integer, rounded towards negative Infinity.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.2.3" id="last-clear"><span class="secno">4.2.3. </span><span class="content">Last Browsing History Clear Time</span><a class="self-link" href="#last-clear"></a></h4>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="last-browsing-history-clear">last browsing history clear</dfn> is a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑥">moment</a> using the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock①">wall clock</a> that tracks when browsing history was last cleared.
The <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear①">last browsing history clear</a> value is updated
to the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time">current coarsened wall time</a> when any <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⑧">site</a>-level state is cleared
at the request of a <a data-link-type="dfn" href="https://drafts.csswg.org/css-2024/#user" id="ref-for-user①">user</a>.
The value is initially unset.</p>
   <p>As an optional optimization,
updating the <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear②">last browsing history clear</a> can be skipped if
all of the following are true:</p>
   <ul>
    <li data-md>
     <p>All interactions that are cleared are with <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site①⑨">sites</a> that have other uncleared interactions.</p>
    <li data-md>
     <p>All cleared interactions occurring during <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①③">epochs</a> where other interactions with the same <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⓪">site</a> were retained.</p>
    <li data-md>
     <p>All affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②①">sites</a> have a value in the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store⑤">epoch start store</a>.</p>
   </ul>
   <p>If all three conditions are true,
the <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear③">last browsing history clear</a> does not need to be updated.
Instead, the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store⑨">privacy budget store</a> must be updated
by <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑤">setting</a> a value of 0
for all <a data-link-type="dfn" href="#privacy-budget-key" id="ref-for-privacy-budget-key②">privacy budget key</a> combinations that can be formed
from every affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②②">site</a> and <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①④">epoch</a> (using the <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch②">corresponding</a> <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index⑦">epoch index</a>).</p>
   <p class="note" role="note"> This optimization relies on the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⑤">user agent</a> having retained information
about interactions with affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②③">sites</a> in the affected <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⑤">epochs</a>.
This only works because any of the retained interactions
could have resulted in exhausting the budget.
Resetting the budget is necessary to ensure
that no information about the gap in browsing history
is exposed. </p>
   <div class="algorithm" data-algorithm="get the starting epoch for attribution">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-starting-epoch-for-attribution">get the starting epoch for attribution</dfn> given <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②④">site</a> <var>site</var>,
returning an <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index⑧">epoch index</a>: 
    <ol>
     <li data-md>
      <p>Let <var>startEpoch</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⑥">user agent</a>-defined value
for the earliest <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index⑨">epoch index</a> that is supported for attribution.</p>
      <p class="note" role="note"> This value is not a constant <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index①⓪">epoch index</a>.
A value is chosen for each site
based on <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⑦">user agent</a> preferences or configuration. </p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear④">last browsing history clear</a> is set,
perform the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>clearEpoch</var> be the result of <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch③">get the current epoch</a> with <var>site</var> and the value of <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear⑤">last browsing history clear</a>.</p>
        <p class="note" role="note"> This use of <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch④">get the current epoch</a> can return a negative value.
This is because the value in <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store⑥">epoch start store</a> is likely to be set to a time after history was last cleared. </p>
       <li data-md>
        <p>Set <var>clearEpoch</var> to <var>clearEpoch</var> + 2.</p>
        <p class="note" role="note"> Adding <em>two</em> is necessary so that the <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⑥">epoch</a> does not overlap with an <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⑦">epoch</a> before browsing history—​and the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store⑦">epoch start store</a>—​was cleared. </p>
       <li data-md>
        <p>If <var>clearEpoch</var> is greater than <var>startEpoch</var>,
return <var>clearEpoch</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>startEpoch</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.3" id="save-impression-api-operation"><span class="secno">4.3. </span><span class="content">Save Impression Algorithm</span><a class="self-link" href="#save-impression-api-operation"></a></h3>
   <div class="algorithm" data-algorithm="saveImpression(options)" data-algorithm-for="PrivateAttribution">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttribution" data-dfn-type="method" data-export id="dom-privateattribution-saveimpression"><code>saveImpression(<var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>settings</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>.</p>
     <li data-md>
      <p>Collect the implicit API inputs from <var>settings</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>timestamp</var> be <var>settings</var>’ <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time">current wall time</a>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site⑥">impression site</a> <var>site</var> is set to the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#obtain-a-site" id="ref-for-obtain-a-site">obtaining a site</a> from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin②">top-level origin</a>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site⑤">intermediary site</a> <var>intermediarySite</var> is set to</p>
        <ol>
         <li data-md>
          <p>a value of <code>undefined</code> if the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin④">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site②">same site</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin③">top-level origin</a>,</p>
         <li data-md>
          <p>otherwise, the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#obtain-a-site" id="ref-for-obtain-a-site①">obtaining a site</a> from <var>settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Validate the page-supplied API inputs:</p>
      <ol>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays②">lifetimeDays</a></code> is 0,
throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code>.</p>
       <li data-md>
        <p>Clamp <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays③">lifetimeDays</a></code> to
the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⑧">user agent</a>’s upper limit.</p>
       <li data-md>
        <p>Let <var>conversionSites</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets⑦">set</a> that is the result
of invoking <a data-link-type="dfn" href="#parse-a-site" id="ref-for-parse-a-site">parse a site</a> for each value in <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-conversionsites" id="ref-for-dom-privateattributionimpressionoptions-conversionsites①">conversionSites</a></code>.</p>
       <li data-md>
        <p>If any result in <var>conversionSites</var> is failure, return <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#syntaxerror" id="ref-for-syntaxerror">SyntaxError</a></code>.</p>
      </ol>
     <li data-md>
      <p>If the Private Attribution API is <a href="#opt-out">disabled</a>, return.</p>
     <li data-md>
      <p>Construct <var>impression</var> as a <a data-link-type="dfn" href="#impression" id="ref-for-impression②⑤">saved impression</a> comprising:</p>
      <ul>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-match-value" id="ref-for-impression-match-value">Match Value</a> set to <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue③">matchValue</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-impression-site" id="ref-for-impression-impression-site①">Impression Site</a> set to <var>site</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-intermediary-site" id="ref-for-impression-intermediary-site②">Intermediary Site</a> set to <var>intermediarySite</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites⑤">Conversion Sites</a> set to <var>conversionSites</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-timestamp" id="ref-for-impression-timestamp①">Timestamp</a> set to <var>timestamp</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-lifetime" id="ref-for-impression-lifetime①">Lifetime</a> set to <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays④">lifetimeDays</a></code>,
multiplied by a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration③">duration</a> of one day.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#impression-histogram-index" id="ref-for-impression-histogram-index">Histogram Index</a> set to <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-histogramindex" id="ref-for-dom-privateattributionimpressionoptions-histogramindex②">histogramIndex</a></code>.</p>
      </ul>
     <li data-md>
      <p>Save <var>impression</var> to the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①②">impression store</a>.</p>
    </ol>
    <p class="advisement"><a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⑦">saveImpression()</a> does not return a status indicating whether the impression was recorded.
This minimizes the ability to detect when the Private Attribution
API is <a href="#opt-out">disabled</a>. </p>
   </div>
   <h3 class="heading settled" data-level="4.4" id="measure-conversion-api-operation"><span class="secno">4.4. </span><span class="content">Measure Conversion Algorithm</span><a class="self-link" href="#measure-conversion-api-operation"></a></h3>
   <p>The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion①⑨">measureConversion()</a> method completes
asynchronously, queuing work on the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="private-attribution-task-source">Private Attribution <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a></dfn>.</p>
   <div class="algorithm" data-algorithm="measureConversion(options)" data-algorithm-for="PrivateAttribution">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAttribution" data-dfn-type="method" data-export id="dom-privateattribution-measureconversion"><code>measureConversion(<var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>realm</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant realm</a>.</p>
     <li data-md>
      <p>Let <var>settings</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>.</p>
     <li data-md>
      <p>Collect the implicit API inputs from <var>settings</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>now</var> be <var>settings</var>’ <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-eso-current-wall-time" id="ref-for-dfn-eso-current-wall-time①">current wall time</a>.</p>
       <li data-md>
        <p>Let <var>topLevelSite</var> (the <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site⑤">conversion site</a>) be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#obtain-a-site" id="ref-for-obtain-a-site②">obtaining a site</a> from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin④">top-level origin</a>.</p>
       <li data-md>
        <p>The <a data-link-type="dfn" href="#intermediary-site" id="ref-for-intermediary-site⑥">intermediary site</a> is set to</p>
        <ol>
         <li data-md>
          <p>a value of <code>undefined</code> if the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin⑤">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site③">same site</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin⑤">top-level origin</a>,</p>
         <li data-md>
          <p>otherwise, the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#obtain-a-site" id="ref-for-obtain-a-site③">obtaining a site</a> from <var>settings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Validate <var>options</var>:</p>
      <ol>
       <li data-md>
        <p>If <a class="idl-code" data-link-type="attribute" href="#dom-privateattribution-aggregationservices" id="ref-for-dom-privateattribution-aggregationservices⑤">aggregationServices</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">contain</a> an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-entry" id="ref-for-map-entry">entry</a> with a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">key</a> of <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-aggregationservice" id="ref-for-dom-privateattributionconversionoptions-aggregationservice③">aggregationService</a></code>,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-referenceerror" id="ref-for-exceptiondef-referenceerror">ReferenceError</a></code> in <var>realm</var>.</p>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-epsilon" id="ref-for-dom-privateattributionconversionoptions-epsilon①">epsilon</a></code> is less than or equal to 0 or is greater than 4294,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror①">RangeError</a></code> in <var>realm</var>.</p>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-histogramsize" id="ref-for-dom-privateattributionconversionoptions-histogramsize①">histogramSize</a></code> is 0 or greater than an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> maximum value,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror②">RangeError</a></code> in <var>realm</var>.</p>
       <li data-md>
        <p>Switch on the value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionconversionoptions-logic" id="ref-for-dom-privateattributionconversionoptions-logic①">logic</a>:</p>
        <dl class="switch">
         <dt data-md><a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionlogic-last-touch" id="ref-for-dom-privateattributionlogic-last-touch">"last-touch"</a>
         <dd data-md>
          <p>Perform the following steps:</p>
          <ol>
           <li data-md>
            <p>If <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionconversionoptions-value" id="ref-for-dom-privateattributionconversionoptions-value①">value</a> is 0,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror③">RangeError</a></code> in <var>realm</var>.</p>
           <li data-md>
            <p>If <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionconversionoptions-value" id="ref-for-dom-privateattributionconversionoptions-value②">value</a> is greater than <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue①">maxValue</a>,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with④">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror④">RangeError</a></code> in <var>realm</var>.</p>
          </ol>
        </dl>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-lookbackdays" id="ref-for-dom-privateattributionconversionoptions-lookbackdays②">lookbackDays</a></code> is 0,
return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑤">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror⑤">RangeError</a></code> in <var>realm</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a> in <var>realm</var>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>report</var> be the result of invoking <a data-link-type="dfn" href="#create-an-all-zero-histogram" id="ref-for-create-an-all-zero-histogram">create an all-zero histogram</a> with <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-histogramsize" id="ref-for-dom-privateattributionconversionoptions-histogramsize②">histogramSize</a></code>.</p>
       <li data-md>
        <p>If the Private Attribution API is <a href="#opt-out">enabled</a>, set <var>report</var> to the
 result of <a data-link-type="dfn" href="#do-attribution-and-fill-a-histogram" id="ref-for-do-attribution-and-fill-a-histogram">do attribution and fill a histogram</a> with <var>options</var>, <var>topLevelSite</var>, and <var>now</var>.</p>
       <li data-md>
        <p>Let <var>encryptedReport</var> be the result of encrypting <var>report</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> on the <a data-link-type="dfn" href="#private-attribution-task-source" id="ref-for-private-attribution-task-source">Private Attribution task source</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">resolve</a> <var>promise</var> with <var>encryptedReport</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.4.1" id="s-logic"><span class="secno">4.4.1. </span><span class="content">Attribution Logic</span><a class="self-link" href="#s-logic"></a></h4>
   <p>A site that measures conversions can specify <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attribution-logic">attribution logic</dfn>,
which determines how the <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value④">conversion value</a> is allocated to histogram buckets.
The <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②⓪">measureConversion()</a> function
accepts a <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionconversionoptions-logic" id="ref-for-dom-privateattributionconversionoptions-logic②">logic</a> parameter
that specifies the <a data-link-type="dfn" href="#attribution-logic" id="ref-for-attribution-logic②">attribution logic</a>.</p>
   <p>Each attribution logic specifies a process for allocating values to histogram buckets,
after the <a data-link-type="dfn" href="#common-matching-logic" id="ref-for-common-matching-logic">common matching logic</a> is applied and privacy budgeting occurs.</p>
   <div class="algorithm" data-algorithm="do attribution and fill a histogram">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="do-attribution-and-fill-a-histogram">do attribution and fill a histogram</dfn>, given <a class="idl-code" data-link-type="dictionary" href="#dictdef-privateattributionconversionoptions" id="ref-for-dictdef-privateattributionconversionoptions②"><var>options</var></a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⑤">site</a> <var>topLevelSite</var>, and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑦">moment</a> <var>now</var>: 
    <ol>
     <li data-md>
      <p>Let <var>matchedImpressions</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets⑧">set</a>.</p>
     <li data-md>
      <p>Let <var>currentEpoch</var> be the result of <a data-link-type="dfn" href="#get-the-current-epoch" id="ref-for-get-the-current-epoch⑤">get the current epoch</a> with <var>site</var> and <var>now</var>.</p>
     <li data-md>
      <p>Let <var>startEpoch</var> be the result of <a data-link-type="dfn" href="#get-the-starting-epoch-for-attribution" id="ref-for-get-the-starting-epoch-for-attribution">get the starting epoch for attribution</a> with <var>site</var>.</p>
     <li data-md>
      <p>For each <var>epoch</var> from <var>startEpoch</var> to <var>currentEpoch</var>, inclusive:</p>
      <ol>
       <li data-md>
        <p>Let <var>impressions</var> be the result of invoking <a data-link-type="dfn" href="#common-matching-logic" id="ref-for-common-matching-logic①">common matching logic</a> with <var>options</var>, <var>topLevelSite</var>, <var>epoch</var>, and <var>now</var>.</p>
       <li data-md>
        <p>If <var>impressions</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty①">is not empty</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>key</var> be a <a data-link-type="dfn" href="#privacy-budget-key" id="ref-for-privacy-budget-key③">privacy budget key</a> whose items are <var>epoch</var> and <var>topLevelSite</var>.</p>
         <li data-md>
          <p>Let <var>budgetOk</var> be the result of <a data-link-type="dfn" href="#deduct-privacy-budget" id="ref-for-deduct-privacy-budget①">deduct privacy budget</a> with <var>key</var>, <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-epsilon" id="ref-for-dom-privateattributionconversionoptions-epsilon②">epsilon</a></code>, <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-value" id="ref-for-dom-privateattributionconversionoptions-value③">value</a></code>,
and <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue②">maxValue</a></code>.</p>
         <li data-md>
          <p>If <var>budgetOk</var> is true, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-extend" id="ref-for-set-extend">extend</a> <var>matchedImpressions</var> with <var>impressions</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>If <var>matchedImpressions</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty②">is empty</a>, return the result of invoking <a data-link-type="dfn" href="#create-an-all-zero-histogram" id="ref-for-create-an-all-zero-histogram①">create an all-zero histogram</a> with <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-histogramsize" id="ref-for-dom-privateattributionconversionoptions-histogramsize③">histogramSize</a></code>.</p>
     <li data-md>
      <p>Switch on <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-logic" id="ref-for-dom-privateattributionconversionoptions-logic③">logic</a></code>:</p>
      <dl class="switch">
       <dt data-md><a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionlogic-last-touch" id="ref-for-dom-privateattributionlogic-last-touch①">"last-touch"</a>
       <dd data-md>
        <p>Return the result of <a data-link-type="dfn" href="#fill-a-histogram-with-last-touch-attribution" id="ref-for-fill-a-histogram-with-last-touch-attribution">fill a histogram with last-touch attribution</a> with <var>matchedImpressions</var>, <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-histogramsize" id="ref-for-dom-privateattributionconversionoptions-histogramsize④">histogramSize</a></code>, and <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-value" id="ref-for-dom-privateattributionconversionoptions-value④">value</a></code>.</p>
      </dl>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="create an all-zero histogram">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-an-all-zero-histogram">create an all-zero histogram</dfn>, given an integer <var>size</var>: 
    <ol>
     <li data-md>
      <p>Return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> <var>size</var>, whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">items</a> are all 0.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.4.2" id="logic-matching"><span class="secno">4.4.2. </span><span class="content">Common Impression Matching Logic</span><a class="self-link" href="#logic-matching"></a></h4>
   <div class="algorithm" data-algorithm="common matching logic">
     To perform <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="common-matching-logic">common matching logic</dfn>, given <a class="idl-code" data-link-type="dictionary" href="#dictdef-privateattributionconversionoptions" id="ref-for-dictdef-privateattributionconversionoptions③"><var>options</var></a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⑥">site</a> <var>topLevelSite</var>, <a data-link-type="dfn" href="#epoch-index" id="ref-for-epoch-index①①">epoch index</a> <var>epoch</var>, and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑧">moment</a> <var>now</var>: 
    <ol>
     <li data-md>
      <p>Let <var>matching</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty③">empty</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets⑨">set</a>.</p>
     <li data-md>
      <p>Let <var>lookbackDays</var> be <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-lookbackdays" id="ref-for-dom-privateattributionconversionoptions-lookbackdays③">lookbackDays</a></code> if it <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exists</a>, the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> maximum otherwise.</p>
     <li data-md>
      <p>If the number of <a data-link-type="dfn" href="#day" id="ref-for-day①">days</a> since the end of <var>epoch</var> exceeds <var>lookbackDays</var>,
return <var>matching</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>impression</var> in the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①③">impression store</a> for the <var>epoch</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>now</var> - <var>lookbackDays</var> is after <var>impression</var>’s <a data-link-type="dfn" href="#impression-timestamp" id="ref-for-impression-timestamp②">timestamp</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
       <li data-md>
        <p>If <var>impression</var>’s <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites⑥">conversion sites</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty④">is not empty</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">does not contain</a> <var>topLevelSite</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-matchvalue" id="ref-for-dom-privateattributionconversionoptions-matchvalue②">matchValue</a></code> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty⑤">is not empty</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain③">does not contain</a> <var>impression</var>’s <a data-link-type="dfn" href="#impression-match-value" id="ref-for-impression-match-value①">match value</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>.</p>
       <li data-md>
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-impressionsites" id="ref-for-dom-privateattributionconversionoptions-impressionsites②">impressionSites</a></code> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty⑥">is not empty</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain④">does not contain</a> <var>impression</var>’s <a data-link-type="dfn" href="#impression-impression-site" id="ref-for-impression-impression-site②">impression site</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>impression</var> to <var>matching</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>matching</var>.</p>
    </ol>
   </div>
   <h5 class="heading settled" data-level="4.4.2.1" id="last-touch-attribution"><span class="secno">4.4.2.1. </span><span class="content">Last-Touch Attribution</span><a class="self-link" href="#last-touch-attribution"></a></h5>
   <div class="algorithm" data-algorithm="fill a histogram with last-touch attribution">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fill-a-histogram-with-last-touch-attribution">fill a histogram with last-touch attribution</dfn>, given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#sets" id="ref-for-sets①⓪">set</a> of <a data-link-type="dfn" href="#impression" id="ref-for-impression②⑥">impressions</a> <var>matchedImpressions</var>, an integer <var>histogramSize</var>, and an integer <var>value</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>matchedImpressions</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty⑦">not empty</a>.</p>
     <li data-md>
      <p>Let <var>impression</var> be the value in <var>matchedImpressions</var> with the most recent <a data-link-type="dfn" href="#impression-timestamp" id="ref-for-impression-timestamp③">timestamp</a>.</p>
     <li data-md>
      <p>Let <var>histogram</var> be the result of invoking <a data-link-type="dfn" href="#create-an-all-zero-histogram" id="ref-for-create-an-all-zero-histogram②">create an all-zero histogram</a> with <var>histogramSize</var>.</p>
     <li data-md>
      <p>Let <var>index</var> be <var>impression</var>’s <a data-link-type="dfn" href="#impression-histogram-index" id="ref-for-impression-histogram-index①">histogram index</a>.</p>
     <li data-md>
      <p>If <var>index</var> is less than <var>histogram</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">size</a>, set <var>histogram</var>[<var>index</var>] to <var>value</var>.</p>
     <li data-md>
      <p>Return <var>histogram</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.5" id="user-control"><span class="secno">4.5. </span><span class="content">User Control and Visibility</span><a class="self-link" href="#user-control"></a></h3>
   <p class="issue" id="issue-6a8ef2ef"><a class="self-link" href="#issue-6a8ef2ef"></a> Consider merging this section with <a href="#privacy-opt-out">§ 10.2 Disabling the Private Attribution API</a>. </p>
   <h4 class="heading settled" data-level="4.5.1" id="opt-out"><span class="secno">4.5.1. </span><span class="content">Optional Participation</span><a class="self-link" href="#opt-out"></a></h4>
   <ul>
    <li data-md>
     <p>Users should be able to opt out. Opt out should be undetectable.</p>
   </ul>
   <p>This mechanism may be a dedicated control
for the Private Attribution API,
or it may be a consolidated privacy control
that applies to multiple features,
including Private Attribution.
Further, user agent developers should consider interaction
of other privacy modes with the Private Attribution API.
For example, attribution might be disabled in a private browsing mode,
or it might be disabled
if the user has opted out of collection of diagnostic data.</p>
   <h4 class="heading settled" data-level="4.5.2" id="visibility"><span class="secno">4.5.2. </span><span class="content">Visibility</span><a class="self-link" href="#visibility"></a></h4>
   <ul>
    <li data-md>
     <p>User ability to view the impression store and past report submissions.</p>
   </ul>
   <h2 class="heading settled" data-level="5" id="http-api"><span class="secno">5. </span><span class="content">HTTP API</span><a class="self-link" href="#http-api"></a></h2>
   <p>`<dfn class="dfn-paneled" data-dfn-type="http-header" data-export id="http-headerdef-save-impression"><code>Save-Impression</code></dfn>` is a <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#dictionary" id="ref-for-dictionary">Dictionary Structured Header</a> set on a response requesting that the user agent invoke the <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⑧">saveImpression()</a> API.</p>
<pre class="example" id="ex-save-impression-header"><a class="self-link" href="#ex-save-impression-header"></a>Save-Impression: conversion-sites=("advertiser.example"), histogram-index=2, match-value=12, lifetime-days=7
</pre>
   <p>The following keys are defined, corresponding to the members of
the <code class="idl"><a data-link-type="idl" href="#dictdef-privateattributionimpressionoptions" id="ref-for-dictdef-privateattributionimpressionoptions①">PrivateAttributionImpressionOptions</a></code> dictionary passed to <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression①⑨">saveImpression()</a>.</p>
   <dl>
    <dt><code>conversion-sites</code>
    <dd> Value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-conversionsites" id="ref-for-dom-privateattributionimpressionoptions-conversionsites②">conversionSites</a>,
    a <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#inner-list" id="ref-for-inner-list">inner list</a> containing <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#string" id="ref-for-string②">strings</a>.
    Each string value includes a domain name using A-labels only; <a data-link-type="biblio" href="#biblio-rfc5890" title="Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework">Internationalized Domain Names</a> therefore need to use <a data-link-type="biblio" href="#biblio-rfc3492" title="Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)">punycode</a>.
    This key is optional. If not supplied, an empty set is saved for <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites⑦">Conversion Sites</a>. 
    <dt><code>histogram-index</code>
    <dd> Value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-histogramindex" id="ref-for-dom-privateattributionimpressionoptions-histogramindex③">histogramIndex</a>,
    a non-negative <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#integer" id="ref-for-integer">integer</a>. This key is required. 
    <dt><code>match-value</code>
    <dd> Value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue④">matchValue</a>,
    a non-negative <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#integer" id="ref-for-integer①">integer</a>. This key is optional.
    If not supplied, a value of 0 is saved for <a data-link-type="dfn" href="#impression-match-value" id="ref-for-impression-match-value②">Match Value</a>. 
    <dt><code>lifetime-days</code>
    <dd> Value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays⑤">lifetimeDays</a>,
    a positive <a data-link-type="dfn" href="https://httpwg.org/specs/rfc9651#integer" id="ref-for-integer②">integer</a>. This key is optional.
    If not supplied, an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> value is saved for <a data-link-type="dfn" href="#impression-lifetime" id="ref-for-impression-lifetime②">Lifetime</a>. 
   </dl>
   <p>TODO need to specify in more detail when and how this header is interpreted</p>
   <h2 class="heading settled" data-level="6" id="implementation-considerations"><span class="secno">6. </span><span class="content">Implementation Considerations</span><a class="self-link" href="#implementation-considerations"></a></h2>
   <ul>
    <li data-md>
     <p>Management and distribution of values for the following:</p>
     <ul>
      <li data-md>
       <p>Histogram size</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site⑥">Conversion site</a> for <a data-link-type="dfn" href="#impression" id="ref-for-impression②⑦">impressions</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site⑦">Impression site</a> for <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①③">conversions</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#impression-histogram-index" id="ref-for-impression-histogram-index②">Histogram indexes</a></p>
     </ul>
   </ul>
   <h2 class="heading settled" data-level="7" id="aggregation"><span class="secno">7. </span><span class="content">Aggregation</span><a class="self-link" href="#aggregation"></a></h2>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="aggregation-service">aggregation service</dfn> takes multiple pieces of attribution information
and produces an aggregate metric.</p>
   <p>User agent implementations will have different requirements for aggregation.
However, the aggregation process has some common elements.</p>
   <p>Firstly, user agents will need to be configured with,
or otherwise obtain,
information about the aggregation service.
This includes the aggregation methods that are supported
and any configuration that is required.</p>
   <p>Each aggregation method needs to define
how a histogram is:</p>
   <ul>
    <li data-md>
     <p>prepared for aggregation,</p>
    <li data-md>
     <p>encrypted,</p>
    <li data-md>
     <p>annotated with any necessary metadata, and</p>
    <li data-md>
     <p>submitted to the aggregation service for aggregation.</p>
   </ul>
   <p>The aggregation method also needs to define
how the aggregated result is obtained by a site.</p>
   <h3 class="heading settled" data-level="7.1" id="s-mpc"><span class="secno">7.1. </span><span class="content">Multi-Party Computation Aggregation</span><a class="self-link" href="#s-mpc"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="MPC" data-noexport id="mpc">Multi-Party Computation (MPC)</dfn> system is one that
involves multiple independent entities
that cooperatively compute an agreed function.</p>
   <p>This specification uses an MPC system based on Prio <a data-link-type="biblio" href="#biblio-prio" title="Prio: Private, Robust, and Scalable Computation of Aggregate Statistics">[PRIO]</a> and the <dfn data-lt="DAP" data-var-ignore>Distributed Aggregation Protocol (DAP)</dfn> <a data-link-type="biblio" href="#biblio-dap" title="Distributed Aggregation Protocol for Privacy Preserving Measurement">[DAP]</a>.
This is a two-party MPC system that is characterized by
its reliance on client-provided proofs of correctness for inputs.
This allows for very efficient MPC operation
at a modest cost in the size of submissions to the system.</p>
   <p>An aggregation service that uses MPC
comprises two or more independent services
that cooperate to compute a predefined function.</p>
   <p>The basic guarantee provided by MPC
is that only the defined outputs of a function,
plus well-defined leakage,
is revealed to any entity.</p>
   <p>The MPC guarantees hold only to the extent that
a subset of the entities that participate are honest.
For the two-party MPC used in Prio,
privacy—​that is, the confidentiality of inputs—​is maintained
as long as either MPC operator remains honest.
This MPC configuration does not protect
against the corruption of the outputs
by either MPC operator.</p>
   <h4 class="heading settled" data-level="7.1.1" id="prio"><span class="secno">7.1.1. </span><span class="content">Prio and DAP</span><a class="self-link" href="#prio"></a></h4>
   <p>The <a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionprotocol-dap-12-histogram" id="ref-for-dom-privateattributionprotocol-dap-12-histogram①">"dap-12-histogram"</a> aggregation method uses Prio <a data-link-type="biblio" href="#biblio-prio" title="Prio: Private, Robust, and Scalable Computation of Aggregate Statistics">[PRIO]</a> and the Distributed Aggregation Protocol (DAP) <a data-link-type="biblio" href="#biblio-dap" title="Distributed Aggregation Protocol for Privacy Preserving Measurement">[DAP]</a>.
Specifically, this aggregation method uses
the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="prio3l1boundsum">Prio3L1BoundSum</dfn> instantiation <a data-link-type="biblio" href="#biblio-prio-l1" title="A Prio Instantiation for Vector Sums with an L1 Norm Bound on Contributions">[PRIO-L1]</a> of the Prio3 Verifiable Distributed Aggregation Function (VDAF) <a data-link-type="biblio" href="#biblio-vdaf" title="Verifiable Distributed Aggregation Functions">[VDAF]</a>.</p>
   <p>DAP and the <a data-link-type="dfn" href="#prio3l1boundsum" id="ref-for-prio3l1boundsum">Prio3L1BoundSum</a> instantiation define how a report is prepared,
encrypted, and submitted for aggregation.
DAP also defines how an aggregate is obtained
and what configuration is necessary
for a user agent to obtain about the aggregation service.</p>
   <p>In using <a data-link-type="dfn" href="#prio3l1boundsum" id="ref-for-prio3l1boundsum①">Prio3L1BoundSum</a>,
reports contain a distributed zero-knowledge proof
that allows the nodes that participate in the MPC
to confirm that the sum of the submitted histogram is less than a set value. <a data-link-type="dfn" href="#prio3l1boundsum" id="ref-for-prio3l1boundsum②">Prio3L1BoundSum</a> can only validate that the histogram sum
is strictly less than a power of two.
That is, proofs confirm that
the sum is less than 2<sup><var>n</var></sup> for positive integer values of <var>n</var>.</p>
   <p>To construct a report,
proofs are generated based on a value
that is the next power of two
greater than <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue③">maxValue</a></code>.
This means that the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service⑨">aggregation service</a> is unable to reject reports
between <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue④">maxValue</a></code> and the next power of two.
Consequently, a malicious <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⑨">user agent</a> might generate a report
that contributes as much as double the value of <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue⑤">maxValue</a></code> to the aggregate histogram.
The proof ensures that there is no opportunity for excess contributions
when <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue⑥">maxValue</a></code> is equal to 2<sup><var>n</var></sup> − 1;
the relative effect of any such attack can be reduced
by setting <code class="idl"><a data-link-type="idl" href="#dom-privateattributionconversionoptions-maxvalue" id="ref-for-dom-privateattributionconversionoptions-maxvalue⑦">maxValue</a></code> as close to 2<sup><var>n</var></sup> − 1 as other constraints allow.</p>
   <h4 class="heading settled" data-level="7.1.2" id="dap-extensions"><span class="secno">7.1.2. </span><span class="content">DAP Extensions</span><a class="self-link" href="#dap-extensions"></a></h4>
   <p>Several extensions to DAP <a data-link-type="biblio" href="#biblio-dap-ext" title="Distributed Aggregation Protocol (DAP) Extensions for Improved Application of Differential Privacy">[DAP-EXT]</a> are necessary for this application:</p>
   <ul>
    <li data-md>
     <p><a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/#name-late-task-binding">Late task binding</a> improves the ability of a site to collect reports
and aggregate them as needed.</p>
    <li data-md>
     <p><a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/#name-requester-website-identity">Website identity</a> is critical to ensure
that differential privacy protections are effective.
This prevents a malicious actor
that is able to correlate user identity across multiple sites
from exceeding the sensitivity bounds for that user
by aggregating reports from multiple sites together.</p>
    <li data-md>
     <p><a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/#name-privacy-budget-consumption">Privacy budget consumption</a> ensures that the aggregation service does not aggregate reports
that received less privacy budget
than the aggregation task was configured with.</p>
   </ul>
   <p>User agents MUST include all of these extensions
in reports that they generate.</p>
   <h3 class="heading settled" data-level="7.2" id="s-tee"><span class="secno">7.2. </span><span class="content">Trusted Execution Environments</span><a class="self-link" href="#s-tee"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="TEE" data-noexport id="tee">Trusted Execution Environment (TEE)</dfn> uses specialized hardware
to ensure that computation is isolated
from other programs that run on the same hardware.</p>
   <p>TODO</p>
   <h3 class="heading settled" data-level="7.3" id="anti-replay"><span class="secno">7.3. </span><span class="content">Anti-Replay Requirements</span><a class="self-link" href="#anti-replay"></a></h3>
   <p><a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①①">Conversion reports</a> generated by browsers are bound
to the amount of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets⑧">privacy budget</a> that was expended by the site that requested the report.</p>
   <p>An <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①⓪">aggregation service</a> MUST guarantee
that it does not accept the same report more than once.</p>
   <h2 class="heading settled" data-level="8" id="dp"><span class="secno">8. </span><span class="content">Differential Privacy</span><a class="self-link" href="#dp"></a></h2>
   <p>This design uses the concept of <a data-link-type="dfn" href="#differential-privacy" id="ref-for-differential-privacy">differential privacy</a> as the basis of its privacy design. <a data-link-type="biblio" href="#biblio-ppa-dp" title="Cookie Monster: Efficient On-device Budgeting for Differentially-Private Ad-Measurement Systems">[PPA-DP]</a></p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="differential privacy" data-noexport id="differential-privacy">Differential privacy</dfn> is a mathematical definition of privacy
that can guarantee the amount of private information
that is revealed by a system. <a data-link-type="biblio" href="#biblio-dp" title="The Algorithmic Foundations of Differential Privacy">[DP]</a> Differential privacy is not the only means
by which privacy is protected in this system,
but it is the most rigorously defined and analyzed.
As such, it provides the strongest privacy guarantees.</p>
   <p>Differential privacy uses randomized noise
to hide private data contributions
to an aggregated dataset.
The effect of noise is to hide
individual contributions to the dataset,
but to retain the usefulness of any aggregated analysis.</p>
   <p>To apply differential privacy,
it is necessary to define what information is protected.
In this system, the protected information is
the <a data-link-type="dfn" href="#impression" id="ref-for-impression②⑧">impressions</a> of a single user profile,
on a single <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⓪">user agent</a>,
over a single <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⑧">epoch</a>,
for a single website that registers <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①④">conversions</a>. <a href="#dp-unit">§ 8.1 Privacy Unit</a> describes the implications of this design
in more detail.</p>
   <p>This attribution design uses a form of differential privacy
called <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="individual-differential-privacy">individual differential privacy</dfn>.
In this model, user agents are each separately responsible
for ensuring that they limit the information
that is contributed.</p>
   <p>The <a data-link-type="dfn" href="#individual-differential-privacy" id="ref-for-individual-differential-privacy">individual differential privacy</a> design of this API
has three primary components:</p>
   <ol>
    <li data-md>
     <p>User agents limit (using the <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets⑨">privacy budget</a>) the amount of information
about <a data-link-type="dfn" href="#impression" id="ref-for-impression②⑨">impressions</a> that leaves the device through <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①②">conversion reports</a>. <a href="#dp-budget">§ 8.2 Privacy Budgets</a> explores this in greater depth.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①①">Aggregation services</a> ensure that any given <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①③">conversion report</a> is
only used in accordance with the <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⓪">privacy budget</a> that was accounted for it
by the user agent. <a href="#anti-replay">§ 7.3 Anti-Replay Requirements</a> describes requirements on aggregation services
in more detail.</p>
    <li data-md>
     <p>Noise is added by <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①②">aggregation services</a>. <a href="#dp-mechanism">§ 8.3 Differential Privacy Mechanisms</a> details the mechanisms that might be used.</p>
   </ol>
   <p>Together, these measures place limits
on the information that is released for each <a data-link-type="dfn" href="#privacy-unit" id="ref-for-privacy-unit">privacy unit</a>.</p>
   <h3 class="heading settled" data-level="8.1" id="dp-unit"><span class="secno">8.1. </span><span class="content">Privacy Unit</span><a class="self-link" href="#dp-unit"></a></h3>
   <p>An implementation of differential privacy
requires a clear definition for what is protected.
This is known as the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="privacy-unit">privacy unit</dfn>,
which represents the entity that receives privacy protection.</p>
   <p>This system adopts a <a data-link-type="dfn" href="#privacy-unit" id="ref-for-privacy-unit①">privacy unit</a> that is the combination of three values:</p>
   <ol>
    <li data-md>
     <p>A user agent profile.
That is, an instance of a user agent,
as used by a single person.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⑦">site</a> that requests information about <a data-link-type="dfn" href="#impression" id="ref-for-impression③⓪">impressions</a> (the <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site⑦">conversion site</a>).</p>
     <p class="note" role="note">The sites that register impressions (the <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site⑧">impression site</a>)
are not considered.
Those sites do not receive information from this system directly. </p>
    <li data-md>
     <p>The current <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch①⑨">epoch</a>.</p>
   </ol>
   <p>A change to any of these values produces a new privacy unit,
which results in a separate <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①①">privacy budget</a>.
Each site that a person visits receives a bounded amount of information
for each <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⓪">epoch</a>.</p>
   <p>Ideally, the <a data-link-type="dfn" href="#privacy-unit" id="ref-for-privacy-unit②">privacy unit</a> is a single person.
Though ideal, it is not possible to develop a useful system
that guarantees perfect correspondence with a person,
for a number of reasons:</p>
   <ul>
    <li data-md>
     <p>People use multiple browsers and multiple devices,
often without coordination.</p>
    <li data-md>
     <p>A unit that covered all websites
could be exhausted by one site,
denying other sites any information.</p>
    <li data-md>
     <p>Advertising is an ongoing activity.
Without allocating <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①②">privacy budget</a> for new data,
sites could exhaust their budget forever.</p>
   </ul>
   <h4 class="heading settled" data-level="8.1.1" id="dp-instance"><span class="secno">8.1.1. </span><span class="content">Browser Instances</span><a class="self-link" href="#dp-instance"></a></h4>
   <p>Each browser instance manages a separate <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①③">privacy budget</a>.</p>
   <p>Coordination between browser instances might be possible,
but not expected.
That coordination might allow privacy to be improved
by reducing the total amount of information that is released.
It might also improve the utility of attribution
by allowing impressions on one browser instance
to be converted on another.</p>
   <p>Coordination across different implementations
is presently out of scope for this work.
Implementations can perform some coordination
between instances that are known to be for the same person,
but this is not mandatory.</p>
   <h4 class="heading settled" data-level="8.1.2" id="dp-site"><span class="secno">8.1.2. </span><span class="content">Per-Site Limits</span><a class="self-link" href="#dp-site"></a></h4>
   <p>The information released to websites is done on the basis of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⑧">site</a>.
This aligns with the same boundary used in other privacy-relevant functions.</p>
   <p>A finer privacy unit, such as an <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin⑥">origin</a>,
would make it trivial to obtain additional information.
Information about the same person could be gathered
from multiple origins.
That information could then be combined
by exploiting the free flow of information within the site,
using cookies <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a> or similar.</p>
   <p><a href="#dp-safety">§ 8.2.2 Safety Limits</a> discusses attacks that exploit this limit
and some additional <a data-link-type="dfn" href="#safety-limits" id="ref-for-safety-limits①">safety limits</a> that might be implemented
by user agents
to protect against those attacks.</p>
   <h4 class="heading settled" data-level="8.1.3" id="dp-refresh"><span class="secno">8.1.3. </span><span class="content">Privacy Budget Epochs</span><a class="self-link" href="#dp-refresh"></a></h4>
   <p>Sites receive a separate differential privacy budget
that is used to query <a data-link-type="dfn" href="#impression" id="ref-for-impression③①">impressions</a> recorded
in each <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②①">privacy budget epoch</a> (or <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②②">epoch</a>).</p>
   <p>This budget applies to the <a data-link-type="dfn" href="#impression" id="ref-for-impression③②">impressions</a> that are registered with the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②①">user agent</a> and later queried,
not <a data-link-type="dfn" href="#conversion" id="ref-for-conversion①⑤">conversions</a>.</p>
   <p>From the perspective of the analysis <a data-link-type="biblio" href="#biblio-ppa-dp" title="Cookie Monster: Efficient On-device Budgeting for Differentially-Private Ad-Measurement Systems">[PPA-DP]</a> each <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②③">epoch</a> of <a data-link-type="dfn" href="#impression" id="ref-for-impression③③">impressions</a> forms a separate database.
A finite <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①④">privacy budget</a> is enforced across all the queries made on each database.</p>
   <p>Having a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①④">conversion report</a> produced from <a data-link-type="dfn" href="#impression" id="ref-for-impression③④">impressions</a> that span multiple <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②④">epochs</a> has privacy consequences.
A single visit to a website can give that site information
about activities across many <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⑤">epochs</a>.
This only requires that
the <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site⑧">conversion site</a> is identified as the destination
for <a data-link-type="dfn" href="#impression" id="ref-for-impression③⑤">impressions</a> over that entire period.
The number of <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⑥">epochs</a> that can be queried is limited by <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②②">user agents</a>.</p>
   <p>The goal is to set an <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⑦">epoch</a> that is as large as feasible.
A longer period of time allows for a better privacy/utility balance
because sites can be allocated a larger overall budget
at any point in time,
while keeping the overall rate of privacy loss low.
However, a longer interval means that it is easier to
exhaust a privacy budget completely,
yielding no information until the next refresh.</p>
   <p>The decision to set the <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⑧">epoch</a> duration to a week is largely arbitrary.
One week is expected to be enough to allow sites
some flexibility to make decisions about how to spend <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⑤">privacy budgets</a> without careful planning that needs to account for
changes that might occur days or weeks in the future.</p>
   <p><a href="#dp-budget">§ 8.2 Privacy Budgets</a> describes the process for budgeting in more detail.</p>
   <h3 class="heading settled" data-level="8.2" id="dp-budget"><span class="secno">8.2. </span><span class="content">Privacy Budgets</span><a class="self-link" href="#dp-budget"></a></h3>
   <p>Browsers maintain <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="privacy-budgets">privacy budgets</dfn>,
which are a means of limiting the amount of privacy loss.</p>
   <p>This specification uses an individual form
of (ε, δ)-differential privacy as its basis.
In this model, privacy loss is measured using the value ε.
The δ value is handled by the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①③">aggregation service</a> when adding noise to aggregates.</p>
   <p>Each user agent instance is responsible for
managing privacy budgets.</p>
   <p>Each <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⑤">conversion report</a> that is requested specifies an ε value
that represents the amount of privacy budget
that the report consumes and a maximum on the value that can be returned in the
conversion report.</p>
   <h4 class="heading settled" data-level="8.2.1" id="dp-deduction"><span class="secno">8.2.1. </span><span class="content">Privacy Budget Deduction</span><a class="self-link" href="#dp-deduction"></a></h4>
   <p>When searching for <a data-link-type="dfn" href="#impression" id="ref-for-impression③⑥">impressions</a> for the conversion report,
the user agent deducts the specified ε value from
the budget for the <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch②⑨">privacy budget epoch</a> in which those impressions were saved.
If the <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⑥">privacy budget</a> for that <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⓪">epoch</a> is not sufficient,
the impressions from that <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③①">epoch</a> are not used.</p>
   <p>Each time a <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site⑨">conversion site</a> invokes <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②①">measureConversion()</a> the <a data-link-type="dfn" href="#deduct-privacy-budget" id="ref-for-deduct-privacy-budget②">privacy budget is deducted</a> for <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③②">epochs</a> from which the <a data-link-type="dfn" href="#attribution-logic" id="ref-for-attribution-logic③">attribution logic</a> selected <a data-link-type="dfn" href="#impression" id="ref-for-impression③⑦">impressions</a>.</p>
   <div class="example" id="ex-budget">
    <a class="self-link" href="#ex-budget"></a> In the following figure,
    impressions are recorded from a number of different sites,
    shown with circles. 
    <figure>
     <svg class="diagram" font-family="monospace" font-size="13px" height="192" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 496 192" width="496" xmlns="http://www.w3.org/2000/svg">
      <text class="ascii" display="none"> |         |         |         |         |   ║
Site A  |       o |         |         |        o|   ║
Site B  |         |       o |* *      | o       |   ║
Site C  |  o *    |         |o        |         |   ║
Site D  |         |         |         |         |   ║
Site E  |         |         |         |*        | * ║
        |         |         |         |         |   ║
    ----+---------+---------+---------+---------+---+--> time
         `--. .--' `--. .--' `--. .--' `--. .--'    ^
             |         |         |         |        |
          week 1     week 2   week 3   week 4      now </text>
      <path d="M 72,16 L 72,128" fill="none" stroke="black"></path>
      <path d="M 152,16 L 152,128" fill="none" stroke="black"></path>
      <path d="M 232,16 L 232,128" fill="none" stroke="black"></path>
      <path d="M 312,16 L 312,128" fill="none" stroke="black"></path>
      <path d="M 392,16 L 392,128" fill="none" stroke="black"></path>
      <path d="M 426,16 L 426,128" fill="none" stroke="black"></path>
      <path d="M 422,16 L 422,128" fill="none" stroke="black"></path>
      <path d="M 424,136 L 424,160" fill="none" stroke="black"></path>
      <path d="M 40,128 L 448,128" fill="none" stroke="black"></path>
      <path d="M 88,144 L 96,144" fill="none" stroke="black"></path>
      <path d="M 128,144 L 136,144" fill="none" stroke="black"></path>
      <path d="M 168,144 L 176,144" fill="none" stroke="black"></path>
      <path d="M 208,144 L 216,144" fill="none" stroke="black"></path>
      <path d="M 248,144 L 256,144" fill="none" stroke="black"></path>
      <path d="M 288,144 L 296,144" fill="none" stroke="black"></path>
      <path d="M 328,144 L 336,144" fill="none" stroke="black"></path>
      <path d="M 368,144 L 376,144" fill="none" stroke="black"></path>
      <path d="M 88,144 C 79.16936,144 72,136.83064 72,128" fill="none" stroke="black"></path>
      <path d="M 96,144 C 104.83064,144 112,151.16936 112,160" fill="none" stroke="black"></path>
      <path d="M 128,144 C 119.16936,144 112,151.16936 112,160" fill="none" stroke="black"></path>
      <path d="M 136,144 C 144.83064,144 152,136.83064 152,128" fill="none" stroke="black"></path>
      <path d="M 168,144 C 159.16936,144 152,136.83064 152,128" fill="none" stroke="black"></path>
      <path d="M 176,144 C 184.83064,144 192,151.16936 192,160" fill="none" stroke="black"></path>
      <path d="M 208,144 C 199.16936,144 192,151.16936 192,160" fill="none" stroke="black"></path>
      <path d="M 216,144 C 224.83064,144 232,136.83064 232,128" fill="none" stroke="black"></path>
      <path d="M 248,144 C 239.16936,144 232,136.83064 232,128" fill="none" stroke="black"></path>
      <path d="M 256,144 C 264.83064,144 272,151.16936 272,160" fill="none" stroke="black"></path>
      <path d="M 288,144 C 279.16936,144 272,151.16936 272,160" fill="none" stroke="black"></path>
      <path d="M 296,144 C 304.83064,144 312,136.83064 312,128" fill="none" stroke="black"></path>
      <path d="M 328,144 C 319.16936,144 312,136.83064 312,128" fill="none" stroke="black"></path>
      <path d="M 336,144 C 344.83064,144 352,151.16936 352,160" fill="none" stroke="black"></path>
      <path d="M 368,144 C 359.16936,144 352,151.16936 352,160" fill="none" stroke="black"></path>
      <path d="M 376,144 C 384.83064,144 392,136.83064 392,128" fill="none" stroke="black"></path>
      <polygon class="arrowhead" fill="black" points="456,128 444,122.4 444,133.6" transform="rotate(0,448,128)"></polygon>
      <polygon class="arrowhead" fill="black" points="432,136 420,130.4 420,141.6" transform="rotate(270,424,136)"></polygon>
      <circle class="opendot" cx="96" cy="64" fill="white" r="6" stroke="black"></circle>
      <circle class="closeddot" cx="112" cy="64" fill="black" r="6"></circle>
      <circle class="opendot" cx="136" cy="32" fill="white" r="6" stroke="black"></circle>
      <circle class="opendot" cx="216" cy="48" fill="white" r="6" stroke="black"></circle>
      <circle class="closeddot" cx="240" cy="48" fill="black" r="6"></circle>
      <circle class="opendot" cx="240" cy="64" fill="white" r="6" stroke="black"></circle>
      <circle class="closeddot" cx="256" cy="48" fill="black" r="6"></circle>
      <circle class="closeddot" cx="320" cy="96" fill="black" r="6"></circle>
      <circle class="opendot" cx="328" cy="48" fill="white" r="6" stroke="black"></circle>
      <circle class="opendot" cx="384" cy="32" fill="white" r="6" stroke="black"></circle>
      <circle class="closeddot" cx="408" cy="96" fill="black" r="6"></circle>
      <g class="text">
       <text x="28" y="36">Site A</text>
       <text x="28" y="52">Site B</text>
       <text x="28" y="68">Site C</text>
       <text x="28" y="84">Site D</text>
       <text x="28" y="100">Site E</text>
       <text x="476" y="132">time</text>
       <text x="108" y="180">week 1</text>
       <text x="196" y="180">week 2</text>
       <text x="268" y="180">week 3</text>
       <text x="340" y="180">week 4</text>
       <text x="424" y="180">now</text>
      </g>
     </svg>
     <figcaption>An example of a store of impressions over time</figcaption>
    </figure>
    <p>A <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⑥">conversion report</a> might be requested at the time marked with "now".
    That conversion report selects impressions marked with black circles,
    corresponding to impressions from Sites B, C, and E.</p>
    <p>As a result, <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⑦">privacy budget</a> for the <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site①⓪">conversion site</a> is <a data-link-type="dfn" href="#deduct-privacy-budget" id="ref-for-deduct-privacy-budget③">deducted</a> from <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③③">epochs</a> 1, 3, 4, and 5.
    No impressions were recorded for <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③④">epoch</a> 2,
    so no <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⑧">budget</a> is deducted from that <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⑤">epoch</a>.</p>
   </div>
   <p>How a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②③">user agent</a> manages exhaustion of a <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets①⑨">privacy budget</a> depends on the <a data-link-type="dfn" href="#attribution-logic" id="ref-for-attribution-logic④">attribution logic</a> that was chosen.</p>
   <h4 class="heading settled" data-level="8.2.2" id="dp-safety"><span class="secno">8.2.2. </span><span class="content">Safety Limits</span><a class="self-link" href="#dp-safety"></a></h4>
   <p>The basic <a data-link-type="dfn" href="#privacy-unit" id="ref-for-privacy-unit③">privacy unit</a> is vulnerable to attack
by an adversary that is able to correlate activity for the same person
across multiple <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site②⑨">sites</a>.</p>
   <p>Groups of sites can sometimes coordinate their activity,
such as when they have shared ownership or strong agreements.
A group of sites that can be sure that particular visitor is the same person—​using any means, including something like FedCM <a data-link-type="biblio" href="#biblio-fedcm" title="Federated Credential Management API">[FEDCM]</a>—​can combine information gained from this API.</p>
   <p>This can be used to increase the rate
at which a site gains information from attribution,
proportional to the number of sites
across which coordination occurs.
The default privacy unit places no limit on the information released
in this way.</p>
   <p>To counteract this effect, user agents can implement <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="safety-limits">safety limits</dfn>,
which are additional privacy budgets that do not consider site.
Safety limits might be significantly higher than per-site budgets,
so that they are not reached for most normal browsing activity.
The goal would be to ensure that they are only effective
for intensive activity or when being attacked.</p>
   <p>Like the per-site privacy budget,
it is critical that sites be unable to determine
whether their request for a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⑦">conversion report</a> has caused
a safety limit to be exceeded.</p>
   <h3 class="heading settled" data-level="8.3" id="dp-mechanism"><span class="secno">8.3. </span><span class="content">Differential Privacy Mechanisms</span><a class="self-link" href="#dp-mechanism"></a></h3>
   <p>The specific mechanisms that are used
depend on the type of <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①④">aggregation service</a>.</p>
   <h2 class="heading settled" data-level="9" id="security"><span class="secno">9. </span><span class="content">Security Considerations</span><a class="self-link" href="#security"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="security-impression-store"><span class="secno">9.1. </span><span class="content">Impression Store</span><a class="self-link" href="#security-impression-store"></a></h3>
   <p>The <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①④">impression store</a> used by the Private Attribution API
holds information related to browsing activity
and persists across browsing sessions.
Although the flow of information
through the impression store is strictly controlled,
it carries some amount of information across origins.</p>
   <p>The following measures limit the possibility
of harmful information flow through the impression store:</p>
   <ul>
    <li data-md>
     <p>Websites cannot read from the impression store.
Information from the impression store
is released only via encrypted <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⑧">conversion reports</a>. <a href="#dp">Differential privacy</a>, provided by a combination
of functionality in the user agent
and in the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①⑤">aggregation service</a>,
provides a rigorous bound on
the probability that the aggregated information
output by the aggregation service
is distinguishable from the value it would have
absent any user’s contribution.</p>
    <li data-md>
     <p>Users can explicitly <a href="#removing-impressions">clear stored impressions</a>.</p>
    <li data-md>
     <p>It is recommended that user agents limit how long
data can persist in the impression store,
even absent explicit user action,
by imposing a maximum value of <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-lifetimedays" id="ref-for-dom-privateattributionimpressionoptions-lifetimedays⑥">lifetimeDays</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="9.2" id="security-api-implementation"><span class="secno">9.2. </span><span class="content">API Implementation</span><a class="self-link" href="#security-api-implementation"></a></h3>
   <p>The Private Attribution APIs must be implemented carefully
to maintain the required security and privacy properties.
A site calling the APIs must not be able to learn:</p>
   <ul>
    <li data-md>
     <p>Whether the Private Attribution APIs are <a href="#opt-out">enabled</a>.</p>
    <li data-md>
     <p>Whether an attribution occurred.</p>
    <li data-md>
     <p>Whether the <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⓪">privacy budget</a> is exhausted.</p>
    <li data-md>
     <p>Whether the <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report①⑨">conversion report</a> reflects a non-zero <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value⑤">conversion value</a>.</p>
    <li data-md>
     <p>Which <a class="idl-code" data-link-type="dict-member" href="#dom-privateattributionimpressionoptions-histogramindex" id="ref-for-dom-privateattributionimpressionoptions-histogramindex④">histogramIndex</a> is assigned the <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value⑥">conversion value</a>.</p>
   </ul>
   <p>Note that explicit return values or thrown exceptions
are not the only way that a site can learn from
the Private Attribution APIs.
It may be possible to infer sensitive information from <dfn data-var-ignore>side channels</dfn> like:</p>
   <ul>
    <li data-md>
     <p>Variation in the time it takes for the APIs to complete.</p>
    <li data-md>
     <p>Consumption of memory or storage by the API, if that
consumption is somehow observable by the site.</p>
   </ul>
   <p>While complete elimination of all side channels is impractical,
implementations must make reasonable efforts to prevent
leakage of sensitive information from the attribution APIs.
Strategies to prevent leakage include:</p>
   <ul>
    <li data-md>
     <p>Fully validating all API inputs, even when the API
is disabled.</p>
    <li data-md>
     <p>Avoiding conditional logic. For example, <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②②">measureConversion()</a> should always go through the full process of constructing
a conversion report, even when the <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value⑦">conversion value</a> to be
reported is zero.</p>
   </ul>
   <h3 class="heading settled" data-level="9.3" id="security-aggregation-services"><span class="secno">9.3. </span><span class="content">Aggregation Services</span><a class="self-link" href="#security-aggregation-services"></a></h3>
   <p>Although not part of the web platform,
security of aggregation services is quite important
to the overall security of the Private Attribution mechanism. <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②⓪">Conversion reports</a> produced by <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②③">measureConversion()</a> are encrypted using cryptographic key(s) of the aggregation service.
Thus, much of the potential for disclosure
of the information contained in these reports
depends on the details of the aggregation service.</p>
   <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②④">User agent</a> developers should carefully consider
the design of an aggregation service
and the trustworthiness of the aggregation service operator
before adding it as a supported service for the Private Attribution API.
Additional discussion of these issues
may be found in <a href="#aggregation">§ 7 Aggregation</a> and <a href="#privacy">§ 10 Privacy Considerations</a>.</p>
   <h3 class="heading settled" data-level="9.4" id="security-multiple-sites"><span class="secno">9.4. </span><span class="content">Combining Reports from Multiple Sites</span><a class="self-link" href="#security-multiple-sites"></a></h3>
   <p>The privacy mechanisms in the Private Attribution API
operate primarily at the granularity of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⓪">sites</a>.
A malicious operator
may attempt to register <a data-link-type="dfn" href="#impression" id="ref-for-impression③⑧">impressions</a> for multiple sites,
thus exceeding the amount of information that would otherwise
be released through private attribution. <a href="#dp-safety">§ 8.2.2 Safety Limits</a> discusses establishing additional cross-site
privacy budgets to mitigate this possibility.</p>
   <p class="issue" id="issue-2117cd8d"><a class="self-link" href="#issue-2117cd8d"></a> Rate limits on calls to the Private Attribution APIs
could also be an effective mechanism to prevent
harvesting information through overuse of the APIs. </p>
   <h3 class="heading settled" data-level="9.5" id="security-ad-fraud"><span class="secno">9.5. </span><span class="content">Ad Fraud</span><a class="self-link" href="#security-ad-fraud"></a></h3>
   <p>As with many technologies,
advertising on the web
has been the subject of various kinds of fraud.</p>
   <p>Fraudulent registration of impressions
is a particular concern with the Private Attribution API,
because impressions are stored only on the device.
It is not possible to apply server-side intelligence
to identify fraudulent impressions and exclude them
from attribution. Conversely, even though <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②①">conversion reports</a> are encrypted, because the reports are sent
to a server, the server can make a determination that
the conversion is likely fraudulent and exclude it from
aggregation.</p>
   <p>An important mitigation against malicious use
of the Private Attribution APIs is the explicit specification
of eligible conversion sites when registering an impression,
and of eligible impression sites and <a data-link-type="dfn" href="#impression-histogram-index" id="ref-for-impression-histogram-index③">histogram indexes</a> when registering a conversion.
This prevents impressions on arbitrary malicious sites
from interfering with attribution to the intended set
of candidate impressions.</p>
   <h2 class="heading settled" data-level="10" id="privacy"><span class="secno">10. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>The main privacy goal of this API is
to ensure that providing sites with the ability to perform attribution
does not improve their ability to perform <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#cross-site-recognition" id="ref-for-cross-site-recognition">cross-site recognition</a>.</p>
   <p>This section provides more information
about the protections necessary to achieve this goal.
Additional discussion talks about secondary privacy goals,
such as the prevention of <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#same-site-recognition" id="ref-for-same-site-recognition">same-site recognition</a>.</p>
   <h3 class="heading settled" data-level="10.1" id="privacy-exposure"><span class="secno">10.1. </span><span class="content">Information Exposed by the Private Attribution API</span><a class="self-link" href="#privacy-exposure"></a></h3>
   <p>The <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⑤">impression store</a> and <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①⓪">privacy budget store</a> contain information about a cross-section of browsing activity.
As use of the API increases,
so does the scope of this information.
However, most of the information written to these stores
is never disclosed.
Because attribution is performed on the device
(<dfn data-var-ignore>on-device attribution</dfn>),
only information about attributed conversions is exposed by the
Private Attribution API. This contrasts with other schemes in which
information about both impressions and conversions is sent to the
aggregation service for <dfn data-var-ignore>off-device attribution</dfn>.
In the latter class of schemes, the amount of information
that could be revealed in a compromise of the aggregation service
(or in a compromise of communication with the aggregation service)
is significantly larger.</p>
   <p>When the Private Attribution API makes an attribution, information
about that attribution is released from the device
only to the extent the <a href="#dp">differential privacy</a> restrictions allow.</p>
   <p>While the Private Attribution API is intended to measure
the association of relatively infrequent conversion events
with a limited set of related impression candidates,
it is important to consider how the API might be misused
for larger-scale data collection.
The requirement that impressions enumerate
the possible <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site①①">conversion sites</a> (and vice-versa)
has an important role in preventing misuse of the API
for mass data collection, and in making attempts
at such misuse more visible.</p>
   <p class="issue" id="issue-75e9d0b7"><a class="self-link" href="#issue-75e9d0b7"></a> It is unclear whether the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①①">privacy budget store</a> should be cleared whenever
the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⑥">impression store</a> is cleared. On one hand, it contains information about
browsing activity, so it is desirable to include it when clearing browsing activity.
On the other hand, it is only possible to strictly adhere to the requirements of
the differential privacy mechanism if information about a fully- or partially-
depleted privacy budget is maintained until that budget is no longer relevant
(i.e. the end of the <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⑥">privacy budget epoch</a>). </p>
   <h3 class="heading settled" data-level="10.2" id="privacy-opt-out"><span class="secno">10.2. </span><span class="content">Disabling the Private Attribution API</span><a class="self-link" href="#privacy-opt-out"></a></h3>
   <p>The Private Attribution API
is designed to reveal only aggregate information.
The use of <a href="#dp">differential privacy</a> limits the chance of determining whether any particular user
contributed to the aggregated output.
However, some users may still prefer
not to participate in attribution measurement.
As discussed in <a href="#opt-out">§ 4.5.1 Optional Participation</a>, the user agent must provide
a mechanism for the user to disable the Private Attribution API.</p>
   <p>To minimize the risk of <a data-link-type="dfn" href="https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting" id="ref-for-dfn-browser-fingerprinting">fingerprinting</a>,
and to prevent discrimination
against users who choose to disable the Private Attribution API,
sites must not be able to detect that the API is disabled.
Specifically, all calls to the Private Attribution API
that are otherwise valid
must complete successfully, even when the API is disabled.
The only difference in behavior
is that <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②②">conversion reports</a> returned when the API is disabled
will never report any <a data-link-type="dfn" href="#conversion-value" id="ref-for-conversion-value⑧">conversion value</a>.
Because the reports are encrypted,
this difference cannot be detected
by the site receiving the conversion report.</p>
   <h3 class="heading settled" data-level="10.3" id="unconfigured"><span class="secno">10.3. </span><span class="content">Unconfigured Browsers</span><a class="self-link" href="#unconfigured"></a></h3>
   <p>This API assumes that <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⑤">user agent</a> instances
have all of the configuration necessary
to answer requests to <a data-link-type="functionish" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②④">measureConversion()</a>.</p>
   <p>If the <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①⑥">aggregation service</a> configuration necessary
for invoking <a data-link-type="functionish" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②⑤">measureConversion()</a> is either absent or out of date,
that could be observable to sites.</p>
   <p>If the retrieval of configuration
could delay the resolution of a call to <a data-link-type="functionish" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②⑥">measureConversion()</a>,
this creates a timing side channel.
If a fake response is generated instead, differences between
a response from a properly configured <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⑥">user agent</a> and a fake response
might be observable.
This might be the use of key identifiers or
other unencrypted metadata.
A difference in ciphertext length might also reveal changes to what is encrypted
or changes in choice of algorithm.</p>
   <p>Detecting stale or absent configuration might be used
to <a data-link-type="dfn" data-refhint-key="ebb755bb" href="https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting" id="ref-for-dfn-browser-fingerprinting①">fingerprint</a> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⑦">user agent</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⑧">user agent</a> <span class="allow-2119">should</span> therefore
prioritize the acquisition of <a data-link-type="dfn" href="#aggregation-service" id="ref-for-aggregation-service①⑦">aggregation service</a> configuration
in a way that is not observable to sites.
This might be achieved by obtaining configuration at startup,
before starting to load any content.</p>
   <p>If the necessary configuration cannot be obtained,
or is obviously stale,
an implementation might choose to immediately reject
when <a data-link-type="functionish" href="#dom-privateattribution-measureconversion" id="ref-for-dom-privateattribution-measureconversion②⑦">measureConversion()</a> is invoked.
This leaks information,
but it could leak less than attempting to generate a fake value.</p>
   <h3 class="heading settled" data-level="10.4" id="privacy-impression-store"><span class="secno">10.4. </span><span class="content">Including Identifying Information with Saved Impressions</span><a class="self-link" href="#privacy-impression-store"></a></h3>
   <p>Sites are able to encode some amount of data
in impressions,
using <code class="idl"><a data-link-type="idl" href="#dom-privateattributionimpressionoptions-matchvalue" id="ref-for-dom-privateattributionimpressionoptions-matchvalue⑤">matchValue</a></code> or other fields.
The API does not prevent sites from encoding user identifiers
in these fields.
The attribution process can use this data
when constructing a <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②③">conversion report</a>,
which implies some risk of that identifying information
becoming available to the site that receives that report.
The following measures mitigate this risk:</p>
   <ul>
    <li data-md>
     <p>The <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⑦">impression store</a> cannot be read directly.
Thus, identifiers are only usable for tracking
to the extent information about them
is revealed in <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②④">conversion reports</a>.</p>
    <li data-md>
     <p>The information in <a data-link-type="dfn" href="#conversion-report" id="ref-for-conversion-report②⑤">conversion reports</a> is only revealed
after aggregation and the addition of noise.</p>
    <li data-md>
     <p>Users have the ability to <a href="#removing-impressions">clear the impression store</a>.</p>
    <li data-md>
     <p>No impressions are saved to the impression store
when the Private Attribution API is <a href="#opt-out">disabled</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="10.5" id="privacy-third-party-contexts"><span class="secno">10.5. </span><span class="content">Use in Third-party Contexts</span><a class="self-link" href="#privacy-third-party-contexts"></a></h3>
   <p>The Private Attribution API is available even in third-party contexts.
In particular, a third-party iframe
may call <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression" id="ref-for-dom-privateattribution-saveimpression②⓪">saveImpression()</a>.
Note, however, that the impression is recorded with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③①">site</a> of the top-level navigation context, not the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#concept-origin" id="ref-for-concept-origin⑦">origin</a> of the iframe.</p>
   <p>While the availability of the API in third-party contexts
carries some increase in privacy risk,
this support is deemed necessary
because iframes are commonly used to display advertisements.</p>
   <h3 class="heading settled" data-level="10.6" id="clear-budget-store"><span class="secno">10.6. </span><span class="content">Clearing API State</span><a class="self-link" href="#clear-budget-store"></a></h3>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②⑨">user agent</a> might present the option to clear storage.
These exist for two reasons:</p>
   <ul>
    <li data-md>
     <p>Privacy toward sites,
so that the sites cannot recognize the <a data-link-type="dfn" href="https://drafts.csswg.org/css-2024/#user" id="ref-for-user②">user</a> in future interactions
(that is, to prevent <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#same-site-recognition" id="ref-for-same-site-recognition①">same-site recognition</a>).</p>
    <li data-md>
     <p>Removing traces of activity locally,
so that other users of a computer
cannot access browsing history.</p>
   </ul>
   <p>Clearing the state that tracks <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②①">privacy budget</a> expenditure
has an adverse effect on privacy toward sites.
Sites would then be able to gain more information
from attribution.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⓪">user agent</a> may clear data
from the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①②">privacy budget store</a> and <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store⑧">epoch start store</a> when the API is <a href="#opt-out">disabled</a>.
In that case, if the API is re-enabled,
there is no way to determine what budget was expended
prior to the API being <a href="#opt-out">disabled</a>.
In that case, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③①">user agent</a> can update
the value of <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear⑥">last browsing history clear</a> to ensure that <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②②">privacy budgets</a> are not inadvertently exceeded.</p>
   <h4 class="heading settled" data-level="10.6.1" id="clear-site-data"><span class="secno">10.6.1. </span><span class="content">Clearing Site Data</span><a class="self-link" href="#clear-site-data"></a></h4>
   <p>When clearing site data at the request of a <a data-link-type="dfn" href="https://drafts.csswg.org/css-2024/#user" id="ref-for-user③">user</a>,
but retaining browsing history,
a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③②">user agent</a> can <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑥">set</a> the value
in the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①③">privacy budget store</a> to 0 for all <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⑦">epochs</a> for all affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③②">sites</a>.</p>
   <p>When clearing site data at the request of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③③">site</a>,
through the use of the `<code><a data-link-type="http-header" href="https://w3c.github.io/webappsec-clear-site-data/#http-headerdef-clear-site-data" id="ref-for-http-headerdef-clear-site-data①">Clear-Site-Data</a></code>` header,
A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③③">user agent</a> only <a href="#removing-impressions">removes impressions</a>,
without altering either the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①④">privacy budget store</a> or the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store⑨">epoch start store</a> for affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③④">sites</a>.</p>
   <h4 class="heading settled" data-level="10.6.2" id="clear-browsing-history"><span class="secno">10.6.2. </span><span class="content">Clearing Browsing History</span><a class="self-link" href="#clear-browsing-history"></a></h4>
   <p>Updating the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①⑤">privacy budget store</a> is insufficient
when clearing browsing history.
Retaining per-<a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⑤">site</a> information
necessary to prevent privacy loss toward sites
leaves information about visits to sites
for other users of a computer to discover
when removing browsing history.</p>
   <p>When clearing browsing history, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③④">user agents</a> need to
remove all per-<a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⑥">site</a> <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②③">privacy budget</a> information
(that is, remove entries from both the <a data-link-type="dfn" href="#privacy-budget-store" id="ref-for-privacy-budget-store①⑥">privacy budget store</a> and the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store①⓪">epoch start store</a>). <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⑤">User agents</a> also need to ensure that
any subsequent <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②④">privacy budget</a> expenditure
cannot cause privacy loss in excess of configured limits
as a result of losing that information.</p>
   <p>This can be achieved by disabling attribution
for a period between one and two <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⑧">epochs</a> from the point that browsing history is discarded.
Otherwise, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⑦">site</a> that expends its budget
immediately prior to the clearing of history
would be able to learn more through the API
than it could without the clearing of state.</p>
   <p class="note" role="note"> This disables the API for up to <em>two</em> <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch③⑨">epochs</a> for affected <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⑧">sites</a>.
Because the <a data-link-type="dfn" href="#epoch-start-store" id="ref-for-epoch-start-store①①">epoch start store</a> is cleared,
the start of any newly-defined <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④⓪">epoch</a> for that <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site③⑨">site</a> becomes unknown.
Any new <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④①">epoch</a> will <a href="#s-epoch-start">start at a fresh randomly-selected time</a>,
which cannot overlap with any <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④②">epoch</a> that might have been defined
before history was cleared. </p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⑥">user agent</a> remembers when history was last cleared
in the <a data-link-type="dfn" href="#last-browsing-history-clear" id="ref-for-last-browsing-history-clear⑦">last browsing history clear</a> value.
This is used to prevent <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⑤">budget</a> expenditure
until it is guaranteed that a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site④⓪">site</a> cannot exceed
the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⑦">user agent</a>-chosen maximum allowed <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⑥">privacy budget</a>.</p>
   <p>The <a data-link-type="dfn" href="#get-the-starting-epoch-for-attribution" id="ref-for-get-the-starting-epoch-for-attribution①">get the starting epoch for attribution</a> algorithm
ensures that a <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site①②">conversion site</a> cannot query <a data-link-type="dfn" href="#impression" id="ref-for-impression③⑨">impressions</a> from any <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④③">epoch</a> that starts within one <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④④">epoch</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration④">duration</a> from when state is cleared.</p>
   <h4 class="heading settled" data-level="10.6.3" id="removing-impressions"><span class="secno">10.6.3. </span><span class="content">Clearing Impressions</span><a class="self-link" href="#removing-impressions"></a></h4>
   <p>A mechanism must be provided to clear the <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⑧">impression store</a>.
For example, the impression store could be cleared
upon activation of the control that <a href="#opt-out">disables</a> the Private Attribution API.</p>
   <p>It is recommended that any mechanism a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⑧">user agent</a> provides
to clear stored data (history, cookies, etc.)
be extended to cover the impression store. <a href="#clear-budget-store">§ 10.6 Clearing API State</a> provides more detailed information
on the clearing of stored data.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③⑨">user agent</a> that clears state for a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#site" id="ref-for-site④①">site</a> must discard all <a data-link-type="dfn" href="#impression-store" id="ref-for-impression-store①⑨">saved impressions</a> that were saved during the affected period
with a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site④">matching</a> <a data-link-type="dfn" href="#impression-impression-site" id="ref-for-impression-impression-site③">impression site</a> or <a data-link-type="dfn" href="#impression-conversion-sites" id="ref-for-impression-conversion-sites⑧">conversion site</a>.
For an <a data-link-type="dfn" href="#impression-site" id="ref-for-impression-site⑨">impression site</a>,
these <a data-link-type="dfn" href="#impression" id="ref-for-impression④⓪">impressions</a> relate to activity that was cleared.
A <a data-link-type="dfn" href="#conversion-site" id="ref-for-conversion-site①③">conversion site</a> that has had state cleared
will not be able to use these <a data-link-type="dfn" href="#impression" id="ref-for-impression④①">impressions</a>.</p>
   <p><a data-link-type="dfn" href="#impression" id="ref-for-impression④②">Impressions</a> that have a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#same-site" id="ref-for-same-site⑤">matching</a> <a data-link-type="dfn" href="#impression-intermediary-site" id="ref-for-impression-intermediary-site③">intermediary site</a> may be retained.</p>
   <h3 class="heading settled" data-level="10.7" id="why-wall-clock"><span class="secno">10.7. </span><span class="content">Choice of Clock</span><a class="self-link" href="#why-wall-clock"></a></h3>
   <p>This API uses a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock②">wall clock</a> as its basis for time.
This is primarily because the API relies on a persistent notion of time.
A <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-monotonic-clock" id="ref-for-dfn-monotonic-clock">monotonic clock</a> is only defined during a single execution of a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④⓪">user agent</a>,
so it has no guarantee of consistency if a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④①">user agent</a> is restarted.</p>
   <p>A <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock③">wall clock</a> can be adjusted to account for errors that might accumulate
due to clock drift.
A <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock④">wall clock</a> therefore is not guaranteed to always advance at a consistent rate,
including the possibility that it might sometimes decrease.</p>
   <p>Decreases in the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑤">wall clock</a> do not affect the privacy guarantees
that this API provides.
Only increases in the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑥">clock</a>,
can have an adverse privacy effect.
Increases above the normal progress of time
might result in the renewal of <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⑦">privacy budget</a> more quickly than intended.</p>
   <p>For a clock that undergoes corrections within each <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④⑤">epoch</a>,
clock adjustments will have no privacy effect.
A single correction that is sufficiently large
might cause <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⑧">privacy budgets</a> to be renewed
ahead of schedule,
resulting in a one-time increase in privacy loss.
Continuous large corrections have the most serious effect on privacy,
as each transition between epochs
will release additional <a data-link-type="dfn" href="#privacy-budgets" id="ref-for-privacy-budgets②⑨">privacy budget</a>.</p>
   <p class="note" role="note">A very large increase in time
that skips entire <a data-link-type="dfn" href="#privacy-budget-epoch" id="ref-for-privacy-budget-epoch④⑥">epochs</a> does not result in additional privacy loss.
No privacy loss is possible
unless an <a data-link-type="dfn" href="#impression" id="ref-for-impression④③">impression</a> can be <a href="#save-impression-api">saved</a>. </p>
   <p>Of course, any <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④②">user agent</a> that has a need for large
or continuous
corrections to its clock will likely be highly identifiable
as a result of the time that it reports.
That alone is likely enough to enable unwanted <a data-link-type="dfn" href="https://w3ctag.github.io/privacy-principles/#cross-site-recognition" id="ref-for-cross-site-recognition①">cross-site recognition</a>.</p>
   <h2 class="heading settled" data-level="11" id="ack"><span class="secno">11. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>This specification is the result of a lot of work from many people.
The broad shape of this level of the API is based on an idea from Luke Winstrom.
The privacy architecture is courtesy of the authors of <a data-link-type="biblio" href="#biblio-ppa-dp" title="Cookie Monster: Efficient On-device Budgeting for Differentially-Private Ad-Measurement Systems">[PPA-DP]</a>.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#actions">actions</a><span>, in § 1.1</span>
   <li><a href="#aggregation-service">aggregation service</a><span>, in § 7</span>
   <li><a href="#dom-privateattributionconversionoptions-aggregationservice">aggregationService</a><span>, in § 3.5</span>
   <li><a href="#dom-privateattribution-aggregationservices">aggregationServices</a><span>, in § 3.3</span>
   <li><a href="#attribution">attributed</a><span>, in § 1.1</span>
   <li><a href="#attribution">attribution</a><span>, in § 1.1</span>
   <li><a href="#attribution-logic">attribution logic</a><span>, in § 4.4.1</span>
   <li><a href="#clear-impressions-for-a-conversion-site">clear impressions for a conversion site</a><span>, in § 4.1.3</span>
   <li><a href="#common-matching-logic">common matching logic</a><span>, in § 4.4.2</span>
   <li><a href="#conversion">conversion</a><span>, in § 1.1</span>
   <li><a href="#conversion-report">conversion report</a><span>, in § 2</span>
   <li><a href="#conversion-site">conversion site</a><span>, in § 3.1</span>
   <li><a href="#impression-conversion-sites">Conversion Sites</a><span>, in § 4.1.1</span>
   <li><a href="#dom-privateattributionimpressionoptions-conversionsites">conversionSites</a><span>, in § 3.4</span>
   <li><a href="#conversion-value">conversion value</a><span>, in § 1.6</span>
   <li><a href="#create-an-all-zero-histogram">create an all-zero histogram</a><span>, in § 4.4.1</span>
   <li><a href="#dom-privateattributionprotocol-dap-12-histogram">"dap-12-histogram"</a><span>, in § 3.3</span>
   <li><a href="#dom-privateattributionprotocol-dap-12-histogram">dap-12-histogram</a><span>, in § 3.3</span>
   <li><a href="#day">day</a><span>, in § 4.2.2</span>
   <li><a href="#deduct-privacy-budget">deduct privacy budget</a><span>, in § 4.2.1</span>
   <li><a href="#differential-privacy">differential privacy</a><span>, in § 8</span>
   <li><a href="#do-attribution-and-fill-a-histogram">do attribution and fill a histogram</a><span>, in § 4.4.1</span>
   <li><a href="#privacy-budget-epoch">epoch</a><span>, in § 4.2.2</span>
   <li><a href="#epoch-index">epoch index</a><span>, in § 4.2.2</span>
   <li><a href="#epoch-index">epoch indices</a><span>, in § 4.2.2</span>
   <li><a href="#epoch-start-store">epoch start store</a><span>, in § 4.2.2</span>
   <li><a href="#dom-privateattributionconversionoptions-epsilon">epsilon</a><span>, in § 3.5</span>
   <li><a href="#fill-a-histogram-with-last-touch-attribution">fill a histogram with last-touch attribution</a><span>, in § 4.4.2.1</span>
   <li><a href="#get-the-current-epoch">get the current epoch</a><span>, in § 4.2.2</span>
   <li><a href="#get-the-starting-epoch-for-attribution">get the starting epoch for attribution</a><span>, in § 4.2.3</span>
   <li><a href="#impression-histogram-index">Histogram Index</a><span>, in § 4.1.1</span>
   <li><a href="#dom-privateattributionimpressionoptions-histogramindex">histogramIndex</a><span>, in § 3.4</span>
   <li><a href="#dom-privateattributionconversionoptions-histogramsize">histogramSize</a><span>, in § 3.5</span>
   <li><a href="#impression">impression</a><span>, in § 1.1</span>
   <li><a href="#impression-impression-site">Impression Site</a><span>, in § 4.1.1</span>
   <li><a href="#impression-site">impression site</a><span>, in § 3.1</span>
   <li><a href="#dom-privateattributionconversionoptions-impressionsites">impressionSites</a><span>, in § 3.5</span>
   <li><a href="#impression-store">impression store</a><span>, in § 4.1</span>
   <li><a href="#individual-differential-privacy">individual differential privacy</a><span>, in § 8</span>
   <li><a href="#impression-intermediary-site">Intermediary Site</a><span>, in § 4.1.1</span>
   <li><a href="#intermediary-site">intermediary site</a><span>, in § 3.1</span>
   <li><a href="#dom-privateattributionconversionoptions-intermediarysites">intermediarySites</a><span>, in § 3.5</span>
   <li><a href="#last-browsing-history-clear">last browsing history clear</a><span>, in § 4.2.3</span>
   <li><a href="#dom-privateattributionlogic-last-touch">"last-touch"</a><span>, in § 3.5</span>
   <li><a href="#impression-lifetime">Lifetime</a><span>, in § 4.1.1</span>
   <li><a href="#dom-privateattributionimpressionoptions-lifetimedays">lifetimeDays</a><span>, in § 3.4</span>
   <li><a href="#dom-privateattributionconversionoptions-logic">logic</a><span>, in § 3.5</span>
   <li><a href="#dom-privateattributionconversionoptions-lookbackdays">lookbackDays</a><span>, in § 3.5</span>
   <li><a href="#impression-match-value">Match Value</a><span>, in § 4.1.1</span>
   <li>
    matchValue
    <ul>
     <li><a href="#dom-privateattributionconversionoptions-matchvalue">dict-member for PrivateAttributionConversionOptions</a><span>, in § 3.5</span>
     <li><a href="#dom-privateattributionimpressionoptions-matchvalue">dict-member for PrivateAttributionImpressionOptions</a><span>, in § 3.4</span>
    </ul>
   <li><a href="#dom-privateattributionconversionoptions-maxvalue">maxValue</a><span>, in § 3.5</span>
   <li><a href="#dom-permissionpolicy-measure-conversion">measure-conversion</a><span>, in § 3.6</span>
   <li><a href="#dom-privateattribution-measureconversion">measureConversion(options)</a><span>, in § 4.4</span>
   <li><a href="#microepsilon">microepsilon</a><span>, in § 4.2.1</span>
   <li><a href="#mpc">MPC</a><span>, in § 7.1</span>
   <li><a href="#outcomes">outcomes</a><span>, in § 1.1</span>
   <li><a href="#parse-a-site">parse a site</a><span>, in § 4.1.4</span>
   <li><a href="#prio3l1boundsum">Prio3L1BoundSum</a><span>, in § 7.1.1</span>
   <li><a href="#privacy-budget-epoch">privacy budget epoch</a><span>, in § 4.2.2</span>
   <li><a href="#privacy-budget-key">privacy budget key</a><span>, in § 4.2.1</span>
   <li><a href="#privacy-budgets">privacy budgets</a><span>, in § 8.2</span>
   <li><a href="#privacy-budget-store">privacy budget store</a><span>, in § 4.2.1</span>
   <li><a href="#privacy-unit">privacy unit</a><span>, in § 8.1</span>
   <li><a href="#privateattribution">PrivateAttribution</a><span>, in § 3.3</span>
   <li><a href="#dom-navigator-privateattribution">privateAttribution</a><span>, in § 3.2</span>
   <li><a href="#dictdef-privateattributionaggregationservice">PrivateAttributionAggregationService</a><span>, in § 3.3</span>
   <li><a href="#privateattributionaggregationservices">PrivateAttributionAggregationServices</a><span>, in § 3.3</span>
   <li><a href="#dictdef-privateattributionconversionoptions">PrivateAttributionConversionOptions</a><span>, in § 3.5</span>
   <li><a href="#dictdef-privateattributionconversionresult">PrivateAttributionConversionResult</a><span>, in § 3.5</span>
   <li><a href="#dictdef-privateattributionimpressionoptions">PrivateAttributionImpressionOptions</a><span>, in § 3.4</span>
   <li><a href="#enumdef-privateattributionlogic">PrivateAttributionLogic</a><span>, in § 3.5</span>
   <li><a href="#enumdef-privateattributionprotocol">PrivateAttributionProtocol</a><span>, in § 3.3</span>
   <li><a href="#private-attribution-task-source">Private Attribution task source</a><span>, in § 4.4</span>
   <li><a href="#dom-privateattributionaggregationservice-protocol">protocol</a><span>, in § 3.3</span>
   <li><a href="#dom-privateattributionconversionresult-report">report</a><span>, in § 3.5</span>
   <li><a href="#safety-limits">safety limits</a><span>, in § 8.2.2</span>
   <li><a href="#http-headerdef-save-impression">Save-Impression</a><span>, in § 5</span>
   <li><a href="#dom-permissionpolicy-save-impression">save-impression</a><span>, in § 3.6</span>
   <li><a href="#dom-privateattribution-saveimpression">saveImpression(options)</a><span>, in § 4.3</span>
   <li><a href="#tee">TEE</a><span>, in § 7.2</span>
   <li><a href="#dom-privateattributionprotocol-tee-00">"tee-00"</a><span>, in § 3.3</span>
   <li><a href="#dom-privateattributionprotocol-tee-00">tee-00</a><span>, in § 3.3</span>
   <li><a href="#impression-timestamp">Timestamp</a><span>, in § 4.1.1</span>
   <li><a href="#dom-privateattributionconversionoptions-value">value</a><span>, in § 3.5</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0bae610b">collective privacy</span>
     <li><span class="dfn-paneled" id="bb024394">cross-context recognition</span>
     <li><span class="dfn-paneled" id="67d1a77c">cross-site recognition</span>
     <li><span class="dfn-paneled" id="1eeaf38c">fingerprint</span>
     <li><span class="dfn-paneled" id="b17b90b8">fingerprinting</span>
     <li><span class="dfn-paneled" id="72367d94">same-site recognition</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CLEAR-SITE-DATA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3bc9b705">Clear-Site-Data</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-2024]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4998af2d">user</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2b269166">current coarsened wall time</span>
     <li><span class="dfn-paneled" id="f16ee824">current wall time</span>
     <li><span class="dfn-paneled" id="4b2c8c72">duration</span>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
     <li><span class="dfn-paneled" id="28716de1">monotonic clock</span>
     <li><span class="dfn-paneled" id="05de5ae3">wall clock</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
     <li><span class="dfn-paneled" id="f23dc013">child navigable</span>
     <li><span class="dfn-paneled" id="83e6b2d5">host</span>
     <li><span class="dfn-paneled" id="9314b883">iframe</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="1e0499f9">obtain a site</span>
     <li><span class="dfn-paneled" id="b4f2d668">origin</span>
     <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="5991ccfb">relevant realm</span>
     <li><span class="dfn-paneled" id="432e3325">relevant settings object</span>
     <li><span class="dfn-paneled" id="1318f17c">same site</span>
     <li><span class="dfn-paneled" id="5eabf903">scheme</span>
     <li><span class="dfn-paneled" id="61422a5c">scheme-and-host</span>
     <li><span class="dfn-paneled" id="c7061b41">site</span>
     <li><span class="dfn-paneled" id="c3b2d08c">task source</span>
     <li><span class="dfn-paneled" id="440b74d2">top-level origin</span>
     <li><span class="dfn-paneled" id="1d2aa117">tuple origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d17867da">32-bit unsigned integer</span>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="ae8def21">contain <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a326add7">contain <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="8958b003">entry</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="f8802320">extend</span>
     <li><span class="dfn-paneled" id="527b10aa">get</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="6b815fdd">is empty</span>
     <li><span class="dfn-paneled" id="5afbefcd">item</span>
     <li><span class="dfn-paneled" id="f02cd417">iterate</span>
     <li><span class="dfn-paneled" id="d14a6f26">key</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="99c988d6">remove</span>
     <li><span class="dfn-paneled" id="3a3a8e72">set</span>
     <li><span class="dfn-paneled" id="0e6b2056">set <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="0204d188">size</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1710bef4">*</span>
     <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
     <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STORAGE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7f6a70d1">storage key</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STRUCTURED HEADER]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f40a11c6">dictionary</span>
     <li><span class="dfn-paneled" id="e539dd89">inner list</span>
     <li><span class="dfn-paneled" id="acfe060e">integer</span>
     <li><span class="dfn-paneled" id="de07e6f6">string</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="eea18c0d">domain label</span>
     <li><span class="dfn-paneled" id="390a49fa">host parser</span>
     <li><span class="dfn-paneled" id="bc9d7803">registrable domain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="ec878a66">RangeError</span>
     <li><span class="dfn-paneled" id="c0f98cd7">ReferenceError</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="be2d2b4c">SyntaxError</span>
     <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
     <li><span class="dfn-paneled" id="95d7775a">Uint8Array</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="8c800cdf">double</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
     <li><span class="dfn-paneled" id="e97a9688">unsigned long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-clear-site-data">[CLEAR-SITE-DATA]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-clear-site-data/"><cite>Clear Site Data</cite></a>. URL: <a href="https://w3c.github.io/webappsec-clear-site-data/">https://w3c.github.io/webappsec-clear-site-data/</a>
   <dt id="biblio-css-2024">[CSS-2024]
   <dd>Chris Lilley; et al. <a href="https://drafts.csswg.org/css-2024/"><cite>CSS Snapshot 2024</cite></a>. URL: <a href="https://drafts.csswg.org/css-2024/">https://drafts.csswg.org/css-2024/</a>
   <dt id="biblio-dap-ext">[DAP-EXT]
   <dd>Martin Thomson. <a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/"><cite>Distributed Aggregation Protocol (DAP) Extensions for Improved Application of Differential Privacy</cite></a>. 2024-10-18. URL: <a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/">https://datatracker.ietf.org/doc/draft-thomson-ppm-dap-dp-ext/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-cookies">[COOKIES]
   <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>. April 2011. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
   <dt id="biblio-coppacalypse">[COPPACALYPSE]
   <dd>Garrett Johnson; et al. <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4430334"><cite>COPPAcalypse? The Youtube Settlement's Impact on Kids Content</cite></a>. 2024-03-14. URL: <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4430334">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4430334</a>
   <dt id="biblio-dap">[DAP]
   <dd>Tim Geoghegan; et al. <a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-12"><cite>Distributed Aggregation Protocol for Privacy Preserving Measurement</cite></a>. 2024-10-10. URL: <a href="https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-12">https://datatracker.ietf.org/doc/html/draft-ietf-ppm-dap-12</a>
   <dt id="biblio-dp">[DP]
   <dd>Cynthia Dwork; Aaron Roth. <a href="https://doi.org/10.1561/0400000042"><cite>The Algorithmic Foundations of Differential Privacy</cite></a>. 2014. URL: <a href="https://doi.org/10.1561/0400000042">https://doi.org/10.1561/0400000042</a>
   <dt id="biblio-eu-ad">[EU-AD]
   <dd>Niklas FOURBERG; et al. <a href="https://www.europarl.europa.eu/thinktank/en/document/IPOL_STU(2021)662913"><cite>Online advertising: the impact of targeted advertising on advertisers, market access and consumer choice</cite></a>. 2021-06. URL: <a href="https://www.europarl.europa.eu/thinktank/en/document/IPOL_STU(2021)662913">https://www.europarl.europa.eu/thinktank/en/document/IPOL_STU(2021)662913</a>
   <dt id="biblio-fedcm">[FEDCM]
   <dd>Nicolas Pena Moreno. <a href="https://w3c-fedid.github.io/FedCM/"><cite>Federated Credential Management API</cite></a>. URL: <a href="https://w3c-fedid.github.io/FedCM/">https://w3c-fedid.github.io/FedCM/</a>
   <dt id="biblio-free-gdp">[FREE-GDP]
   <dd>Leonard Nakamura; Jon D. Samuels; Rachel Soloveichik. <a href="https://www.bea.gov/research/papers/2017/measuring-free-digital-economy-within-gdp-and-productivity-accounts"><cite>Measuring the "Free" Digital Economy within the GDP and Productivity Accounts</cite></a>. 2017-10. URL: <a href="https://www.bea.gov/research/papers/2017/measuring-free-digital-economy-within-gdp-and-productivity-accounts">https://www.bea.gov/research/papers/2017/measuring-free-digital-economy-within-gdp-and-productivity-accounts</a>
   <dt id="biblio-online-advertising">[ONLINE-ADVERTISING]
   <dd>Avi Goldfarb; Catherine Tucker. <a href="http://www-2.rotman.utoronto.ca/~agoldfarb/OnlineAdvertising.pdf"><cite>Online Advertising</cite></a>. URL: <a href="http://www-2.rotman.utoronto.ca/~agoldfarb/OnlineAdvertising.pdf">http://www-2.rotman.utoronto.ca/~agoldfarb/OnlineAdvertising.pdf</a>
   <dt id="biblio-ppa-dp">[PPA-DP]
   <dd>Pierre Tholoniat; et al. <a href="https://arxiv.org/abs/2405.16719"><cite>Cookie Monster: Efficient On-device Budgeting for Differentially-Private Ad-Measurement Systems</cite></a>. URL: <a href="https://arxiv.org/abs/2405.16719">https://arxiv.org/abs/2405.16719</a>
   <dt id="biblio-prio">[PRIO]
   <dd>Henry Corrigan-Gibbs; Dan Boneh. <a href="https://crypto.stanford.edu/prio/paper.pdf"><cite>Prio: Private, Robust, and Scalable Computation of Aggregate Statistics</cite></a>. 2017-03-14. URL: <a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>
   <dt id="biblio-prio-l1">[PRIO-L1]
   <dd>Martin Thomson; David Cook. <a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-l1-bound-sum/"><cite>A Prio Instantiation for Vector Sums with an L1 Norm Bound on Contributions</cite></a>. 2024-10-21. URL: <a href="https://datatracker.ietf.org/doc/draft-thomson-ppm-l1-bound-sum/">https://datatracker.ietf.org/doc/draft-thomson-ppm-l1-bound-sum/</a>
   <dt id="biblio-rfc3492">[RFC3492]
   <dd>A. Costello. <a href="https://www.rfc-editor.org/rfc/rfc3492"><cite>Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)</cite></a>. March 2003. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3492">https://www.rfc-editor.org/rfc/rfc3492</a>
   <dt id="biblio-rfc5890">[RFC5890]
   <dd>J. Klensin. <a href="https://www.rfc-editor.org/rfc/rfc5890"><cite>Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework</cite></a>. August 2010. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5890">https://www.rfc-editor.org/rfc/rfc5890</a>
   <dt id="biblio-storage">[STORAGE]
   <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. Living Standard. URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
   <dt id="biblio-unsanctioned-tracking">[UNSANCTIONED-TRACKING]
   <dd>Mark Nottingham. <a href="http://www.w3.org/2001/tag/doc/unsanctioned-tracking/"><cite>Unsanctioned Web Tracking</cite></a>. 17 July 2015. TAG Finding. URL: <a href="http://www.w3.org/2001/tag/doc/unsanctioned-tracking/">http://www.w3.org/2001/tag/doc/unsanctioned-tracking/</a>
   <dt id="biblio-vdaf">[VDAF]
   <dd>Richard L. Barnes; et al. <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-vdaf/"><cite>Verifiable Distributed Aggregation Functions</cite></a>. 2024-10-04. URL: <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-vdaf/">https://datatracker.ietf.org/doc/draft-irtf-cfrg-vdaf/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- g>Navigator</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateattribution"><c- n>PrivateAttribution</c-></a> <a data-readonly data-type="PrivateAttribution" href="#dom-navigator-privateattribution"><code><c- g>privateAttribution</c-></code></a>;
};

<c- b>enum</c-> <a class="idl-code" data-link-type="enum" href="#enumdef-privateattributionprotocol"><c- g>PrivateAttributionProtocol</c-></a> { <a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionprotocol-dap-12-histogram"><c- s>"dap-12-histogram"</c-></a>, <a class="idl-code" data-link-type="enum-value" href="#dom-privateattributionprotocol-tee-00"><c- s>"tee-00"</c-></a> };

<c- b>dictionary</c-> <a href="#dictdef-privateattributionaggregationservice"><code><c- g>PrivateAttributionAggregationService</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="DOMString" href="#dom-privateattributionaggregationservice-protocol"><c- g>protocol</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#privateattributionaggregationservices"><code><c- g>PrivateAttributionAggregationServices</c-></code></a> {
  <c- b>readonly</c-> <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>, <a data-link-type="idl-name" href="#dictdef-privateattributionaggregationservice"><c- n>PrivateAttributionAggregationService</c-></a>>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#privateattribution"><code><c- g>PrivateAttribution</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateattributionaggregationservices"><c- n>PrivateAttributionAggregationServices</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="PrivateAttributionAggregationServices" href="#dom-privateattribution-aggregationservices"><c- g>aggregationServices</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-privateattributionimpressionoptions"><code><c- g>PrivateAttributionImpressionOptions</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-histogramindex"><c- g>histogramIndex</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="0" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-matchvalue"><c- g>matchValue</c-></a> = 0;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionimpressionoptions-conversionsites"><c- g>conversionSites</c-></a> = [];
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="30" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionimpressionoptions-lifetimedays"><c- g>lifetimeDays</c-></a> = 30;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateattribution"><c- g>PrivateAttribution</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateattribution-saveimpression"><c- g>saveImpression</c-></a>(<a data-link-type="idl-name" href="#dictdef-privateattributionimpressionoptions"><c- n>PrivateAttributionImpressionOptions</c-></a> <a href="#dom-privateattribution-saveimpression-options-options"><code><c- g>options</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-privateattributionconversionoptions"><code><c- g>PrivateAttributionConversionOptions</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString" href="#dom-privateattributionconversionoptions-aggregationservice"><c- g>aggregationService</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a class="idl-code" data-default="1.0" data-link-type="dict-member" data-type="double" href="#dom-privateattributionconversionoptions-epsilon"><c- g>epsilon</c-></a> = 1.0;

  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-histogramsize"><c- g>histogramSize</c-></a>;

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-lookbackdays"><c- g>lookbackDays</c-></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<unsigned long>" href="#dom-privateattributionconversionoptions-matchvalue"><c- g>matchValue</c-></a> = [];
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionconversionoptions-impressionsites"><c- g>impressionSites</c-></a> = [];
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-default="[]" data-link-type="dict-member" data-type="sequence<USVString>" href="#dom-privateattributionconversionoptions-intermediarysites"><c- g>intermediarySites</c-></a> = [];

  <a data-link-type="idl-name" href="#enumdef-privateattributionlogic"><c- n>PrivateAttributionLogic</c-></a> <a class="idl-code" data-default="&quot;last-touch&quot;" data-link-type="dict-member" data-type="PrivateAttributionLogic" href="#dom-privateattributionconversionoptions-logic"><c- g>logic</c-></a> = "last-touch";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="1" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-value"><c- g>value</c-></a> = 1;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-default="1" data-link-type="dict-member" data-type="unsigned long" href="#dom-privateattributionconversionoptions-maxvalue"><c- g>maxValue</c-></a> = 1;
};

<c- b>enum</c-> <a href="#enumdef-privateattributionlogic"><code><c- g>PrivateAttributionLogic</c-></code></a> {
  <a href="#dom-privateattributionlogic-last-touch"><code><c- s>"last-touch"</c-></code></a>,
};

<c- b>dictionary</c-> <a href="#dictdef-privateattributionconversionresult"><code><c- g>PrivateAttributionConversionResult</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-Uint8Array"><c- b>Uint8Array</c-></a> <a data-type="Uint8Array" href="#dom-privateattributionconversionresult-report"><code><c- g>report</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateattribution"><c- g>PrivateAttribution</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-privateattributionconversionresult"><c- n>PrivateAttributionConversionResult</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-privateattribution-measureconversion"><c- g>measureConversion</c-></a>(<a data-link-type="idl-name" href="#dictdef-privateattributionconversionoptions"><c- n>PrivateAttributionConversionOptions</c-></a> <a href="#dom-privateattribution-measureconversion-options-options"><code><c- g>options</c-></code></a>);
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> The <a data-link-type="dfn" href="#safety-limits">safety limits</a> need to be described in more detail.
Some references to clearing
the <a data-link-type="dfn" href="#impression-store">impression store</a> may need to be
updated to refer to the <a data-link-type="dfn" href="#privacy-budget-store">privacy budget store</a> as well. <a class="issue-return" href="#issue-03c18889" title="Jump to section">↵</a></div>
   <div class="issue"> Consider merging this section with <a href="#privacy-opt-out">§ 10.2 Disabling the Private Attribution API</a>. <a class="issue-return" href="#issue-6a8ef2ef" title="Jump to section">↵</a></div>
   <div class="issue"> Rate limits on calls to the Private Attribution APIs
could also be an effective mechanism to prevent
harvesting information through overuse of the APIs. <a class="issue-return" href="#issue-2117cd8d" title="Jump to section">↵</a></div>
   <div class="issue"> It is unclear whether the <a data-link-type="dfn" href="#privacy-budget-store">privacy budget store</a> should be cleared whenever
the <a data-link-type="dfn" href="#impression-store">impression store</a> is cleared. On one hand, it contains information about
browsing activity, so it is desirable to include it when clearing browsing activity.
On the other hand, it is only possible to strictly adhere to the requirements of
the differential privacy mechanism if information about a fully- or partially-
depleted privacy budget is maintained until that budget is no longer relevant
(i.e. the end of the <a data-link-type="dfn" href="#privacy-budget-epoch">privacy budget epoch</a>). <a class="issue-return" href="#issue-75e9d0b7" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0204d188": {"dfnID":"0204d188","dfnText":"size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-list-size\u2460"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-list-size\u2461"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"05de5ae3": {"dfnID":"05de5ae3","dfnText":"wall clock","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-wall-clock"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-dfn-wall-clock\u2460"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-dfn-wall-clock\u2461"},{"id":"ref-for-dfn-wall-clock\u2462"},{"id":"ref-for-dfn-wall-clock\u2463"},{"id":"ref-for-dfn-wall-clock\u2464"},{"id":"ref-for-dfn-wall-clock\u2465"}],"title":"10.7. Choice of Clock"}],"url":"https://w3c.github.io/hr-time/#dfn-wall-clock"},
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"},{"id":"ref-for-string\u2460"}],"title":"4.1.4. Site Names"}],"url":"https://infra.spec.whatwg.org/#string"},
"0bae610b": {"dfnID":"0bae610b","dfnText":"collective privacy","external":true,"refSections":[{"refs":[{"id":"ref-for-collective-privacy"}],"title":"1.5. Collective Privacy Effect"}],"url":"https://w3ctag.github.io/privacy-principles/#collective-privacy"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"},{"id":"ref-for-map-set\u2460"},{"id":"ref-for-map-set\u2461"},{"id":"ref-for-map-set\u2462"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-map-set\u2463"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-map-set\u2464"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-map-set\u2465"}],"title":"10.6.1. Clearing Site Data"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"}],"title":"4.2.1. Privacy Budget Store"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-map-exists\u2460"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-map-exists\u2461"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-map-exists\u2462"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"1318f17c": {"dfnID":"1318f17c","dfnText":"same site","external":true,"refSections":[{"refs":[{"id":"ref-for-same-site"},{"id":"ref-for-same-site\u2460"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-same-site\u2461"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-same-site\u2462"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-same-site\u2463"},{"id":"ref-for-same-site\u2464"}],"title":"10.6.3. Clearing Impressions"}],"url":"https://html.spec.whatwg.org/#same-site"},
"1570624a": {"dfnID":"1570624a","dfnText":"default allowlist","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-controlled-feature-default-allowlist"}],"title":"3.6. Permissions Policy Integration"}],"url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"},
"1710bef4": {"dfnID":"1710bef4","dfnText":"*","external":true,"refSections":[{"refs":[{"id":"ref-for-default-allowlist"}],"title":"3.6. Permissions Policy Integration"}],"url":"https://w3c.github.io/webappsec-permissions-policy/#default-allowlist"},
"1d2aa117": {"dfnID":"1d2aa117","dfnText":"tuple origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-tuple"},{"id":"ref-for-concept-origin-tuple\u2460"}],"title":"4.1.3. Clear-Site-Data Integration"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"1e0499f9": {"dfnID":"1e0499f9","dfnText":"obtain a site","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-a-site"},{"id":"ref-for-obtain-a-site\u2460"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-obtain-a-site\u2461"},{"id":"ref-for-obtain-a-site\u2462"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/#obtain-a-site"},
"1e2edd5b": {"dfnID":"1e2edd5b","dfnText":"moment","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-moment"},{"id":"ref-for-dfn-moment\u2460"},{"id":"ref-for-dfn-moment\u2461"},{"id":"ref-for-dfn-moment\u2462"},{"id":"ref-for-dfn-moment\u2463"},{"id":"ref-for-dfn-moment\u2464"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-dfn-moment\u2465"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-dfn-moment\u2466"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-dfn-moment\u2467"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://w3c.github.io/hr-time/#dfn-moment"},
"1eeaf38c": {"dfnID":"1eeaf38c","dfnText":"fingerprint","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-browser-fingerprinting"}],"title":"10.2. Disabling the Private Attribution API"},{"refs":[{"id":"ref-for-dfn-browser-fingerprinting\u2460"}],"title":"10.3. Unconfigured Browsers"}],"url":"https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting"},
"28716de1": {"dfnID":"28716de1","dfnText":"monotonic clock","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-monotonic-clock"}],"title":"10.7. Choice of Clock"}],"url":"https://w3c.github.io/hr-time/#dfn-monotonic-clock"},
"2b269166": {"dfnID":"2b269166","dfnText":"current coarsened wall time","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-current-wall-time"}],"title":"4.2.3. Last Browsing History Clear Time"}],"url":"https://w3c.github.io/hr-time/#dfn-current-wall-time"},
"390a49fa": {"dfnID":"390a49fa","dfnText":"host parser","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-host-parser"}],"title":"4.1.4. Site Names"}],"url":"https://url.spec.whatwg.org/#concept-host-parser"},
"3a3a8e72": {"dfnID":"3a3a8e72","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-sets"},{"id":"ref-for-sets\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-sets\u2461"},{"id":"ref-for-sets\u2462"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-sets\u2463"},{"id":"ref-for-sets\u2464"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-sets\u2465"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-sets\u2466"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-sets\u2467"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-sets\u2468"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-sets\u2460\u24ea"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"https://infra.spec.whatwg.org/#sets"},
"3b90bdcd": {"dfnID":"3b90bdcd","dfnText":"resolve","external":true,"refSections":[{"refs":[{"id":"ref-for-resolve"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#resolve"},
"3bc9b705": {"dfnID":"3bc9b705","dfnText":"Clear-Site-Data","external":true,"refSections":[{"refs":[{"id":"ref-for-http-headerdef-clear-site-data"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-http-headerdef-clear-site-data\u2460"}],"title":"10.6.1. Clearing Site Data"}],"url":"https://w3c.github.io/webappsec-clear-site-data/#http-headerdef-clear-site-data"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-ordered-map\u2460"}],"title":"4.2.2. Epoch Start Store"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-this\u2460"},{"id":"ref-for-this\u2461"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#this"},
"432e3325": {"dfnID":"432e3325","dfnText":"relevant settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-relevant-settings-object"},{"id":"ref-for-relevant-settings-object\u2460"},{"id":"ref-for-relevant-settings-object\u2461"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-relevant-settings-object\u2462"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-relevant-settings-object\u2463"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/#relevant-settings-object"},
"43ac8374": {"dfnID":"43ac8374","dfnText":"origin (for environment settings object)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-origin"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2460"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"440b74d2": {"dfnID":"440b74d2","dfnText":"top-level origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-environment-top-level-origin"},{"id":"ref-for-concept-environment-top-level-origin\u2460"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-concept-environment-top-level-origin\u2461"},{"id":"ref-for-concept-environment-top-level-origin\u2462"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-concept-environment-top-level-origin\u2463"},{"id":"ref-for-concept-environment-top-level-origin\u2464"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/#concept-environment-top-level-origin"},
"4998af2d": {"dfnID":"4998af2d","dfnText":"user","external":true,"refSections":[{"refs":[{"id":"ref-for-user"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-user\u2460"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-user\u2461"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-user\u2462"}],"title":"10.6.1. Clearing Site Data"}],"url":"https://drafts.csswg.org/css-2024/#user"},
"4b2c8c72": {"dfnID":"4b2c8c72","dfnText":"duration","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-duration"},{"id":"ref-for-dfn-duration\u2460"},{"id":"ref-for-dfn-duration\u2461"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-dfn-duration\u2462"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dfn-duration\u2463"}],"title":"10.6.2. Clearing Browsing History"}],"url":"https://w3c.github.io/hr-time/#dfn-duration"},
"527b10aa": {"dfnID":"527b10aa","dfnText":"get","external":true,"refSections":[{"refs":[{"id":"ref-for-map-get"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-map-get\u2460"}],"title":"4.2.2. Epoch Start Store"}],"url":"https://infra.spec.whatwg.org/#map-get"},
"5991ccfb": {"dfnID":"5991ccfb","dfnText":"relevant realm","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-realm"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"5afbefcd": {"dfnID":"5afbefcd","dfnText":"item","external":true,"refSections":[{"refs":[{"id":"ref-for-list-item"}],"title":"4.4.1. Attribution Logic"}],"url":"https://infra.spec.whatwg.org/#list-item"},
"5eabf903": {"dfnID":"5eabf903","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-scheme"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-concept-origin-scheme\u2460"}],"title":"4.1.4. Site Names"}],"url":"https://html.spec.whatwg.org/#concept-origin-scheme"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"}],"title":"3.4. Saving Impressions"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"61422a5c": {"dfnID":"61422a5c","dfnText":"scheme-and-host","external":true,"refSections":[{"refs":[{"id":"ref-for-scheme-and-host"},{"id":"ref-for-scheme-and-host\u2460"}],"title":"4.1.4. Site Names"}],"url":"https://html.spec.whatwg.org/#scheme-and-host"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"4.4.1. Attribution Logic"}],"url":"https://infra.spec.whatwg.org/#list"},
"67d1a77c": {"dfnID":"67d1a77c","dfnText":"cross-site recognition","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-site-recognition"}],"title":"10. Privacy Considerations"},{"refs":[{"id":"ref-for-cross-site-recognition\u2460"}],"title":"10.7. Choice of Clock"}],"url":"https://w3ctag.github.io/privacy-principles/#cross-site-recognition"},
"6b815fdd": {"dfnID":"6b815fdd","dfnText":"is empty","external":true,"refSections":[{"refs":[{"id":"ref-for-list-is-empty"},{"id":"ref-for-list-is-empty\u2460"},{"id":"ref-for-list-is-empty\u2461"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-list-is-empty\u2462"},{"id":"ref-for-list-is-empty\u2463"},{"id":"ref-for-list-is-empty\u2464"},{"id":"ref-for-list-is-empty\u2465"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-list-is-empty\u2466"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"https://infra.spec.whatwg.org/#list-is-empty"},
"6d19ac93": {"dfnID":"6d19ac93","dfnText":"user agent","external":true,"refSections":[{"refs":[{"id":"ref-for-user-agent"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-user-agent\u2460"},{"id":"ref-for-user-agent\u2461"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-user-agent\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-user-agent\u2463"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-user-agent\u2464"},{"id":"ref-for-user-agent\u2465"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-user-agent\u2466"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-user-agent\u2467"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-user-agent\u2468"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-user-agent\u2460\u24ea"},{"id":"ref-for-user-agent\u2460\u2460"},{"id":"ref-for-user-agent\u2460\u2461"},{"id":"ref-for-user-agent\u2460\u2462"},{"id":"ref-for-user-agent\u2460\u2463"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-user-agent\u2460\u2464"},{"id":"ref-for-user-agent\u2460\u2465"},{"id":"ref-for-user-agent\u2460\u2466"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-user-agent\u2460\u2467"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-user-agent\u2460\u2468"}],"title":"7.1.1. Prio and DAP"},{"refs":[{"id":"ref-for-user-agent\u2461\u24ea"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-user-agent\u2461\u2460"},{"id":"ref-for-user-agent\u2461\u2461"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-user-agent\u2461\u2462"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-user-agent\u2461\u2463"}],"title":"9.3. Aggregation Services"},{"refs":[{"id":"ref-for-user-agent\u2461\u2464"},{"id":"ref-for-user-agent\u2461\u2465"},{"id":"ref-for-user-agent\u2461\u2466"},{"id":"ref-for-user-agent\u2461\u2467"}],"title":"10.3. Unconfigured Browsers"},{"refs":[{"id":"ref-for-user-agent\u2461\u2468"},{"id":"ref-for-user-agent\u2462\u24ea"},{"id":"ref-for-user-agent\u2462\u2460"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-user-agent\u2462\u2461"},{"id":"ref-for-user-agent\u2462\u2462"}],"title":"10.6.1. Clearing Site Data"},{"refs":[{"id":"ref-for-user-agent\u2462\u2463"},{"id":"ref-for-user-agent\u2462\u2464"},{"id":"ref-for-user-agent\u2462\u2465"},{"id":"ref-for-user-agent\u2462\u2466"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-user-agent\u2462\u2467"},{"id":"ref-for-user-agent\u2462\u2468"}],"title":"10.6.3. Clearing Impressions"},{"refs":[{"id":"ref-for-user-agent\u2463\u24ea"},{"id":"ref-for-user-agent\u2463\u2460"},{"id":"ref-for-user-agent\u2463\u2461"}],"title":"10.7. Choice of Clock"}],"url":"https://infra.spec.whatwg.org/#user-agent"},
"72367d94": {"dfnID":"72367d94","dfnText":"same-site recognition","external":true,"refSections":[{"refs":[{"id":"ref-for-same-site-recognition"}],"title":"10. Privacy Considerations"},{"refs":[{"id":"ref-for-same-site-recognition\u2460"}],"title":"10.6. Clearing API State"}],"url":"https://w3ctag.github.io/privacy-principles/#same-site-recognition"},
"77b4c09a": {"dfnID":"77b4c09a","dfnText":"assert","external":true,"refSections":[{"refs":[{"id":"ref-for-assert"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"https://infra.spec.whatwg.org/#assert"},
"7f6a70d1": {"dfnID":"7f6a70d1","dfnText":"storage key","external":true,"refSections":[{"refs":[{"id":"ref-for-storage-key"}],"title":"4.1. Impression Store"},{"refs":[{"id":"ref-for-storage-key\u2460"}],"title":"4.2. State For Privacy Budget Management"}],"url":"https://storage.spec.whatwg.org/#storage-key"},
"83e6b2d5": {"dfnID":"83e6b2d5","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-host"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-concept-origin-host\u2460"},{"id":"ref-for-concept-origin-host\u2461"}],"title":"4.1.4. Site Names"}],"url":"https://html.spec.whatwg.org/#concept-origin-host"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-implementation-defined\u2460"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-implementation-defined\u2461"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-implementation-defined\u2462"}],"title":"5. HTTP API"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"},{"id":"ref-for-idl-DOMString\u2460"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"},{"id":"ref-for-Exposed\u2460"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-Exposed\u2461"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-Exposed\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8958b003": {"dfnID":"8958b003","dfnText":"entry","external":true,"refSections":[{"refs":[{"id":"ref-for-map-entry"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://infra.spec.whatwg.org/#map-entry"},
"8c800cdf": {"dfnID":"8c800cdf","dfnText":"double","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-double"},{"id":"ref-for-idl-double\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"a38011ce0"}],"title":"4.2.1. Privacy Budget Store"}],"url":"https://webidl.spec.whatwg.org/#idl-double"},
"9314b883": {"dfnID":"9314b883","dfnText":"iframe","external":true,"refSections":[{"refs":[{"id":"ref-for-child-navigable"}],"title":"3.1. Site Identities"}],"url":"https://html.spec.whatwg.org/#child-navigable"},
"95d7775a": {"dfnID":"95d7775a","dfnText":"Uint8Array","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-Uint8Array"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#idl-Uint8Array"},
"99c988d6": {"dfnID":"99c988d6","dfnText":"remove","external":true,"refSections":[{"refs":[{"id":"ref-for-list-remove"},{"id":"ref-for-list-remove\u2460"},{"id":"ref-for-list-remove\u2461"}],"title":"4.1.3. Clear-Site-Data Integration"}],"url":"https://infra.spec.whatwg.org/#list-remove"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9cce47fd": {"dfnID":"9cce47fd","dfnText":"sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-sequence"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-idl-sequence\u2460"},{"id":"ref-for-idl-sequence\u2461"},{"id":"ref-for-idl-sequence\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"a326add7": {"dfnID":"a326add7","dfnText":"contain (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-map-exists\u2460"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-map-exists\u2461"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-map-exists\u2462"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"a3b18719": {"dfnID":"a3b18719","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-set-append"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#set-append"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"3.2. Navigator Interface"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"a72449dd": {"dfnID":"a72449dd","dfnText":"in parallel","external":true,"refSections":[{"refs":[{"id":"ref-for-in-parallel"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"acfe060e": {"dfnID":"acfe060e","dfnText":"integer","external":true,"refSections":[{"refs":[{"id":"ref-for-integer"},{"id":"ref-for-integer\u2460"},{"id":"ref-for-integer\u2461"}],"title":"5. HTTP API"}],"url":"https://httpwg.org/specs/rfc9651#integer"},
"actions": {"dfnID":"actions","dfnText":"Actions","external":false,"refSections":[{"refs":[{"id":"ref-for-actions"},{"id":"ref-for-actions\u2460"},{"id":"ref-for-actions\u2461"}],"title":"1.1. Attribution"}],"url":"#actions"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"},{"id":"ref-for-list-contain\u2460"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-list-contain\u2461"},{"id":"ref-for-list-contain\u2462"},{"id":"ref-for-list-contain\u2463"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"aggregation-service": {"dfnID":"aggregation-service","dfnText":"aggregation service","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregation-service"}],"title":"1.1. Attribution"},{"refs":[{"id":"ref-for-aggregation-service\u2460"},{"id":"ref-for-aggregation-service\u2461"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-aggregation-service\u2462"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-aggregation-service\u2463"},{"id":"ref-for-aggregation-service\u2464"},{"id":"ref-for-aggregation-service\u2465"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-aggregation-service\u2466"},{"id":"ref-for-aggregation-service\u2467"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-aggregation-service\u2468"}],"title":"7.1.1. Prio and DAP"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u24ea"}],"title":"7.3. Anti-Replay Requirements"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u2460"},{"id":"ref-for-aggregation-service\u2460\u2461"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u2462"}],"title":"8.2. Privacy Budgets"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u2463"}],"title":"8.3. Differential Privacy Mechanisms"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u2464"}],"title":"9.1. Impression Store"},{"refs":[{"id":"ref-for-aggregation-service\u2460\u2465"},{"id":"ref-for-aggregation-service\u2460\u2466"}],"title":"10.3. Unconfigured Browsers"}],"url":"#aggregation-service"},
"attribution": {"dfnID":"attribution","dfnText":"attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-attribution"}],"title":"1.3. Goals"},{"refs":[{"id":"ref-for-attribution\u2460"},{"id":"ref-for-attribution\u2461"}],"title":"1.4. End-User Benefit"},{"refs":[{"id":"ref-for-attribution\u2462"}],"title":"1.6. Attribution Using Histograms"},{"refs":[{"id":"ref-for-attribution\u2463"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-attribution\u2464"}],"title":"4.1.2. Maintenance"}],"url":"#attribution"},
"attribution-logic": {"dfnID":"attribution-logic","dfnText":"attribution logic","external":false,"refSections":[{"refs":[{"id":"ref-for-attribution-logic"},{"id":"ref-for-attribution-logic\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-attribution-logic\u2461"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-attribution-logic\u2462"},{"id":"ref-for-attribution-logic\u2463"}],"title":"8.2.1. Privacy Budget Deduction"}],"url":"#attribution-logic"},
"b0d7f3c3": {"dfnID":"b0d7f3c3","dfnText":"USVString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-USVString"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-idl-USVString\u2460"},{"id":"ref-for-idl-USVString\u2461"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-idl-USVString\u2462"},{"id":"ref-for-idl-USVString\u2463"},{"id":"ref-for-idl-USVString\u2464"},{"id":"ref-for-idl-USVString\u2465"},{"id":"ref-for-idl-USVString\u2466"},{"id":"ref-for-idl-USVString\u2467"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"b17b90b8": {"dfnID":"b17b90b8","dfnText":"fingerprinting","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-browser-fingerprinting"}],"title":"10.2. Disabling the Private Attribution API"},{"refs":[{"id":"ref-for-dfn-browser-fingerprinting\u2460"}],"title":"10.3. Unconfigured Browsers"}],"url":"https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting"},
"b4f2d668": {"dfnID":"b4f2d668","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"},{"id":"ref-for-concept-origin\u2460"},{"id":"ref-for-concept-origin\u2461"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-concept-origin\u2462"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-concept-origin\u2463"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-concept-origin\u2464"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-concept-origin\u2465"}],"title":"8.1.2. Per-Site Limits"},{"refs":[{"id":"ref-for-concept-origin\u2466"}],"title":"10.5. Use in Third-party Contexts"}],"url":"https://html.spec.whatwg.org/#concept-origin"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"3.2. Navigator Interface"},{"refs":[{"id":"ref-for-SecureContext\u2460"},{"id":"ref-for-SecureContext\u2461"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-SecureContext\u2462"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-SecureContext\u2463"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"bb024394": {"dfnID":"bb024394","dfnText":"cross-context recognition","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-context-recognition"}],"title":"1.1. Attribution"}],"url":"https://w3ctag.github.io/privacy-principles/#cross-context-recognition"},
"bc9d7803": {"dfnID":"bc9d7803","dfnText":"registrable domain","external":true,"refSections":[{"refs":[{"id":"ref-for-host-registrable-domain"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-host-registrable-domain\u2460"},{"id":"ref-for-host-registrable-domain\u2461"}],"title":"4.1.4. Site Names"}],"url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"be0c27b2": {"dfnID":"be0c27b2","dfnText":"Navigator","external":true,"refSections":[{"refs":[{"id":"ref-for-navigator"},{"id":"ref-for-navigator\u2460"}],"title":"3.2. Navigator Interface"}],"url":"https://html.spec.whatwg.org/multipage/system-state.html#navigator"},
"be2d2b4c": {"dfnID":"be2d2b4c","dfnText":"SyntaxError","external":true,"refSections":[{"refs":[{"id":"ref-for-syntaxerror"}],"title":"4.3. Save Impression Algorithm"}],"url":"https://webidl.spec.whatwg.org/#syntaxerror"},
"c0f98cd7": {"dfnID":"c0f98cd7","dfnText":"ReferenceError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-referenceerror"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-referenceerror"},
"c3b2d08c": {"dfnID":"c3b2d08c","dfnText":"task source","external":true,"refSections":[{"refs":[{"id":"ref-for-task-source"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"c7061b41": {"dfnID":"c7061b41","dfnText":"site","external":true,"refSections":[{"refs":[{"id":"ref-for-site"}],"title":"1.1. Attribution"},{"refs":[{"id":"ref-for-site\u2460"},{"id":"ref-for-site\u2461"},{"id":"ref-for-site\u2462"},{"id":"ref-for-site\u2463"},{"id":"ref-for-site\u2464"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-site\u2465"},{"id":"ref-for-site\u2466"},{"id":"ref-for-site\u2467"},{"id":"ref-for-site\u2468"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-site\u2460\u24ea"},{"id":"ref-for-site\u2460\u2460"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-site\u2460\u2461"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-site\u2460\u2462"},{"id":"ref-for-site\u2460\u2463"},{"id":"ref-for-site\u2460\u2464"},{"id":"ref-for-site\u2460\u2465"},{"id":"ref-for-site\u2460\u2466"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-site\u2460\u2467"},{"id":"ref-for-site\u2460\u2468"},{"id":"ref-for-site\u2461\u24ea"},{"id":"ref-for-site\u2461\u2460"},{"id":"ref-for-site\u2461\u2461"},{"id":"ref-for-site\u2461\u2462"},{"id":"ref-for-site\u2461\u2463"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-site\u2461\u2464"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-site\u2461\u2465"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-site\u2461\u2466"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-site\u2461\u2467"}],"title":"8.1.2. Per-Site Limits"},{"refs":[{"id":"ref-for-site\u2461\u2468"}],"title":"8.2.2. Safety Limits"},{"refs":[{"id":"ref-for-site\u2462\u24ea"}],"title":"9.4. Combining Reports from Multiple Sites"},{"refs":[{"id":"ref-for-site\u2462\u2460"}],"title":"10.5. Use in Third-party Contexts"},{"refs":[{"id":"ref-for-site\u2462\u2461"},{"id":"ref-for-site\u2462\u2462"},{"id":"ref-for-site\u2462\u2463"}],"title":"10.6.1. Clearing Site Data"},{"refs":[{"id":"ref-for-site\u2462\u2464"},{"id":"ref-for-site\u2462\u2465"},{"id":"ref-for-site\u2462\u2466"},{"id":"ref-for-site\u2462\u2467"},{"id":"ref-for-site\u2462\u2468"},{"id":"ref-for-site\u2463\u24ea"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-site\u2463\u2460"}],"title":"10.6.3. Clearing Impressions"}],"url":"https://html.spec.whatwg.org/#site"},
"cc890cc1": {"dfnID":"cc890cc1","dfnText":"policy-controlled feature","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-controlled-feature"}],"title":"3.6. Permissions Policy Integration"}],"url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"},
"clear-impressions-for-a-conversion-site": {"dfnID":"clear-impressions-for-a-conversion-site","dfnText":"clear impressions for a conversion site","external":false,"refSections":[{"refs":[{"id":"ref-for-clear-impressions-for-a-conversion-site"}],"title":"4.1.3. Clear-Site-Data Integration"}],"url":"#clear-impressions-for-a-conversion-site"},
"common-matching-logic": {"dfnID":"common-matching-logic","dfnText":"common matching logic","external":false,"refSections":[{"refs":[{"id":"ref-for-common-matching-logic"},{"id":"ref-for-common-matching-logic\u2460"}],"title":"4.4.1. Attribution Logic"}],"url":"#common-matching-logic"},
"conversion": {"dfnID":"conversion","dfnText":"conversion","external":false,"refSections":[{"refs":[{"id":"ref-for-conversion"}],"title":"1.2. Background"},{"refs":[{"id":"ref-for-conversion\u2460"},{"id":"ref-for-conversion\u2461"},{"id":"ref-for-conversion\u2462"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-conversion\u2463"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-conversion\u2464"},{"id":"ref-for-conversion\u2465"},{"id":"ref-for-conversion\u2466"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-conversion\u2467"},{"id":"ref-for-conversion\u2468"},{"id":"ref-for-conversion\u2460\u24ea"},{"id":"ref-for-conversion\u2460\u2460"},{"id":"ref-for-conversion\u2460\u2461"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-conversion\u2460\u2462"}],"title":"6. Implementation Considerations"},{"refs":[{"id":"ref-for-conversion\u2460\u2463"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-conversion\u2460\u2464"}],"title":"8.1.3. Privacy Budget Epochs"}],"url":"#conversion"},
"conversion-report": {"dfnID":"conversion-report","dfnText":"conversion report","external":false,"refSections":[{"refs":[{"id":"ref-for-conversion-report"},{"id":"ref-for-conversion-report\u2460"},{"id":"ref-for-conversion-report\u2461"},{"id":"ref-for-conversion-report\u2462"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-conversion-report\u2463"},{"id":"ref-for-conversion-report\u2464"},{"id":"ref-for-conversion-report\u2465"},{"id":"ref-for-conversion-report\u2466"},{"id":"ref-for-conversion-report\u2467"},{"id":"ref-for-conversion-report\u2468"},{"id":"ref-for-conversion-report\u2460\u24ea"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2460"}],"title":"7.3. Anti-Replay Requirements"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2461"},{"id":"ref-for-conversion-report\u2460\u2462"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2463"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2464"}],"title":"8.2. Privacy Budgets"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2465"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2466"}],"title":"8.2.2. Safety Limits"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2467"}],"title":"9.1. Impression Store"},{"refs":[{"id":"ref-for-conversion-report\u2460\u2468"}],"title":"9.2. API Implementation"},{"refs":[{"id":"ref-for-conversion-report\u2461\u24ea"}],"title":"9.3. Aggregation Services"},{"refs":[{"id":"ref-for-conversion-report\u2461\u2460"}],"title":"9.5. Ad Fraud"},{"refs":[{"id":"ref-for-conversion-report\u2461\u2461"}],"title":"10.2. Disabling the Private Attribution API"},{"refs":[{"id":"ref-for-conversion-report\u2461\u2462"},{"id":"ref-for-conversion-report\u2461\u2463"},{"id":"ref-for-conversion-report\u2461\u2464"}],"title":"10.4. Including Identifying Information with Saved Impressions"}],"url":"#conversion-report"},
"conversion-site": {"dfnID":"conversion-site","dfnText":"conversion site","external":false,"refSections":[{"refs":[{"id":"ref-for-conversion-site"},{"id":"ref-for-conversion-site\u2460"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-conversion-site\u2461"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-conversion-site\u2462"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-conversion-site\u2463"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-conversion-site\u2464"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-conversion-site\u2465"}],"title":"6. Implementation Considerations"},{"refs":[{"id":"ref-for-conversion-site\u2466"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-conversion-site\u2467"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-conversion-site\u2468"},{"id":"ref-for-conversion-site\u2460\u24ea"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-conversion-site\u2460\u2460"}],"title":"10.1. Information Exposed by the Private Attribution API"},{"refs":[{"id":"ref-for-conversion-site\u2460\u2461"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-conversion-site\u2460\u2462"}],"title":"10.6.3. Clearing Impressions"}],"url":"#conversion-site"},
"conversion-value": {"dfnID":"conversion-value","dfnText":"conversion value","external":false,"refSections":[{"refs":[{"id":"ref-for-conversion-value"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-conversion-value\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-conversion-value\u2461"},{"id":"ref-for-conversion-value\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-conversion-value\u2463"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-conversion-value\u2464"},{"id":"ref-for-conversion-value\u2465"},{"id":"ref-for-conversion-value\u2466"}],"title":"9.2. API Implementation"},{"refs":[{"id":"ref-for-conversion-value\u2467"}],"title":"10.2. Disabling the Private Attribution API"}],"url":"#conversion-value"},
"create-an-all-zero-histogram": {"dfnID":"create-an-all-zero-histogram","dfnText":"create an all-zero histogram","external":false,"refSections":[{"refs":[{"id":"ref-for-create-an-all-zero-histogram"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-create-an-all-zero-histogram\u2460"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-create-an-all-zero-histogram\u2461"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"#create-an-all-zero-histogram"},
"d0b4a948": {"dfnID":"d0b4a948","dfnText":"a promise rejected with","external":true,"refSections":[{"refs":[{"id":"ref-for-a-promise-rejected-with"},{"id":"ref-for-a-promise-rejected-with\u2460"},{"id":"ref-for-a-promise-rejected-with\u2461"},{"id":"ref-for-a-promise-rejected-with\u2462"},{"id":"ref-for-a-promise-rejected-with\u2463"},{"id":"ref-for-a-promise-rejected-with\u2464"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"d14a6f26": {"dfnID":"d14a6f26","dfnText":"key","external":true,"refSections":[{"refs":[{"id":"ref-for-map-key"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://infra.spec.whatwg.org/#map-key"},
"d17867da": {"dfnID":"d17867da","dfnText":"32-bit unsigned integer","external":true,"refSections":[{"refs":[{"id":"ref-for-32-bit-unsigned-integer"},{"id":"ref-for-32-bit-unsigned-integer\u2460"}],"title":"4.2.1. Privacy Budget Store"}],"url":"https://infra.spec.whatwg.org/#32-bit-unsigned-integer"},
"dacde8b5": {"dfnID":"dacde8b5","dfnText":"a new promise","external":true,"refSections":[{"refs":[{"id":"ref-for-a-new-promise"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"day": {"dfnID":"day","dfnText":"day","external":false,"refSections":[{"refs":[{"id":"ref-for-day"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-day\u2460"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#day"},
"de07e6f6": {"dfnID":"de07e6f6","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string\u2461"}],"title":"5. HTTP API"}],"url":"https://httpwg.org/specs/rfc9651#string"},
"deduct-privacy-budget": {"dfnID":"deduct-privacy-budget","dfnText":"deduct privacy budget","external":false,"refSections":[{"refs":[{"id":"ref-for-deduct-privacy-budget"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-deduct-privacy-budget\u2460"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-deduct-privacy-budget\u2461"},{"id":"ref-for-deduct-privacy-budget\u2462"}],"title":"8.2.1. Privacy Budget Deduction"}],"url":"#deduct-privacy-budget"},
"dictdef-privateattributionaggregationservice": {"dfnID":"dictdef-privateattributionaggregationservice","dfnText":"PrivateAttributionAggregationService","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-privateattributionaggregationservice"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#dictdef-privateattributionaggregationservice"},
"dictdef-privateattributionconversionoptions": {"dfnID":"dictdef-privateattributionconversionoptions","dfnText":"PrivateAttributionConversionOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-privateattributionconversionoptions"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-dictdef-privateattributionconversionoptions\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dictdef-privateattributionconversionoptions\u2461"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-dictdef-privateattributionconversionoptions\u2462"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#dictdef-privateattributionconversionoptions"},
"dictdef-privateattributionconversionresult": {"dfnID":"dictdef-privateattributionconversionresult","dfnText":"PrivateAttributionConversionResult","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-privateattributionconversionresult"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"#dictdef-privateattributionconversionresult"},
"dictdef-privateattributionimpressionoptions": {"dfnID":"dictdef-privateattributionimpressionoptions","dfnText":"PrivateAttributionImpressionOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-privateattributionimpressionoptions"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dictdef-privateattributionimpressionoptions\u2460"}],"title":"5. HTTP API"}],"url":"#dictdef-privateattributionimpressionoptions"},
"differential-privacy": {"dfnID":"differential-privacy","dfnText":"Differential privacy","external":false,"refSections":[{"refs":[{"id":"ref-for-differential-privacy"}],"title":"8. Differential Privacy"}],"url":"#differential-privacy"},
"do-attribution-and-fill-a-histogram": {"dfnID":"do-attribution-and-fill-a-histogram","dfnText":"do attribution and fill a histogram","external":false,"refSections":[{"refs":[{"id":"ref-for-do-attribution-and-fill-a-histogram"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"#do-attribution-and-fill-a-histogram"},
"dom-navigator-privateattribution": {"dfnID":"dom-navigator-privateattribution","dfnText":"privateAttribution","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-navigator-privateattribution"}],"title":"3.2. Navigator Interface"}],"url":"#dom-navigator-privateattribution"},
"dom-permissionpolicy-measure-conversion": {"dfnID":"dom-permissionpolicy-measure-conversion","dfnText":"measure-conversion","external":false,"refSections":[],"url":"#dom-permissionpolicy-measure-conversion"},
"dom-permissionpolicy-save-impression": {"dfnID":"dom-permissionpolicy-save-impression","dfnText":"save-impression","external":false,"refSections":[],"url":"#dom-permissionpolicy-save-impression"},
"dom-privateattribution-aggregationservices": {"dfnID":"dom-privateattribution-aggregationservices","dfnText":"aggregationServices","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattribution-aggregationservices"},{"id":"ref-for-dom-privateattribution-aggregationservices\u2460"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-dom-privateattribution-aggregationservices\u2461"},{"id":"ref-for-dom-privateattribution-aggregationservices\u2462"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-dom-privateattribution-aggregationservices\u2463"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattribution-aggregationservices\u2464"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"#dom-privateattribution-aggregationservices"},
"dom-privateattribution-measureconversion": {"dfnID":"dom-privateattribution-measureconversion","dfnText":"measureConversion(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460"},{"id":"ref-for-dom-privateattribution-measureconversion\u2461"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2462"},{"id":"ref-for-dom-privateattribution-measureconversion\u2463"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2464"},{"id":"ref-for-dom-privateattribution-measureconversion\u2465"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2466"},{"id":"ref-for-dom-privateattribution-measureconversion\u2467"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2468"},{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u24ea"},{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2460"},{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2461"},{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2463"},{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2464"}],"title":"3.6. Permissions Policy Integration"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2465"}],"title":"4.1. Impression Store"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2466"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2467"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2460\u2468"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u24ea"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2460"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2461"}],"title":"9.2. API Implementation"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2462"}],"title":"9.3. Aggregation Services"},{"refs":[{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2463"},{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2464"},{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2465"},{"id":"ref-for-dom-privateattribution-measureconversion\u2461\u2466"}],"title":"10.3. Unconfigured Browsers"}],"url":"#dom-privateattribution-measureconversion"},
"dom-privateattribution-measureconversion-options-options": {"dfnID":"dom-privateattribution-measureconversion-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-privateattribution-measureconversion-options-options"},
"dom-privateattribution-saveimpression": {"dfnID":"dom-privateattribution-saveimpression","dfnText":"saveImpression(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2460"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2461"},{"id":"ref-for-dom-privateattribution-saveimpression\u2462"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2463"},{"id":"ref-for-dom-privateattribution-saveimpression\u2464"},{"id":"ref-for-dom-privateattribution-saveimpression\u2465"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2466"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2467"},{"id":"ref-for-dom-privateattribution-saveimpression\u2468"}],"title":"3.6. Permissions Policy Integration"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u24ea"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2460"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2461"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2462"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2463"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2464"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2465"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2466"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2467"},{"id":"ref-for-dom-privateattribution-saveimpression\u2460\u2468"}],"title":"5. HTTP API"},{"refs":[{"id":"ref-for-dom-privateattribution-saveimpression\u2461\u24ea"}],"title":"10.5. Use in Third-party Contexts"}],"url":"#dom-privateattribution-saveimpression"},
"dom-privateattribution-saveimpression-options-options": {"dfnID":"dom-privateattribution-saveimpression-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-privateattribution-saveimpression-options-options"},
"dom-privateattributionaggregationservice-protocol": {"dfnID":"dom-privateattributionaggregationservice-protocol","dfnText":"protocol","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionaggregationservice-protocol"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#dom-privateattributionaggregationservice-protocol"},
"dom-privateattributionconversionoptions-aggregationservice": {"dfnID":"dom-privateattributionconversionoptions-aggregationservice","dfnText":"aggregationService","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-aggregationservice"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-aggregationservice\u2460"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-aggregationservice\u2461"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-aggregationservice\u2462"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"#dom-privateattributionconversionoptions-aggregationservice"},
"dom-privateattributionconversionoptions-epsilon": {"dfnID":"dom-privateattributionconversionoptions-epsilon","dfnText":"epsilon","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-epsilon"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-epsilon\u2460"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-epsilon\u2461"}],"title":"4.4.1. Attribution Logic"}],"url":"#dom-privateattributionconversionoptions-epsilon"},
"dom-privateattributionconversionoptions-histogramsize": {"dfnID":"dom-privateattributionconversionoptions-histogramsize","dfnText":"histogramSize","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-histogramsize"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-histogramsize\u2460"},{"id":"ref-for-dom-privateattributionconversionoptions-histogramsize\u2461"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-histogramsize\u2462"},{"id":"ref-for-dom-privateattributionconversionoptions-histogramsize\u2463"}],"title":"4.4.1. Attribution Logic"}],"url":"#dom-privateattributionconversionoptions-histogramsize"},
"dom-privateattributionconversionoptions-impressionsites": {"dfnID":"dom-privateattributionconversionoptions-impressionsites","dfnText":"impressionSites","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-impressionsites"},{"id":"ref-for-dom-privateattributionconversionoptions-impressionsites\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-impressionsites\u2461"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#dom-privateattributionconversionoptions-impressionsites"},
"dom-privateattributionconversionoptions-intermediarysites": {"dfnID":"dom-privateattributionconversionoptions-intermediarysites","dfnText":"intermediarySites","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-intermediarysites"},{"id":"ref-for-dom-privateattributionconversionoptions-intermediarysites\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"#dom-privateattributionconversionoptions-intermediarysites"},
"dom-privateattributionconversionoptions-logic": {"dfnID":"dom-privateattributionconversionoptions-logic","dfnText":"logic","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-logic"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-logic\u2460"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-logic\u2461"},{"id":"ref-for-dom-privateattributionconversionoptions-logic\u2462"}],"title":"4.4.1. Attribution Logic"}],"url":"#dom-privateattributionconversionoptions-logic"},
"dom-privateattributionconversionoptions-lookbackdays": {"dfnID":"dom-privateattributionconversionoptions-lookbackdays","dfnText":"lookbackDays","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-lookbackdays"},{"id":"ref-for-dom-privateattributionconversionoptions-lookbackdays\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-lookbackdays\u2461"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-lookbackdays\u2462"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#dom-privateattributionconversionoptions-lookbackdays"},
"dom-privateattributionconversionoptions-matchvalue": {"dfnID":"dom-privateattributionconversionoptions-matchvalue","dfnText":"matchValue","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-matchvalue"},{"id":"ref-for-dom-privateattributionconversionoptions-matchvalue\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-matchvalue\u2461"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#dom-privateattributionconversionoptions-matchvalue"},
"dom-privateattributionconversionoptions-maxvalue": {"dfnID":"dom-privateattributionconversionoptions-maxvalue","dfnText":"maxValue","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2460"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2461"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2462"},{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2463"},{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2464"},{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2465"},{"id":"ref-for-dom-privateattributionconversionoptions-maxvalue\u2466"}],"title":"7.1.1. Prio and DAP"}],"url":"#dom-privateattributionconversionoptions-maxvalue"},
"dom-privateattributionconversionoptions-value": {"dfnID":"dom-privateattributionconversionoptions-value","dfnText":"value","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-value"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-value\u2460"},{"id":"ref-for-dom-privateattributionconversionoptions-value\u2461"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionconversionoptions-value\u2462"},{"id":"ref-for-dom-privateattributionconversionoptions-value\u2463"}],"title":"4.4.1. Attribution Logic"}],"url":"#dom-privateattributionconversionoptions-value"},
"dom-privateattributionconversionresult-report": {"dfnID":"dom-privateattributionconversionresult-report","dfnText":"report","external":false,"refSections":[],"url":"#dom-privateattributionconversionresult-report"},
"dom-privateattributionimpressionoptions-conversionsites": {"dfnID":"dom-privateattributionimpressionoptions-conversionsites","dfnText":"conversionSites","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-conversionsites"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-conversionsites\u2460"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-conversionsites\u2461"}],"title":"5. HTTP API"}],"url":"#dom-privateattributionimpressionoptions-conversionsites"},
"dom-privateattributionimpressionoptions-histogramindex": {"dfnID":"dom-privateattributionimpressionoptions-histogramindex","dfnText":"histogramIndex","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-histogramindex"},{"id":"ref-for-dom-privateattributionimpressionoptions-histogramindex\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-histogramindex\u2461"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-histogramindex\u2462"}],"title":"5. HTTP API"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-histogramindex\u2463"}],"title":"9.2. API Implementation"}],"url":"#dom-privateattributionimpressionoptions-histogramindex"},
"dom-privateattributionimpressionoptions-lifetimedays": {"dfnID":"dom-privateattributionimpressionoptions-lifetimedays","dfnText":"lifetimeDays","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays"},{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2461"},{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2462"},{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2463"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2464"}],"title":"5. HTTP API"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-lifetimedays\u2465"}],"title":"9.1. Impression Store"}],"url":"#dom-privateattributionimpressionoptions-lifetimedays"},
"dom-privateattributionimpressionoptions-matchvalue": {"dfnID":"dom-privateattributionimpressionoptions-matchvalue","dfnText":"matchValue","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue"},{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue\u2461"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue\u2462"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue\u2463"}],"title":"5. HTTP API"},{"refs":[{"id":"ref-for-dom-privateattributionimpressionoptions-matchvalue\u2464"}],"title":"10.4. Including Identifying Information with Saved Impressions"}],"url":"#dom-privateattributionimpressionoptions-matchvalue"},
"dom-privateattributionlogic-last-touch": {"dfnID":"dom-privateattributionlogic-last-touch","dfnText":"\"last-touch\"","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionlogic-last-touch"}],"title":"4.4. Measure Conversion Algorithm"},{"refs":[{"id":"ref-for-dom-privateattributionlogic-last-touch\u2460"}],"title":"4.4.1. Attribution Logic"}],"url":"#dom-privateattributionlogic-last-touch"},
"dom-privateattributionprotocol-dap-12-histogram": {"dfnID":"dom-privateattributionprotocol-dap-12-histogram","dfnText":"dap-12-histogram","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionprotocol-dap-12-histogram"}],"title":"3.3. Finding a Supported Aggregation Service"},{"refs":[{"id":"ref-for-dom-privateattributionprotocol-dap-12-histogram\u2460"}],"title":"7.1.1. Prio and DAP"}],"url":"#dom-privateattributionprotocol-dap-12-histogram"},
"dom-privateattributionprotocol-tee-00": {"dfnID":"dom-privateattributionprotocol-tee-00","dfnText":"tee-00","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateattributionprotocol-tee-00"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#dom-privateattributionprotocol-tee-00"},
"e539dd89": {"dfnID":"e539dd89","dfnText":"inner list","external":true,"refSections":[{"refs":[{"id":"ref-for-inner-list"}],"title":"5. HTTP API"}],"url":"https://httpwg.org/specs/rfc9651#inner-list"},
"e97a9688": {"dfnID":"e97a9688","dfnText":"unsigned long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-long"},{"id":"ref-for-idl-unsigned-long\u2460"},{"id":"ref-for-idl-unsigned-long\u2461"},{"id":"ref-for-idl-unsigned-long\u2462"},{"id":"ref-for-idl-unsigned-long\u2463"},{"id":"ref-for-idl-unsigned-long\u2464"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-idl-unsigned-long\u2465"},{"id":"ref-for-idl-unsigned-long\u2466"},{"id":"ref-for-idl-unsigned-long\u2467"},{"id":"ref-for-idl-unsigned-long\u2468"},{"id":"ref-for-idl-unsigned-long\u2460\u24ea"},{"id":"ref-for-idl-unsigned-long\u2460\u2460"},{"id":"ref-for-idl-unsigned-long\u2460\u2461"},{"id":"ref-for-idl-unsigned-long\u2460\u2462"},{"id":"ref-for-idl-unsigned-long\u2460\u2463"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-long"},
"ec878a66": {"dfnID":"ec878a66","dfnText":"RangeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-rangeerror"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-exceptiondef-rangeerror\u2460"},{"id":"ref-for-exceptiondef-rangeerror\u2461"},{"id":"ref-for-exceptiondef-rangeerror\u2462"},{"id":"ref-for-exceptiondef-rangeerror\u2463"},{"id":"ref-for-exceptiondef-rangeerror\u2464"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"eea18c0d": {"dfnID":"eea18c0d","dfnText":"domain label","external":true,"refSections":[{"refs":[{"id":"ref-for-domain-label"}],"title":"4.1.4. Site Names"}],"url":"https://url.spec.whatwg.org/#domain-label"},
"enumdef-privateattributionlogic": {"dfnID":"enumdef-privateattributionlogic","dfnText":"PrivateAttributionLogic","external":false,"refSections":[{"refs":[{"id":"ref-for-enumdef-privateattributionlogic"},{"id":"ref-for-enumdef-privateattributionlogic\u2460"},{"id":"ref-for-enumdef-privateattributionlogic\u2461"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"#enumdef-privateattributionlogic"},
"enumdef-privateattributionprotocol": {"dfnID":"enumdef-privateattributionprotocol","dfnText":"PrivateAttributionProtocol","external":false,"refSections":[{"refs":[{"id":"ref-for-enumdef-privateattributionprotocol"},{"id":"ref-for-enumdef-privateattributionprotocol\u2460"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#enumdef-privateattributionprotocol"},
"epoch-index": {"dfnID":"epoch-index","dfnText":"epoch index","external":false,"refSections":[{"refs":[{"id":"ref-for-epoch-index"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-epoch-index\u2460"},{"id":"ref-for-epoch-index\u2461"},{"id":"ref-for-epoch-index\u2462"},{"id":"ref-for-epoch-index\u2463"},{"id":"ref-for-epoch-index\u2464"},{"id":"ref-for-epoch-index\u2465"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-epoch-index\u2466"},{"id":"ref-for-epoch-index\u2467"},{"id":"ref-for-epoch-index\u2468"},{"id":"ref-for-epoch-index\u2460\u24ea"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-epoch-index\u2460\u2460"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"#epoch-index"},
"epoch-start-store": {"dfnID":"epoch-start-store","dfnText":"epoch start store","external":false,"refSections":[{"refs":[{"id":"ref-for-epoch-start-store"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-epoch-start-store\u2460"},{"id":"ref-for-epoch-start-store\u2461"},{"id":"ref-for-epoch-start-store\u2462"},{"id":"ref-for-epoch-start-store\u2463"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-epoch-start-store\u2464"},{"id":"ref-for-epoch-start-store\u2465"},{"id":"ref-for-epoch-start-store\u2466"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-epoch-start-store\u2467"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-epoch-start-store\u2468"}],"title":"10.6.1. Clearing Site Data"},{"refs":[{"id":"ref-for-epoch-start-store\u2460\u24ea"},{"id":"ref-for-epoch-start-store\u2460\u2460"}],"title":"10.6.2. Clearing Browsing History"}],"url":"#epoch-start-store"},
"f02cd417": {"dfnID":"f02cd417","dfnText":"iterate","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-list-iterate\u2460"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"f16ee824": {"dfnID":"f16ee824","dfnText":"current wall time","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-eso-current-wall-time"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-dfn-eso-current-wall-time\u2460"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time"},
"f23dc013": {"dfnID":"f23dc013","dfnText":"child navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-child-navigable\u2460"}],"title":"3.4. Saving Impressions"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable"},
"f40a11c6": {"dfnID":"f40a11c6","dfnText":"dictionary","external":true,"refSections":[{"refs":[{"id":"ref-for-dictionary"}],"title":"5. HTTP API"}],"url":"https://httpwg.org/specs/rfc9651#dictionary"},
"f8802320": {"dfnID":"f8802320","dfnText":"extend","external":true,"refSections":[{"refs":[{"id":"ref-for-set-extend"}],"title":"4.4.1. Attribution Logic"}],"url":"https://infra.spec.whatwg.org/#set-extend"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"},{"id":"ref-for-iteration-continue\u2460"},{"id":"ref-for-iteration-continue\u2461"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-iteration-continue\u2462"},{"id":"ref-for-iteration-continue\u2463"},{"id":"ref-for-iteration-continue\u2464"},{"id":"ref-for-iteration-continue\u2465"}],"title":"4.4.2. Common Impression Matching Logic"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fill-a-histogram-with-last-touch-attribution": {"dfnID":"fill-a-histogram-with-last-touch-attribution","dfnText":"fill a histogram with last-touch attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-fill-a-histogram-with-last-touch-attribution"}],"title":"4.4.1. Attribution Logic"}],"url":"#fill-a-histogram-with-last-touch-attribution"},
"get-the-current-epoch": {"dfnID":"get-the-current-epoch","dfnText":"get the current epoch","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-current-epoch"},{"id":"ref-for-get-the-current-epoch\u2460"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-get-the-current-epoch\u2461"},{"id":"ref-for-get-the-current-epoch\u2462"},{"id":"ref-for-get-the-current-epoch\u2463"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-get-the-current-epoch\u2464"}],"title":"4.4.1. Attribution Logic"}],"url":"#get-the-current-epoch"},
"get-the-starting-epoch-for-attribution": {"dfnID":"get-the-starting-epoch-for-attribution","dfnText":"get the starting epoch for attribution","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-starting-epoch-for-attribution"}],"title":"4.4.1. Attribution Logic"},{"refs":[{"id":"ref-for-get-the-starting-epoch-for-attribution\u2460"}],"title":"10.6.2. Clearing Browsing History"}],"url":"#get-the-starting-epoch-for-attribution"},
"http-headerdef-save-impression": {"dfnID":"http-headerdef-save-impression","dfnText":"Save-Impression","external":false,"refSections":[{"refs":[{"id":"ref-for-http-headerdef-save-impression"}],"title":"3. API Usage"}],"url":"#http-headerdef-save-impression"},
"impression": {"dfnID":"impression","dfnText":"impressions","external":false,"refSections":[{"refs":[{"id":"ref-for-impression"}],"title":"1.6. Attribution Using Histograms"},{"refs":[{"id":"ref-for-impression\u2460"},{"id":"ref-for-impression\u2461"},{"id":"ref-for-impression\u2462"},{"id":"ref-for-impression\u2463"},{"id":"ref-for-impression\u2464"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-impression\u2465"}],"title":"3. API Usage"},{"refs":[{"id":"ref-for-impression\u2466"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-impression\u2467"},{"id":"ref-for-impression\u2468"},{"id":"ref-for-impression\u2460\u24ea"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-impression\u2460\u2460"},{"id":"ref-for-impression\u2460\u2461"},{"id":"ref-for-impression\u2460\u2462"},{"id":"ref-for-impression\u2460\u2463"},{"id":"ref-for-impression\u2460\u2464"},{"id":"ref-for-impression\u2460\u2465"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-impression\u2460\u2466"}],"title":"4.1. Impression Store"},{"refs":[{"id":"ref-for-impression\u2460\u2467"},{"id":"ref-for-impression\u2460\u2468"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-impression\u2461\u24ea"},{"id":"ref-for-impression\u2461\u2460"},{"id":"ref-for-impression\u2461\u2461"},{"id":"ref-for-impression\u2461\u2462"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-impression\u2461\u2463"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-impression\u2461\u2464"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression\u2461\u2465"}],"title":"4.4.2.1. Last-Touch Attribution"},{"refs":[{"id":"ref-for-impression\u2461\u2466"}],"title":"6. Implementation Considerations"},{"refs":[{"id":"ref-for-impression\u2461\u2467"},{"id":"ref-for-impression\u2461\u2468"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-impression\u2462\u24ea"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-impression\u2462\u2460"},{"id":"ref-for-impression\u2462\u2461"},{"id":"ref-for-impression\u2462\u2462"},{"id":"ref-for-impression\u2462\u2463"},{"id":"ref-for-impression\u2462\u2464"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-impression\u2462\u2465"},{"id":"ref-for-impression\u2462\u2466"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-impression\u2462\u2467"}],"title":"9.4. Combining Reports from Multiple Sites"},{"refs":[{"id":"ref-for-impression\u2462\u2468"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-impression\u2463\u24ea"},{"id":"ref-for-impression\u2463\u2460"},{"id":"ref-for-impression\u2463\u2461"}],"title":"10.6.3. Clearing Impressions"},{"refs":[{"id":"ref-for-impression\u2463\u2462"}],"title":"10.7. Choice of Clock"}],"url":"#impression"},
"impression-conversion-sites": {"dfnID":"impression-conversion-sites","dfnText":"Conversion Sites","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-conversion-sites"},{"id":"ref-for-impression-conversion-sites\u2460"},{"id":"ref-for-impression-conversion-sites\u2461"},{"id":"ref-for-impression-conversion-sites\u2462"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-impression-conversion-sites\u2463"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-impression-conversion-sites\u2464"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-conversion-sites\u2465"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-impression-conversion-sites\u2466"}],"title":"5. HTTP API"},{"refs":[{"id":"ref-for-impression-conversion-sites\u2467"}],"title":"10.6.3. Clearing Impressions"}],"url":"#impression-conversion-sites"},
"impression-histogram-index": {"dfnID":"impression-histogram-index","dfnText":"Histogram Index","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-histogram-index"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-histogram-index\u2460"}],"title":"4.4.2.1. Last-Touch Attribution"},{"refs":[{"id":"ref-for-impression-histogram-index\u2461"}],"title":"6. Implementation Considerations"},{"refs":[{"id":"ref-for-impression-histogram-index\u2462"}],"title":"9.5. Ad Fraud"}],"url":"#impression-histogram-index"},
"impression-impression-site": {"dfnID":"impression-impression-site","dfnText":"Impression Site","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-impression-site"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-impression-impression-site\u2460"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-impression-site\u2461"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-impression-impression-site\u2462"}],"title":"10.6.3. Clearing Impressions"}],"url":"#impression-impression-site"},
"impression-intermediary-site": {"dfnID":"impression-intermediary-site","dfnText":"Intermediary Site","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-intermediary-site"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-impression-intermediary-site\u2460"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-impression-intermediary-site\u2461"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-intermediary-site\u2462"}],"title":"10.6.3. Clearing Impressions"}],"url":"#impression-intermediary-site"},
"impression-lifetime": {"dfnID":"impression-lifetime","dfnText":"Lifetime","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-lifetime"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-impression-lifetime\u2460"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-lifetime\u2461"}],"title":"5. HTTP API"}],"url":"#impression-lifetime"},
"impression-match-value": {"dfnID":"impression-match-value","dfnText":"Match Value","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-match-value"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-match-value\u2460"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-impression-match-value\u2461"}],"title":"5. HTTP API"}],"url":"#impression-match-value"},
"impression-site": {"dfnID":"impression-site","dfnText":"impression site","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-site"},{"id":"ref-for-impression-site\u2460"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-impression-site\u2461"},{"id":"ref-for-impression-site\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-impression-site\u2463"},{"id":"ref-for-impression-site\u2464"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-impression-site\u2465"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-site\u2466"}],"title":"6. Implementation Considerations"},{"refs":[{"id":"ref-for-impression-site\u2467"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-impression-site\u2468"}],"title":"10.6.3. Clearing Impressions"}],"url":"#impression-site"},
"impression-store": {"dfnID":"impression-store","dfnText":"impression store","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-store"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-impression-store\u2460"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-impression-store\u2461"}],"title":"4.1. Impression Store"},{"refs":[{"id":"ref-for-impression-store\u2462"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-impression-store\u2463"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-impression-store\u2464"},{"id":"ref-for-impression-store\u2465"},{"id":"ref-for-impression-store\u2466"}],"title":"4.1.3. Clear-Site-Data Integration"},{"refs":[{"id":"ref-for-impression-store\u2467"}],"title":"4.1.4. Site Names"},{"refs":[{"id":"ref-for-impression-store\u2468"},{"id":"ref-for-impression-store\u2460\u24ea"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-impression-store\u2460\u2460"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-impression-store\u2460\u2461"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-store\u2460\u2462"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-impression-store\u2460\u2463"}],"title":"9.1. Impression Store"},{"refs":[{"id":"ref-for-impression-store\u2460\u2464"},{"id":"ref-for-impression-store\u2460\u2465"}],"title":"10.1. Information Exposed by the Private Attribution API"},{"refs":[{"id":"ref-for-impression-store\u2460\u2466"}],"title":"10.4. Including Identifying Information with Saved Impressions"},{"refs":[{"id":"ref-for-impression-store\u2460\u2467"},{"id":"ref-for-impression-store\u2460\u2468"}],"title":"10.6.3. Clearing Impressions"}],"url":"#impression-store"},
"impression-timestamp": {"dfnID":"impression-timestamp","dfnText":"Timestamp","external":false,"refSections":[{"refs":[{"id":"ref-for-impression-timestamp"}],"title":"4.1.2. Maintenance"},{"refs":[{"id":"ref-for-impression-timestamp\u2460"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-impression-timestamp\u2461"}],"title":"4.4.2. Common Impression Matching Logic"},{"refs":[{"id":"ref-for-impression-timestamp\u2462"}],"title":"4.4.2.1. Last-Touch Attribution"}],"url":"#impression-timestamp"},
"individual-differential-privacy": {"dfnID":"individual-differential-privacy","dfnText":"individual differential privacy","external":false,"refSections":[{"refs":[{"id":"ref-for-individual-differential-privacy"}],"title":"8. Differential Privacy"}],"url":"#individual-differential-privacy"},
"intermediary-site": {"dfnID":"intermediary-site","dfnText":"intermediary site","external":false,"refSections":[{"refs":[{"id":"ref-for-intermediary-site"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-intermediary-site\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-intermediary-site\u2461"},{"id":"ref-for-intermediary-site\u2462"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-intermediary-site\u2463"}],"title":"4.1.1. Contents"},{"refs":[{"id":"ref-for-intermediary-site\u2464"}],"title":"4.3. Save Impression Algorithm"},{"refs":[{"id":"ref-for-intermediary-site\u2465"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"#intermediary-site"},
"last-browsing-history-clear": {"dfnID":"last-browsing-history-clear","dfnText":"last browsing history clear","external":false,"refSections":[{"refs":[{"id":"ref-for-last-browsing-history-clear"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-last-browsing-history-clear\u2460"},{"id":"ref-for-last-browsing-history-clear\u2461"},{"id":"ref-for-last-browsing-history-clear\u2462"},{"id":"ref-for-last-browsing-history-clear\u2463"},{"id":"ref-for-last-browsing-history-clear\u2464"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-last-browsing-history-clear\u2465"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-last-browsing-history-clear\u2466"}],"title":"10.6.2. Clearing Browsing History"}],"url":"#last-browsing-history-clear"},
"microepsilon": {"dfnID":"microepsilon","dfnText":"microepsilon","external":false,"refSections":[{"refs":[{"id":"ref-for-microepsilon"}],"title":"4.2.1. Privacy Budget Store"}],"url":"#microepsilon"},
"mpc": {"dfnID":"mpc","dfnText":"Multi-Party Computation (MPC)","external":false,"refSections":[{"refs":[{"id":"ref-for-mpc"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#mpc"},
"outcomes": {"dfnID":"outcomes","dfnText":"outcomes","external":false,"refSections":[{"refs":[{"id":"ref-for-outcomes"},{"id":"ref-for-outcomes\u2460"}],"title":"1.1. Attribution"},{"refs":[{"id":"ref-for-outcomes\u2461"}],"title":"1.6. Attribution Using Histograms"},{"refs":[{"id":"ref-for-outcomes\u2462"}],"title":"2. Overview of Operation"}],"url":"#outcomes"},
"parse-a-site": {"dfnID":"parse-a-site","dfnText":"parse a site","external":false,"refSections":[{"refs":[{"id":"ref-for-parse-a-site"}],"title":"4.3. Save Impression Algorithm"}],"url":"#parse-a-site"},
"prio3l1boundsum": {"dfnID":"prio3l1boundsum","dfnText":"Prio3L1BoundSum","external":false,"refSections":[{"refs":[{"id":"ref-for-prio3l1boundsum"},{"id":"ref-for-prio3l1boundsum\u2460"},{"id":"ref-for-prio3l1boundsum\u2461"}],"title":"7.1.1. Prio and DAP"}],"url":"#prio3l1boundsum"},
"privacy-budget-epoch": {"dfnID":"privacy-budget-epoch","dfnText":"privacy budget epoch","external":false,"refSections":[{"refs":[{"id":"ref-for-privacy-budget-epoch"},{"id":"ref-for-privacy-budget-epoch\u2460"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2461"},{"id":"ref-for-privacy-budget-epoch\u2462"},{"id":"ref-for-privacy-budget-epoch\u2463"},{"id":"ref-for-privacy-budget-epoch\u2464"},{"id":"ref-for-privacy-budget-epoch\u2465"},{"id":"ref-for-privacy-budget-epoch\u2466"},{"id":"ref-for-privacy-budget-epoch\u2467"},{"id":"ref-for-privacy-budget-epoch\u2468"},{"id":"ref-for-privacy-budget-epoch\u2460\u24ea"},{"id":"ref-for-privacy-budget-epoch\u2460\u2460"},{"id":"ref-for-privacy-budget-epoch\u2460\u2461"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2460\u2462"},{"id":"ref-for-privacy-budget-epoch\u2460\u2463"},{"id":"ref-for-privacy-budget-epoch\u2460\u2464"},{"id":"ref-for-privacy-budget-epoch\u2460\u2465"},{"id":"ref-for-privacy-budget-epoch\u2460\u2466"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2460\u2467"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2460\u2468"},{"id":"ref-for-privacy-budget-epoch\u2461\u24ea"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2461\u2460"},{"id":"ref-for-privacy-budget-epoch\u2461\u2461"},{"id":"ref-for-privacy-budget-epoch\u2461\u2462"},{"id":"ref-for-privacy-budget-epoch\u2461\u2463"},{"id":"ref-for-privacy-budget-epoch\u2461\u2464"},{"id":"ref-for-privacy-budget-epoch\u2461\u2465"},{"id":"ref-for-privacy-budget-epoch\u2461\u2466"},{"id":"ref-for-privacy-budget-epoch\u2461\u2467"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2461\u2468"},{"id":"ref-for-privacy-budget-epoch\u2462\u24ea"},{"id":"ref-for-privacy-budget-epoch\u2462\u2460"},{"id":"ref-for-privacy-budget-epoch\u2462\u2461"},{"id":"ref-for-privacy-budget-epoch\u2462\u2462"},{"id":"ref-for-privacy-budget-epoch\u2462\u2463"},{"id":"ref-for-privacy-budget-epoch\u2462\u2464"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2462\u2465"}],"title":"10.1. Information Exposed by the Private Attribution API"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2462\u2466"}],"title":"10.6.1. Clearing Site Data"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2462\u2467"},{"id":"ref-for-privacy-budget-epoch\u2462\u2468"},{"id":"ref-for-privacy-budget-epoch\u2463\u24ea"},{"id":"ref-for-privacy-budget-epoch\u2463\u2460"},{"id":"ref-for-privacy-budget-epoch\u2463\u2461"},{"id":"ref-for-privacy-budget-epoch\u2463\u2462"},{"id":"ref-for-privacy-budget-epoch\u2463\u2463"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-privacy-budget-epoch\u2463\u2464"},{"id":"ref-for-privacy-budget-epoch\u2463\u2465"}],"title":"10.7. Choice of Clock"}],"url":"#privacy-budget-epoch"},
"privacy-budget-key": {"dfnID":"privacy-budget-key","dfnText":"privacy budget key","external":false,"refSections":[{"refs":[{"id":"ref-for-privacy-budget-key"},{"id":"ref-for-privacy-budget-key\u2460"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-privacy-budget-key\u2461"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-privacy-budget-key\u2462"}],"title":"4.4.1. Attribution Logic"}],"url":"#privacy-budget-key"},
"privacy-budget-store": {"dfnID":"privacy-budget-store","dfnText":"privacy budget store","external":false,"refSections":[{"refs":[{"id":"ref-for-privacy-budget-store"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-privacy-budget-store\u2460"},{"id":"ref-for-privacy-budget-store\u2461"},{"id":"ref-for-privacy-budget-store\u2462"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-privacy-budget-store\u2463"},{"id":"ref-for-privacy-budget-store\u2464"},{"id":"ref-for-privacy-budget-store\u2465"},{"id":"ref-for-privacy-budget-store\u2466"},{"id":"ref-for-privacy-budget-store\u2467"}],"title":"4.2.1. Privacy Budget Store"},{"refs":[{"id":"ref-for-privacy-budget-store\u2468"}],"title":"4.2.3. Last Browsing History Clear Time"},{"refs":[{"id":"ref-for-privacy-budget-store\u2460\u24ea"},{"id":"ref-for-privacy-budget-store\u2460\u2460"}],"title":"10.1. Information Exposed by the Private Attribution API"},{"refs":[{"id":"ref-for-privacy-budget-store\u2460\u2461"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-privacy-budget-store\u2460\u2462"},{"id":"ref-for-privacy-budget-store\u2460\u2463"}],"title":"10.6.1. Clearing Site Data"},{"refs":[{"id":"ref-for-privacy-budget-store\u2460\u2464"},{"id":"ref-for-privacy-budget-store\u2460\u2465"}],"title":"10.6.2. Clearing Browsing History"}],"url":"#privacy-budget-store"},
"privacy-budgets": {"dfnID":"privacy-budgets","dfnText":"privacy budgets","external":false,"refSections":[{"refs":[{"id":"ref-for-privacy-budgets"}],"title":"2. Overview of Operation"},{"refs":[{"id":"ref-for-privacy-budgets\u2460"}],"title":"3.1. Site Identities"},{"refs":[{"id":"ref-for-privacy-budgets\u2461"},{"id":"ref-for-privacy-budgets\u2462"},{"id":"ref-for-privacy-budgets\u2463"}],"title":"3.5. Requesting Attribution for a Conversion"},{"refs":[{"id":"ref-for-privacy-budgets\u2464"},{"id":"ref-for-privacy-budgets\u2465"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-privacy-budgets\u2466"}],"title":"4.2.2. Epoch Start Store"},{"refs":[{"id":"ref-for-privacy-budgets\u2467"}],"title":"7.3. Anti-Replay Requirements"},{"refs":[{"id":"ref-for-privacy-budgets\u2468"},{"id":"ref-for-privacy-budgets\u2460\u24ea"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-privacy-budgets\u2460\u2460"},{"id":"ref-for-privacy-budgets\u2460\u2461"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-privacy-budgets\u2460\u2462"}],"title":"8.1.1. Browser Instances"},{"refs":[{"id":"ref-for-privacy-budgets\u2460\u2463"},{"id":"ref-for-privacy-budgets\u2460\u2464"}],"title":"8.1.3. Privacy Budget Epochs"},{"refs":[{"id":"ref-for-privacy-budgets\u2460\u2465"},{"id":"ref-for-privacy-budgets\u2460\u2466"},{"id":"ref-for-privacy-budgets\u2460\u2467"},{"id":"ref-for-privacy-budgets\u2460\u2468"}],"title":"8.2.1. Privacy Budget Deduction"},{"refs":[{"id":"ref-for-privacy-budgets\u2461\u24ea"}],"title":"9.2. API Implementation"},{"refs":[{"id":"ref-for-privacy-budgets\u2461\u2460"},{"id":"ref-for-privacy-budgets\u2461\u2461"}],"title":"10.6. Clearing API State"},{"refs":[{"id":"ref-for-privacy-budgets\u2461\u2462"},{"id":"ref-for-privacy-budgets\u2461\u2463"},{"id":"ref-for-privacy-budgets\u2461\u2464"},{"id":"ref-for-privacy-budgets\u2461\u2465"}],"title":"10.6.2. Clearing Browsing History"},{"refs":[{"id":"ref-for-privacy-budgets\u2461\u2466"},{"id":"ref-for-privacy-budgets\u2461\u2467"},{"id":"ref-for-privacy-budgets\u2461\u2468"}],"title":"10.7. Choice of Clock"}],"url":"#privacy-budgets"},
"privacy-unit": {"dfnID":"privacy-unit","dfnText":"privacy unit","external":false,"refSections":[{"refs":[{"id":"ref-for-privacy-unit"}],"title":"8. Differential Privacy"},{"refs":[{"id":"ref-for-privacy-unit\u2460"},{"id":"ref-for-privacy-unit\u2461"}],"title":"8.1. Privacy Unit"},{"refs":[{"id":"ref-for-privacy-unit\u2462"}],"title":"8.2.2. Safety Limits"}],"url":"#privacy-unit"},
"private-attribution-task-source": {"dfnID":"private-attribution-task-source","dfnText":"Private Attribution task source","external":false,"refSections":[{"refs":[{"id":"ref-for-private-attribution-task-source"}],"title":"4.4. Measure Conversion Algorithm"}],"url":"#private-attribution-task-source"},
"privateattribution": {"dfnID":"privateattribution","dfnText":"PrivateAttribution","external":false,"refSections":[{"refs":[{"id":"ref-for-privateattribution"}],"title":"3.2. Navigator Interface"},{"refs":[{"id":"ref-for-privateattribution\u2460"}],"title":"3.4. Saving Impressions"},{"refs":[{"id":"ref-for-privateattribution\u2461"}],"title":"3.5. Requesting Attribution for a Conversion"}],"url":"#privateattribution"},
"privateattributionaggregationservices": {"dfnID":"privateattributionaggregationservices","dfnText":"PrivateAttributionAggregationServices","external":false,"refSections":[{"refs":[{"id":"ref-for-privateattributionaggregationservices"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#privateattributionaggregationservices"},
"safety-limits": {"dfnID":"safety-limits","dfnText":"safety limits","external":false,"refSections":[{"refs":[{"id":"ref-for-safety-limits"}],"title":"4.2. State For Privacy Budget Management"},{"refs":[{"id":"ref-for-safety-limits\u2460"}],"title":"8.1.2. Per-Site Limits"}],"url":"#safety-limits"},
"tee": {"dfnID":"tee","dfnText":"Trusted Execution Environment (TEE)","external":false,"refSections":[{"refs":[{"id":"ref-for-tee"}],"title":"3.3. Finding a Supported Aggregation Service"}],"url":"#tee"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#actions": {"displayText":"actions","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"actions","type":"dfn","url":"#actions"},
"#aggregation-service": {"displayText":"aggregation service","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"aggregation service","type":"dfn","url":"#aggregation-service"},
"#attribution": {"displayText":"attribution","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"attribution","type":"dfn","url":"#attribution"},
"#attribution-logic": {"displayText":"attribution logic","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"attribution logic","type":"dfn","url":"#attribution-logic"},
"#clear-impressions-for-a-conversion-site": {"displayText":"clear impressions for a conversion site","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"clear impressions for a conversion site","type":"dfn","url":"#clear-impressions-for-a-conversion-site"},
"#common-matching-logic": {"displayText":"common matching logic","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"common matching logic","type":"dfn","url":"#common-matching-logic"},
"#conversion": {"displayText":"conversion","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversion","type":"dfn","url":"#conversion"},
"#conversion-report": {"displayText":"conversion report","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversion report","type":"dfn","url":"#conversion-report"},
"#conversion-site": {"displayText":"conversion site","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversion site","type":"dfn","url":"#conversion-site"},
"#conversion-value": {"displayText":"conversion value","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversion value","type":"dfn","url":"#conversion-value"},
"#create-an-all-zero-histogram": {"displayText":"create an all-zero histogram","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"create an all-zero histogram","type":"dfn","url":"#create-an-all-zero-histogram"},
"#day": {"displayText":"day","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"day","type":"dfn","url":"#day"},
"#deduct-privacy-budget": {"displayText":"deduct privacy budget","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"deduct privacy budget","type":"dfn","url":"#deduct-privacy-budget"},
"#dictdef-privateattributionaggregationservice": {"displayText":"PrivateAttributionAggregationService","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionAggregationService","type":"dictionary","url":"#dictdef-privateattributionaggregationservice"},
"#dictdef-privateattributionconversionoptions": {"displayText":"PrivateAttributionConversionOptions","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionConversionOptions","type":"dictionary","url":"#dictdef-privateattributionconversionoptions"},
"#dictdef-privateattributionconversionresult": {"displayText":"PrivateAttributionConversionResult","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionConversionResult","type":"dictionary","url":"#dictdef-privateattributionconversionresult"},
"#dictdef-privateattributionimpressionoptions": {"displayText":"PrivateAttributionImpressionOptions","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionImpressionOptions","type":"dictionary","url":"#dictdef-privateattributionimpressionoptions"},
"#differential-privacy": {"displayText":"differential privacy","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"differential privacy","type":"dfn","url":"#differential-privacy"},
"#do-attribution-and-fill-a-histogram": {"displayText":"do attribution and fill a histogram","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"do attribution and fill a histogram","type":"dfn","url":"#do-attribution-and-fill-a-histogram"},
"#dom-navigator-privateattribution": {"displayText":"privateAttribution","export":true,"for_":["Navigator"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"privateAttribution","type":"attribute","url":"#dom-navigator-privateattribution"},
"#dom-privateattribution-aggregationservices": {"displayText":"aggregationServices","export":true,"for_":["PrivateAttribution"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"aggregationServices","type":"attribute","url":"#dom-privateattribution-aggregationservices"},
"#dom-privateattribution-measureconversion": {"displayText":"measureConversion(options)","export":true,"for_":["PrivateAttribution"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"measureConversion(options)","type":"method","url":"#dom-privateattribution-measureconversion"},
"#dom-privateattribution-saveimpression": {"displayText":"saveImpression(options)","export":true,"for_":["PrivateAttribution"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"saveImpression(options)","type":"method","url":"#dom-privateattribution-saveimpression"},
"#dom-privateattributionaggregationservice-protocol": {"displayText":"protocol","export":true,"for_":["PrivateAttributionAggregationService"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"protocol","type":"dict-member","url":"#dom-privateattributionaggregationservice-protocol"},
"#dom-privateattributionconversionoptions-aggregationservice": {"displayText":"aggregationService","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"aggregationService","type":"dict-member","url":"#dom-privateattributionconversionoptions-aggregationservice"},
"#dom-privateattributionconversionoptions-epsilon": {"displayText":"epsilon","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"epsilon","type":"dict-member","url":"#dom-privateattributionconversionoptions-epsilon"},
"#dom-privateattributionconversionoptions-histogramsize": {"displayText":"histogramSize","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"histogramSize","type":"dict-member","url":"#dom-privateattributionconversionoptions-histogramsize"},
"#dom-privateattributionconversionoptions-impressionsites": {"displayText":"impressionSites","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"impressionSites","type":"dict-member","url":"#dom-privateattributionconversionoptions-impressionsites"},
"#dom-privateattributionconversionoptions-intermediarysites": {"displayText":"intermediarySites","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"intermediarySites","type":"dict-member","url":"#dom-privateattributionconversionoptions-intermediarysites"},
"#dom-privateattributionconversionoptions-logic": {"displayText":"logic","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"logic","type":"dict-member","url":"#dom-privateattributionconversionoptions-logic"},
"#dom-privateattributionconversionoptions-lookbackdays": {"displayText":"lookbackDays","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"lookbackDays","type":"dict-member","url":"#dom-privateattributionconversionoptions-lookbackdays"},
"#dom-privateattributionconversionoptions-matchvalue": {"displayText":"matchValue","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"matchValue","type":"dict-member","url":"#dom-privateattributionconversionoptions-matchvalue"},
"#dom-privateattributionconversionoptions-maxvalue": {"displayText":"maxValue","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"maxValue","type":"dict-member","url":"#dom-privateattributionconversionoptions-maxvalue"},
"#dom-privateattributionconversionoptions-value": {"displayText":"value","export":true,"for_":["PrivateAttributionConversionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"value","type":"dict-member","url":"#dom-privateattributionconversionoptions-value"},
"#dom-privateattributionimpressionoptions-conversionsites": {"displayText":"conversionSites","export":true,"for_":["PrivateAttributionImpressionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversionSites","type":"dict-member","url":"#dom-privateattributionimpressionoptions-conversionsites"},
"#dom-privateattributionimpressionoptions-histogramindex": {"displayText":"histogramIndex","export":true,"for_":["PrivateAttributionImpressionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"histogramIndex","type":"dict-member","url":"#dom-privateattributionimpressionoptions-histogramindex"},
"#dom-privateattributionimpressionoptions-lifetimedays": {"displayText":"lifetimeDays","export":true,"for_":["PrivateAttributionImpressionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"lifetimeDays","type":"dict-member","url":"#dom-privateattributionimpressionoptions-lifetimedays"},
"#dom-privateattributionimpressionoptions-matchvalue": {"displayText":"matchValue","export":true,"for_":["PrivateAttributionImpressionOptions"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"matchValue","type":"dict-member","url":"#dom-privateattributionimpressionoptions-matchvalue"},
"#dom-privateattributionlogic-last-touch": {"displayText":"\"last-touch\"","export":true,"for_":["PrivateAttributionLogic"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"\"last-touch\"","type":"enum-value","url":"#dom-privateattributionlogic-last-touch"},
"#dom-privateattributionprotocol-dap-12-histogram": {"displayText":"\"dap-12-histogram\"","export":true,"for_":["PrivateAttributionProtocol"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"\"dap-12-histogram\"","type":"enum-value","url":"#dom-privateattributionprotocol-dap-12-histogram"},
"#dom-privateattributionprotocol-tee-00": {"displayText":"\"tee-00\"","export":true,"for_":["PrivateAttributionProtocol"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"\"tee-00\"","type":"enum-value","url":"#dom-privateattributionprotocol-tee-00"},
"#enumdef-privateattributionlogic": {"displayText":"PrivateAttributionLogic","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionLogic","type":"enum","url":"#enumdef-privateattributionlogic"},
"#enumdef-privateattributionprotocol": {"displayText":"PrivateAttributionProtocol","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionProtocol","type":"enum","url":"#enumdef-privateattributionprotocol"},
"#epoch-index": {"displayText":"epoch index","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"epoch index","type":"dfn","url":"#epoch-index"},
"#epoch-start-store": {"displayText":"epoch start store","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"epoch start store","type":"dfn","url":"#epoch-start-store"},
"#fill-a-histogram-with-last-touch-attribution": {"displayText":"fill a histogram with last-touch attribution","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"fill a histogram with last-touch attribution","type":"dfn","url":"#fill-a-histogram-with-last-touch-attribution"},
"#get-the-current-epoch": {"displayText":"get the current epoch","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"get the current epoch","type":"dfn","url":"#get-the-current-epoch"},
"#get-the-starting-epoch-for-attribution": {"displayText":"get the starting epoch for attribution","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"get the starting epoch for attribution","type":"dfn","url":"#get-the-starting-epoch-for-attribution"},
"#http-headerdef-save-impression": {"displayText":"save-impression","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"save-impression","type":"http-header","url":"#http-headerdef-save-impression"},
"#impression": {"displayText":"impression","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"impression","type":"dfn","url":"#impression"},
"#impression-conversion-sites": {"displayText":"conversion sites","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"conversion sites","type":"dfn","url":"#impression-conversion-sites"},
"#impression-histogram-index": {"displayText":"histogram index","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"histogram index","type":"dfn","url":"#impression-histogram-index"},
"#impression-impression-site": {"displayText":"impression site","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"impression site","type":"dfn","url":"#impression-impression-site"},
"#impression-intermediary-site": {"displayText":"intermediary site","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"intermediary site","type":"dfn","url":"#impression-intermediary-site"},
"#impression-lifetime": {"displayText":"lifetime","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"lifetime","type":"dfn","url":"#impression-lifetime"},
"#impression-match-value": {"displayText":"match value","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"match value","type":"dfn","url":"#impression-match-value"},
"#impression-site": {"displayText":"impression site","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"impression site","type":"dfn","url":"#impression-site"},
"#impression-store": {"displayText":"impression store","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"impression store","type":"dfn","url":"#impression-store"},
"#impression-timestamp": {"displayText":"timestamp","export":true,"for_":["impression"],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"timestamp","type":"dfn","url":"#impression-timestamp"},
"#individual-differential-privacy": {"displayText":"individual differential privacy","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"individual differential privacy","type":"dfn","url":"#individual-differential-privacy"},
"#intermediary-site": {"displayText":"intermediary site","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"intermediary site","type":"dfn","url":"#intermediary-site"},
"#last-browsing-history-clear": {"displayText":"last browsing history clear","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"last browsing history clear","type":"dfn","url":"#last-browsing-history-clear"},
"#microepsilon": {"displayText":"microepsilon","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"microepsilon","type":"dfn","url":"#microepsilon"},
"#mpc": {"displayText":"mpc","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"mpc","type":"dfn","url":"#mpc"},
"#outcomes": {"displayText":"outcomes","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"outcomes","type":"dfn","url":"#outcomes"},
"#parse-a-site": {"displayText":"parse a site","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"parse a site","type":"dfn","url":"#parse-a-site"},
"#prio3l1boundsum": {"displayText":"prio3l1boundsum","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"prio3l1boundsum","type":"dfn","url":"#prio3l1boundsum"},
"#privacy-budget-epoch": {"displayText":"epoch","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"epoch","type":"dfn","url":"#privacy-budget-epoch"},
"#privacy-budget-key": {"displayText":"privacy budget key","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"privacy budget key","type":"dfn","url":"#privacy-budget-key"},
"#privacy-budget-store": {"displayText":"privacy budget store","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"privacy budget store","type":"dfn","url":"#privacy-budget-store"},
"#privacy-budgets": {"displayText":"privacy budgets","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"privacy budgets","type":"dfn","url":"#privacy-budgets"},
"#privacy-unit": {"displayText":"privacy unit","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"privacy unit","type":"dfn","url":"#privacy-unit"},
"#private-attribution-task-source": {"displayText":"private attribution task source","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"private attribution task source","type":"dfn","url":"#private-attribution-task-source"},
"#privateattribution": {"displayText":"PrivateAttribution","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttribution","type":"interface","url":"#privateattribution"},
"#privateattributionaggregationservices": {"displayText":"PrivateAttributionAggregationServices","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"PrivateAttributionAggregationServices","type":"interface","url":"#privateattributionaggregationservices"},
"#safety-limits": {"displayText":"safety limits","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"safety limits","type":"dfn","url":"#safety-limits"},
"#tee": {"displayText":"tee","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"privacy-preserving-attribution","status":"local","text":"tee","type":"dfn","url":"#tee"},
"ebb755bb_https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting": {"displayText":"fingerprint","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"fingerprint","type":"dfn","url":"https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting"},
"https://drafts.csswg.org/css-2024/#user": {"displayText":"user","export":true,"for_":[],"level":"2024","normative":true,"shortname":"css","spec":"css-2024","status":"current","text":"user","type":"dfn","url":"https://drafts.csswg.org/css-2024/#user"},
"https://html.spec.whatwg.org/#child-navigable": {"displayText":"iframe","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"iframe","type":"dfn","url":"https://html.spec.whatwg.org/#child-navigable"},
"https://html.spec.whatwg.org/#concept-environment-top-level-origin": {"displayText":"top-level origin","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"top-level origin","type":"dfn","url":"https://html.spec.whatwg.org/#concept-environment-top-level-origin"},
"https://html.spec.whatwg.org/#concept-origin": {"displayText":"origin","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/#concept-origin"},
"https://html.spec.whatwg.org/#concept-origin-host": {"displayText":"host","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"host","type":"dfn","url":"https://html.spec.whatwg.org/#concept-origin-host"},
"https://html.spec.whatwg.org/#concept-origin-scheme": {"displayText":"scheme","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"scheme","type":"dfn","url":"https://html.spec.whatwg.org/#concept-origin-scheme"},
"https://html.spec.whatwg.org/#obtain-a-site": {"displayText":"obtain a site","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"obtain a site","type":"dfn","url":"https://html.spec.whatwg.org/#obtain-a-site"},
"https://html.spec.whatwg.org/#relevant-settings-object": {"displayText":"relevant settings object","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"relevant settings object","type":"dfn","url":"https://html.spec.whatwg.org/#relevant-settings-object"},
"https://html.spec.whatwg.org/#same-site": {"displayText":"same site","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"same site","type":"dfn","url":"https://html.spec.whatwg.org/#same-site"},
"https://html.spec.whatwg.org/#scheme-and-host": {"displayText":"scheme-and-host","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"scheme-and-host","type":"dfn","url":"https://html.spec.whatwg.org/#scheme-and-host"},
"https://html.spec.whatwg.org/#site": {"displayText":"site","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"site","type":"dfn","url":"https://html.spec.whatwg.org/#site"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple": {"displayText":"tuple origin","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"tuple origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable": {"displayText":"child navigable","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"child navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": {"displayText":"in parallel","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"in parallel","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"https://html.spec.whatwg.org/multipage/system-state.html#navigator": {"displayText":"Navigator","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Navigator","type":"interface","url":"https://html.spec.whatwg.org/multipage/system-state.html#navigator"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm": {"displayText":"relevant realm","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant realm","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": {"displayText":"origin","export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"displayText":"queue a task","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#task-source": {"displayText":"task source","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"task source","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#task-source"},
"https://httpwg.org/specs/rfc9651#dictionary": {"displayText":"dictionary","export":true,"for_":["structured header"],"level":"","normative":true,"shortname":"structured header","spec":"structured header","status":"anchor-block","text":"dictionary","type":"dfn","url":"https://httpwg.org/specs/rfc9651#dictionary"},
"https://httpwg.org/specs/rfc9651#inner-list": {"displayText":"inner list","export":true,"for_":["structured header"],"level":"","normative":true,"shortname":"structured header","spec":"structured header","status":"anchor-block","text":"inner list","type":"dfn","url":"https://httpwg.org/specs/rfc9651#inner-list"},
"https://httpwg.org/specs/rfc9651#integer": {"displayText":"integer","export":true,"for_":["structured header"],"level":"","normative":true,"shortname":"structured header","spec":"structured header","status":"anchor-block","text":"integer","type":"dfn","url":"https://httpwg.org/specs/rfc9651#integer"},
"https://httpwg.org/specs/rfc9651#string": {"displayText":"string","export":true,"for_":["structured header"],"level":"","normative":true,"shortname":"structured header","spec":"structured header","status":"anchor-block","text":"string","type":"dfn","url":"https://httpwg.org/specs/rfc9651#string"},
"https://infra.spec.whatwg.org/#32-bit-unsigned-integer": {"displayText":"32-bit unsigned integer","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"32-bit unsigned integer","type":"dfn","url":"https://infra.spec.whatwg.org/#32-bit-unsigned-integer"},
"https://infra.spec.whatwg.org/#assert": {"displayText":"assert","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"assert","type":"dfn","url":"https://infra.spec.whatwg.org/#assert"},
"https://infra.spec.whatwg.org/#implementation-defined": {"displayText":"implementation-defined","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://infra.spec.whatwg.org/#iteration-continue": {"displayText":"continue","export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list": {"displayText":"list","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-contain": {"displayText":"contain","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://infra.spec.whatwg.org/#list-is-empty": {"displayText":"is empty","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"is empty","type":"dfn","url":"https://infra.spec.whatwg.org/#list-is-empty"},
"https://infra.spec.whatwg.org/#list-item": {"displayText":"item","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"item","type":"dfn","url":"https://infra.spec.whatwg.org/#list-item"},
"https://infra.spec.whatwg.org/#list-iterate": {"displayText":"iterate","export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"iterate","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#list-remove": {"displayText":"remove","export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"remove","type":"dfn","url":"https://infra.spec.whatwg.org/#list-remove"},
"https://infra.spec.whatwg.org/#list-size": {"displayText":"size","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-entry": {"displayText":"entry","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"entry","type":"dfn","url":"https://infra.spec.whatwg.org/#map-entry"},
"https://infra.spec.whatwg.org/#map-exists": {"displayText":"contain","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-get": {"displayText":"get","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"get","type":"dfn","url":"https://infra.spec.whatwg.org/#map-get"},
"https://infra.spec.whatwg.org/#map-key": {"displayText":"key","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"key","type":"dfn","url":"https://infra.spec.whatwg.org/#map-key"},
"https://infra.spec.whatwg.org/#map-set": {"displayText":"set","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"displayText":"map","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#set-append": {"displayText":"append","export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#set-append"},
"https://infra.spec.whatwg.org/#set-extend": {"displayText":"extend","export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"extend","type":"dfn","url":"https://infra.spec.whatwg.org/#set-extend"},
"https://infra.spec.whatwg.org/#sets": {"displayText":"set","export":true,"for_":[],"level":"","normative":true,"shortname":"infra","spec":"infra","status":"anchor-block","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#sets"},
"https://infra.spec.whatwg.org/#string": {"displayText":"string","export":true,"for_":[],"level":"","normative":true,"shortname":"infra","spec":"infra","status":"anchor-block","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#tuple": {"displayText":"tuple","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://infra.spec.whatwg.org/#user-agent": {"displayText":"user agent","export":true,"for_":[],"level":"","normative":true,"shortname":"infra","spec":"infra","status":"anchor-block","text":"user agent","type":"dfn","url":"https://infra.spec.whatwg.org/#user-agent"},
"https://storage.spec.whatwg.org/#storage-key": {"displayText":"storage key","export":true,"for_":[],"level":"","normative":true,"shortname":"storage","spec":"storage","status":"anchor-block","text":"storage key","type":"dfn","url":"https://storage.spec.whatwg.org/#storage-key"},
"https://url.spec.whatwg.org/#concept-host-parser": {"displayText":"host parser","export":true,"for_":[],"level":"","normative":true,"shortname":"url","spec":"url","status":"anchor-block","text":"host parser","type":"dfn","url":"https://url.spec.whatwg.org/#concept-host-parser"},
"https://url.spec.whatwg.org/#domain-label": {"displayText":"domain label","export":true,"for_":[],"level":"","normative":true,"shortname":"url","spec":"url","status":"anchor-block","text":"domain label","type":"dfn","url":"https://url.spec.whatwg.org/#domain-label"},
"https://url.spec.whatwg.org/#host-registrable-domain": {"displayText":"registrable domain","export":true,"for_":[],"level":"","normative":true,"shortname":"url","spec":"url","status":"anchor-block","text":"registrable domain","type":"dfn","url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"https://w3c.github.io/hr-time/#dfn-current-wall-time": {"displayText":"current coarsened wall time","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"current coarsened wall time","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-current-wall-time"},
"https://w3c.github.io/hr-time/#dfn-duration": {"displayText":"duration","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"duration","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-duration"},
"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time": {"displayText":"current wall time","export":true,"for_":["environment settings object"],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"current wall time","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-eso-current-wall-time"},
"https://w3c.github.io/hr-time/#dfn-moment": {"displayText":"moment","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"moment","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-moment"},
"https://w3c.github.io/hr-time/#dfn-monotonic-clock": {"displayText":"monotonic clock","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"monotonic clock","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-monotonic-clock"},
"https://w3c.github.io/hr-time/#dfn-wall-clock": {"displayText":"wall clock","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"wall clock","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-wall-clock"},
"https://w3c.github.io/webappsec-clear-site-data/#http-headerdef-clear-site-data": {"displayText":"Clear-Site-Data","export":true,"for_":[],"level":"1","normative":true,"shortname":"clear-site-data","spec":"clear-site-data","status":"current","text":"clear-site-data","type":"http-header","url":"https://w3c.github.io/webappsec-clear-site-data/#http-headerdef-clear-site-data"},
"https://w3c.github.io/webappsec-permissions-policy/#default-allowlist": {"displayText":"*","export":true,"for_":["default allowlist"],"level":"1","normative":true,"shortname":"permissions-policy","spec":"permissions-policy-1","status":"current","text":"*","type":"dfn","url":"https://w3c.github.io/webappsec-permissions-policy/#default-allowlist"},
"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature": {"displayText":"policy-controlled feature","export":true,"for_":[],"level":"1","normative":true,"shortname":"permissions-policy","spec":"permissions-policy-1","status":"current","text":"policy-controlled feature","type":"dfn","url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"},
"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist": {"displayText":"default allowlist","export":true,"for_":["policy-controlled feature"],"level":"1","normative":true,"shortname":"permissions-policy","spec":"permissions-policy-1","status":"current","text":"default allowlist","type":"dfn","url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"},
"https://w3ctag.github.io/privacy-principles/#collective-privacy": {"displayText":"collective privacy","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"collective privacy","type":"dfn","url":"https://w3ctag.github.io/privacy-principles/#collective-privacy"},
"https://w3ctag.github.io/privacy-principles/#cross-context-recognition": {"displayText":"cross-context recognition","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"cross-context recognition","type":"dfn","url":"https://w3ctag.github.io/privacy-principles/#cross-context-recognition"},
"https://w3ctag.github.io/privacy-principles/#cross-site-recognition": {"displayText":"cross-site recognition","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"cross-site recognition","type":"dfn","url":"https://w3ctag.github.io/privacy-principles/#cross-site-recognition"},
"https://w3ctag.github.io/privacy-principles/#same-site-recognition": {"displayText":"same-site recognition","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"same-site recognition","type":"dfn","url":"https://w3ctag.github.io/privacy-principles/#same-site-recognition"},
"https://webidl.spec.whatwg.org/#Exposed": {"displayText":"Exposed","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#SecureContext": {"displayText":"SecureContext","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#a-new-promise": {"displayText":"a new promise","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a new promise","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-new-promise"},
"https://webidl.spec.whatwg.org/#a-promise-rejected-with": {"displayText":"a promise rejected with","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a promise rejected with","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror": {"displayText":"RangeError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"RangeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"https://webidl.spec.whatwg.org/#exceptiondef-referenceerror": {"displayText":"ReferenceError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"ReferenceError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-referenceerror"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"displayText":"DOMString","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-USVString": {"displayText":"USVString","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"USVString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"https://webidl.spec.whatwg.org/#idl-Uint8Array": {"displayText":"Uint8Array","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Uint8Array","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-Uint8Array"},
"https://webidl.spec.whatwg.org/#idl-double": {"displayText":"double","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"double","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-double"},
"https://webidl.spec.whatwg.org/#idl-promise": {"displayText":"Promise","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#idl-sequence": {"displayText":"sequence","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"sequence","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"displayText":"undefined","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://webidl.spec.whatwg.org/#idl-unsigned-long": {"displayText":"unsigned long","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-long"},
"https://webidl.spec.whatwg.org/#resolve": {"displayText":"resolve","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"resolve","type":"dfn","url":"https://webidl.spec.whatwg.org/#resolve"},
"https://webidl.spec.whatwg.org/#syntaxerror": {"displayText":"SyntaxError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SyntaxError","type":"exception","url":"https://webidl.spec.whatwg.org/#syntaxerror"},
"https://webidl.spec.whatwg.org/#this": {"displayText":"this","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
"https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting": {"displayText":"fingerprinting","export":true,"for_":[],"level":"","normative":true,"shortname":"privacy-preserving-attribution","spec":"","status":"anchor-block","text":"fingerprinting","type":"dfn","url":"https://www.w3.org/TR/fingerprinting-guidance/#dfn-browser-fingerprinting"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>